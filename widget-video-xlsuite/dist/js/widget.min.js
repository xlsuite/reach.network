function loadVideoLinkFromXLSuite(e,i,t){var n="2ae45fc2-72b9-45ce-9771-caf0fabf9c97";console.log("displayKey param",e),$.ajax({url:"https://rn.xlsuite.com/admin/api/liquids/call?api_key="+n+"&tag=load_screen&display_key="+e}).then(function(e){if(!e||!e.screen)return console.log("Error - Returned data is empty",e),t&&t(),void 0;var n=e.screen.channel_url;console.log("Loaded channel URL",n);var o=n+"&amp;autoplay=1&amp;loop=1&amp;controls=0&amp;showinfo=0 frameborder=0";i(o)})}if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml",STORAGE_ENV:"prod"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e){"use strict";function i(){clearTimeout(k),k=null}function t(){e.rpc.call("","rsevent_done",null,R.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,R.getString("id"),!0,!0,!0,!0,!0)}function o(e){F=setInterval(function(){w=h.url+E+"cb="+(new Date).getTime(),I=!1},e)}function r(){i(),k=setTimeout(function(){t()},5e3)}function a(){P=!0,w="",b.show("The selected video does not exist."),S.remove(A,function(){_||r()})}function s(e){w=e,b.hide(),_||d()}function l(e){w=e,I=!1}function c(){var e=S.getFrameObject(A);return _=!0,P?(i(),void 0):(e&&e.pause(),void 0)}function d(){var e=S.getFrameObject(A);return _=!1,P?(r(),void 0):(I?t():e?e.play():w&&""!==w&&(S.add(0),S.createFramePlayer(0,h,w,config.SKIN,"player.html")),void 0)}function u(){S.remove(A,function(){t()})}function m(){var e;C||null!==F||o(L),_||(e=S.getFrameObject(A),e.play())}function f(){clearTimeout(O),O=setInterval(function(){console.log("Interval check"),loadVideoLinkFromXLSuite(V,function(e){if(e!=w){w=e;var i=$("#mainIframe");i.attr("src",w)}})},T)}function g(i,t){console.log("additional params values",t),Array.isArray(i)&&i.length>0&&"additionalParams"===i[0]&&Array.isArray(t)&&t.length>0&&(h=JSON.parse(t[0]),R=new e.Prefs,h||(h={},console.log("additional params recreated")),document.getElementById("videoContainer").style.height=R.getInt("rsH")+"px",h.width=R.getInt("rsW"),h.height=R.getInt("rsH"),S=new RiseVision.Common.Video.FrameController,C=!1,R.getString("displayId")?(V=R.getString("displayId"),console.log("displayId set from chromeApp param",V)):(V=h.displayId,console.log("displayId set from default settings",V)),loadVideoLinkFromXLSuite(V,p,function(){V!=R.getString("displayId")&&(V=h.displayId,console.log("Trying to use default displayId",V),loadVideoLinkFromXLSuite(V,p))}))}function p(e){w=e;var i=$("#mainIframe");i.attr("src",w),i.attr("width",h.width),i.attr("height",h.height),f(),n()}function y(e){console.debug("video-folder::playerError()",e),I=!0,u()}function v(){c()}var h,V,R=null,b=null,S=null,I=!1,C=!1,_=!0,A=0,E="",w="",L=9e5,F=null,T=5e3,k=null,P=!1,O=null;return{noStorageFile:a,onStorageInit:s,onStorageRefresh:l,pause:c,play:d,setAdditionalParams:g,playerEnded:u,playerReady:m,playerError:y,stop:v}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Storage=function(e){"use strict";function i(){var i=document.getElementById("videoStorage");i&&(i.addEventListener("rise-storage-response",function(e){e.detail&&e.detail.url&&(t?(t=!1,RiseVision.Video.onStorageInit(e.detail.url)):e.detail.hasOwnProperty("changed")&&e.detail.changed&&RiseVision.Video.onStorageRefresh(e.detail.url))}),i.addEventListener("rise-storage-no-file",function(){RiseVision.Video.noStorageFile()}),i.setAttribute("folder",e.storage.folder),i.setAttribute("fileName",e.storage.fileName),i.setAttribute("companyId",e.storage.companyId),i.setAttribute("env",config.STORAGE_ENV),i.go())}var t=!0;return{init:i}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function e(e){return document.getElementById(l+e)}function i(i){var t,n=e(i);return t=n.querySelector("iframe"),t?t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument:null}function t(t){var n,o=e(t),r=i(t);r&&(n=o.querySelector("iframe"),r.remove(),n.setAttribute("src","about:blank"))}function n(i){var t=e(i),n=document.createElement("iframe");n.setAttribute("allowTransparency",!0),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),t.appendChild(n)}function o(t,n,o,r,a){var s,l=e(t),c=i(t);c&&(s=l.querySelector("iframe"),s.onload=function(){s.onload=null,c.init(n,o,r),c.load()},s.setAttribute("src",a))}function r(i){var t=e(i);t.style.visibility="hidden"}function a(e,i){var n=document.getElementById(l+e);t(e),setTimeout(function(){for(;n.firstChild;)n.removeChild(n.firstChild);i&&"function"==typeof i&&i()},200)}function s(i){var t=e(i);t.style.visibility="visible"}var l="if_";return{add:n,createFramePlayer:o,getFrameContainer:e,getFrameObject:i,hide:r,remove:a,show:s}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Message=function(e,i){"use strict";function t(){try{i.style.height=e.style.height}catch(t){console.warn("Can't initialize Message - ",t.message)}}function n(){if(r){for(;i.firstChild;)i.removeChild(i.firstChild);i.style.display="none",e.style.visibility="visible",r=!1}}function o(t){var n,o=document.createDocumentFragment();r?(n=i.querySelector(".message"),n.innerHTML=t):(e.style.visibility="hidden",i.style.display="block",n=document.createElement("p"),n.innerHTML=t,n.setAttribute("class","message"),n.style.lineHeight=i.style.height,o.appendChild(n),i.appendChild(o),r=!0)}var r=!1;return t(),{hide:n,show:o}},function(e,i){"use strict";function t(){RiseVision.Video.play()}function n(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function r(){e.removeEventListener("WebComponentsReady",r),s&&""!==s&&(i.rpc.register("rscmd_play_"+s,t),i.rpc.register("rscmd_pause_"+s,n),i.rpc.register("rscmd_stop_"+s,o),i.rpc.register("rsparam_set_"+s,RiseVision.Video.setAdditionalParams),i.rpc.call("","rsparam_get",null,s,["additionalParams"]))}var a=new i.Prefs,s=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("WebComponentsReady",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsibG9hZFZpZGVvTGlua0Zyb21YTFN1aXRlIiwiZGlzcGxheUtleSIsInN1Y2Nlc3NDYWxsYmFjayIsImVycm9yQ2FsbGJhY2siLCJhcGlLZXkiLCJjb25zb2xlIiwibG9nIiwiJCIsImFqYXgiLCJ1cmwiLCJ0aGVuIiwiZGF0YSIsInNjcmVlbiIsImNoYW5lbFVybCIsImNoYW5uZWxfdXJsIiwiZnVsbFVybCIsImNvbmZpZyIsIlNLSU4iLCJTVE9SQUdFX0VOViIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIlJpc2VWaXNpb24iLCJWaWRlbyIsImdhZGdldHMiLCJfY2xlYXJOb0ZpbGVUaW1lciIsImNsZWFyVGltZW91dCIsIl9ub0ZpbGVUaW1lciIsIl9kb25lIiwicnBjIiwiY2FsbCIsIl9wcmVmcyIsImdldFN0cmluZyIsIl9yZWFkeSIsIl9yZWZyZXNoSW50ZXJ2YWwiLCJkdXJhdGlvbiIsIl9yZWZyZXNoSW50ZXJ2YWxJZCIsInNldEludGVydmFsIiwiX2N1cnJlbnRGaWxlIiwiX2FkZGl0aW9uYWxQYXJhbXMiLCJfc2VwYXJhdG9yIiwiRGF0ZSIsImdldFRpbWUiLCJfcGxheWJhY2tFcnJvciIsIl9zdGFydE5vRmlsZVRpbWVyIiwic2V0VGltZW91dCIsIm5vU3RvcmFnZUZpbGUiLCJfbm9GaWxlRmxhZyIsIl9tZXNzYWdlIiwic2hvdyIsIl9mcmFtZUNvbnRyb2xsZXIiLCJyZW1vdmUiLCJfY3VycmVudEZyYW1lIiwiX3ZpZXdlclBhdXNlZCIsIm9uU3RvcmFnZUluaXQiLCJoaWRlIiwicGxheSIsIm9uU3RvcmFnZVJlZnJlc2giLCJwYXVzZSIsImZyYW1lT2JqIiwiZ2V0RnJhbWVPYmplY3QiLCJhZGQiLCJjcmVhdGVGcmFtZVBsYXllciIsInBsYXllckVuZGVkIiwicGxheWVyUmVhZHkiLCJfaXNTdG9yYWdlRmlsZSIsIl9yZWZyZXNoRHVyYXRpb24iLCJzdGFydFBsYXlsaXN0Q2hhbmdlVGltZXIiLCJfcGxheWxpc3RDaGFuZ2VUaW1lciIsImRpc3BsYXlJZCIsInZpZGVvVXJsIiwiJG1haW5JZnJhbWUiLCJhdHRyIiwieGxTdWl0ZVBsYXlsaXN0UmVmcmVzaER1cmF0aW9uIiwic2V0QWRkaXRpb25hbFBhcmFtcyIsIm5hbWVzIiwidmFsdWVzIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiSlNPTiIsInBhcnNlIiwiUHJlZnMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJoZWlnaHQiLCJnZXRJbnQiLCJ3aWR0aCIsIkNvbW1vbiIsIkZyYW1lQ29udHJvbGxlciIsInN0YXJ0WExTdWl0ZVBsYXllciIsInBsYXllckVycm9yIiwiZXJyb3IiLCJkZWJ1ZyIsInN0b3AiLCJTdG9yYWdlIiwiaW5pdCIsInN0b3JhZ2UiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImRldGFpbCIsIl9pbml0aWFsTG9hZCIsImhhc093blByb3BlcnR5IiwiY2hhbmdlZCIsInNldEF0dHJpYnV0ZSIsImZvbGRlciIsImZpbGVOYW1lIiwiY29tcGFueUlkIiwiZ28iLCJnZXRGcmFtZUNvbnRhaW5lciIsImluZGV4IiwiUFJFRklYIiwiaWZyYW1lIiwiZnJhbWVDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudFdpbmRvdyIsImNvbnRlbnREb2N1bWVudCIsIl9jbGVhciIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsInBhcmFtcyIsImZpbGVzIiwic2tpbiIsInNyYyIsIm9ubG9hZCIsImxvYWQiLCJ2aXNpYmlsaXR5IiwiY2FsbGJhY2siLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJNZXNzYWdlIiwibWFpbkNvbnRhaW5lciIsIm1lc3NhZ2VDb250YWluZXIiLCJfaW5pdCIsIndhcm4iLCJtZXNzYWdlIiwiX2FjdGl2ZSIsImRpc3BsYXkiLCJwIiwiZnJhZ21lbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwiaW5uZXJIVE1MIiwibGluZUhlaWdodCIsIndpbmRvdyIsInBvbHltZXJSZWFkeSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJpZCIsInJlZ2lzdGVyIiwicHJlZnMiLCJvbmNvbnRleHRtZW51IiwiX2dhcSIsInB1c2giLCJnYSIsInR5cGUiLCJhc3luYyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIl0sIm1hcHBpbmdzIjoiQUFpQkEsUUFBU0EsMEJBQXlCQyxFQUFZQyxFQUFpQkMsR0FDN0QsR0FBSUMsR0FBUyxzQ0FFYkMsU0FBUUMsSUFBSSxtQkFBb0JMLEdBRWhDTSxFQUFFQyxNQUNBQyxJQUFLLHlEQUEyREwsRUFBUyxnQ0FBa0NILElBQzFHUyxLQUFLLFNBQVVDLEdBQ2hCLElBQUtBLElBQVNBLEVBQUtDLE9BS2pCLE1BSkFQLFNBQVFDLElBQUksaUNBQWtDSyxHQUMxQ1IsR0FDRkEsSUFFRixNQUdGLElBQUlVLEdBQVlGLEVBQUtDLE9BQU9FLFdBRzVCVCxTQUFRQyxJQUFJLHFCQUFzQk8sRUFFbEMsSUFBSUUsR0FBVUYsRUFDWix3RUFLRlgsR0FBZ0JhLEtBMUNwQixHQUFzQixtQkFBWEMsUUFBd0IsQ0FDakMsR0FBSUEsU0FDRkMsS0FBTSxrQkFDTkMsWUFBYSxPQUdRLG9CQUFaQyxVQUNUQSxRQUFRQyxPQUFPLG9DQUNaQyxTQUFTLGlCQUFrQix3QkFDM0JBLFNBQVMsZ0JBQWlCLFNBMkNqQyxHQUFJQyxZQUFhQSxjQUNqQkEsWUFBV0MsU0FFWEQsV0FBV0MsTUFBUSxTQUFXQyxHQUM1QixZQWlDQSxTQUFTQyxLQUNQQyxhQUFhQyxHQUNiQSxFQUFlLEtBR2pCLFFBQVNDLEtBQ1BKLEVBQVFLLElBQUlDLEtBQUssR0FBSSxlQUFnQixLQUFNQyxFQUFPQyxVQUFVLE9BSTlELFFBQVNDLEtBQ1BULEVBQVFLLElBQUlDLEtBQUssR0FBSSxnQkFBaUIsS0FBTUMsRUFBT0MsVUFBVSxPQUMzRCxHQUFNLEdBQU0sR0FBTSxHQUFNLEdBRzVC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LElBRTdDRCxPQUFReEgsUUFLWCxJQUFJK0gsTUFBT0EsUUFFWEEsTUFBS0MsTUFBTSxjQUFlLGtCQUMxQkQsS0FBS0MsTUFBTSxtQkFFWCxXQUNFLEdBQUlDLEdBQUt0RSxTQUFTb0MsY0FBYyxTQUFXa0MsR0FBR0MsS0FBTyxrQkFBbUJELEVBQUdFLE9BQVEsRUFDbkZGLEVBQUc3QixLQUFPLFVBQVl6QyxTQUFTeUUsU0FBU0MsU0FBVyxjQUFnQixjQUFnQiw2QkFDbkYsSUFBSUMsR0FBSTNFLFNBQVM0RSxxQkFBcUIsVUFBVSxFQUFJRCxHQUFFRSxXQUFXQyxhQUFhUixFQUFJSyIsImZpbGUiOiJqcy93aWRnZXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGNvbmZpZzogdHJ1ZSAqL1xuLyogZXhwb3J0ZWQgY29uZmlnICovXG5pZiAodHlwZW9mIGNvbmZpZyA9PT0gXCJ1bmRlZmluZWRcIikge1xuICB2YXIgY29uZmlnID0ge1xuICAgIFNLSU46IFwic2tpbi9SVlNraW4ueG1sXCIsXG4gICAgU1RPUkFHRV9FTlY6IFwicHJvZFwiXG4gIH07XG5cbiAgaWYgKHR5cGVvZiBhbmd1bGFyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLmNvbW1vbi5pMThuLmNvbmZpZ1wiLCBbXSlcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfUFJFRklYXCIsIFwibG9jYWxlcy90cmFuc2xhdGlvbl9cIilcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfU1VGSVhcIiwgXCIuanNvblwiKTtcbiAgfVxufVxuXHJcbid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gbG9hZFZpZGVvTGlua0Zyb21YTFN1aXRlKGRpc3BsYXlLZXksIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xuICB2YXIgYXBpS2V5ID0gXCIyYWU0NWZjMi03MmI5LTQ1Y2UtOTc3MS1jYWYwZmFiZjljOTdcIjtcblxuICBjb25zb2xlLmxvZyhcImRpc3BsYXlLZXkgcGFyYW1cIiwgZGlzcGxheUtleSk7XG5cbiAgJC5hamF4KHtcbiAgICB1cmw6IFwiaHR0cHM6Ly9ybi54bHN1aXRlLmNvbS9hZG1pbi9hcGkvbGlxdWlkcy9jYWxsP2FwaV9rZXk9XCIgKyBhcGlLZXkgKyBcIiZ0YWc9bG9hZF9zY3JlZW4mZGlzcGxheV9rZXk9XCIgKyBkaXNwbGF5S2V5XG4gIH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICBpZiAoIWRhdGEgfHwgIWRhdGEuc2NyZWVuKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkVycm9yIC0gUmV0dXJuZWQgZGF0YSBpcyBlbXB0eVwiLCBkYXRhKTtcbiAgICAgIGlmIChlcnJvckNhbGxiYWNrKSB7XG4gICAgICAgIGVycm9yQ2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgY2hhbmVsVXJsID0gZGF0YS5zY3JlZW4uY2hhbm5lbF91cmw7XG5cbiAgICAvL3RvZG86IHNhdmUgY2hhbm5lbCBVUkwgdG8gc29tZSBzZXR0aW5ncyAvIHZhcmlhYmxlXG4gICAgY29uc29sZS5sb2coXCJMb2FkZWQgY2hhbm5lbCBVUkxcIiwgY2hhbmVsVXJsKTtcblxuICAgIHZhciBmdWxsVXJsID0gY2hhbmVsVXJsICtcbiAgICAgIFwiJmFtcDthdXRvcGxheT0xXCIgK1xuICAgICAgXCImYW1wO2xvb3A9MVwiICtcbiAgICAgIFwiJmFtcDtjb250cm9scz0wXCIgK1xuICAgICAgXCImYW1wO3Nob3dpbmZvPTAgZnJhbWVib3JkZXI9MFwiO1xuXG4gICAgc3VjY2Vzc0NhbGxiYWNrKGZ1bGxVcmwpO1xuXG4gICAgLy9STiAtIGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkL3ZpZGVvc2VyaWVzP2xpc3Q9UExuNTZWYnhPUzc3ZmQtcWJadzBtdm5TMlBtX190dlNIWlxuICAgIC8vbXkgLSBodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC92aWRlb3Nlcmllcz9saXN0PVBMNDhaR3dDcHdQeUZWaUVMZ3NudlVrblJ6SnlvMmdPaEFcbiAgfSk7XG5cbn1cblxyXG4vKiBnbG9iYWwgZ2FkZ2V0cywgY29uZmlnICovXG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW8gPSB7fTtcblxuUmlzZVZpc2lvbi5WaWRlbyA9IChmdW5jdGlvbiAoZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2FkZGl0aW9uYWxQYXJhbXM7XG5cbiAgdmFyIF9wcmVmcyA9IG51bGwsXG4gICAgX3N0b3JhZ2UgPSBudWxsLFxuICAgIF9tZXNzYWdlID0gbnVsbCxcbiAgICBfZnJhbWVDb250cm9sbGVyID0gbnVsbDtcblxuICB2YXIgX3BsYXliYWNrRXJyb3IgPSBmYWxzZSxcbiAgICBfaXNTdG9yYWdlRmlsZSA9IGZhbHNlLFxuICAgIF92aWV3ZXJQYXVzZWQgPSB0cnVlO1xuXG4gIHZhciBfY3VycmVudEZyYW1lID0gMDtcblxuICB2YXIgX3NlcGFyYXRvciA9IFwiXCIsXG4gICAgX2N1cnJlbnRGaWxlID0gXCJcIjtcblxuICB2YXIgZGlzcGxheUlkO1xuXG4gIHZhciBfcmVmcmVzaER1cmF0aW9uID0gOTAwMDAwLCAgLy8gMTUgbWludXRlc1xuICAgIF9yZWZyZXNoSW50ZXJ2YWxJZCA9IG51bGw7XG5cbiAgdmFyIHhsU3VpdGVQbGF5bGlzdFJlZnJlc2hEdXJhdGlvbiA9IDUwMDA7IC8vNSBzZWNcblxuICB2YXIgX25vRmlsZVRpbWVyID0gbnVsbCxcbiAgICBfbm9GaWxlRmxhZyA9IGZhbHNlO1xuXG4gIHZhciBfcGxheWxpc3RDaGFuZ2VUaW1lciA9IG51bGw7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX2NsZWFyTm9GaWxlVGltZXIoKSB7XG4gICAgY2xlYXJUaW1lb3V0KF9ub0ZpbGVUaW1lcik7XG4gICAgX25vRmlsZVRpbWVyID0gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9kb25lKCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X2RvbmVcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpKTtcblxuICB9XG5cbiAgZnVuY3Rpb24gX3JlYWR5KCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X3JlYWR5XCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSxcbiAgICAgIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gX3JlZnJlc2hJbnRlcnZhbChkdXJhdGlvbikge1xuICAgIF9yZWZyZXNoSW50ZXJ2YWxJZCA9IHNldEludGVydmFsKGZ1bmN0aW9uIHZpZGVvUmVmcmVzaCgpIHtcbiAgICAgIC8vIHNldCBuZXcgdmFsdWUgb2Ygbm9uIHJpc2Utc3RvcmFnZSB1cmwgd2l0aCBhIGNhY2hlYnVzdGVyXG4gICAgICBfY3VycmVudEZpbGUgPSBfYWRkaXRpb25hbFBhcmFtcy51cmwgKyBfc2VwYXJhdG9yICsgXCJjYj1cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuXG4gICAgICAvLyBpbiBjYXNlIHJlZnJlc2hlZCBmaWxlIGZpeGVzIGFuIGVycm9yIHdpdGggcHJldmlvdXMgZmlsZSwgZW5zdXJlIGZsYWcgaXMgcmVtb3ZlZCBzbyBwbGF5YmFjayBpcyBhdHRlbXB0ZWQgYWdhaW5cbiAgICAgIF9wbGF5YmFja0Vycm9yID0gZmFsc2U7XG5cbiAgICB9LCBkdXJhdGlvbik7XG4gIH1cblxuICBmdW5jdGlvbiBfc3RhcnROb0ZpbGVUaW1lcigpIHtcbiAgICBfY2xlYXJOb0ZpbGVUaW1lcigpO1xuXG4gICAgX25vRmlsZVRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBub3RpZnkgVmlld2VyIHdpZGdldCBpcyBkb25lXG4gICAgICBfZG9uZSgpO1xuICAgIH0sIDUwMDApO1xuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBub1N0b3JhZ2VGaWxlKCkge1xuICAgIF9ub0ZpbGVGbGFnID0gdHJ1ZTtcbiAgICBfY3VycmVudEZpbGUgPSBcIlwiO1xuXG4gICAgX21lc3NhZ2Uuc2hvdyhcIlRoZSBzZWxlY3RlZCB2aWRlbyBkb2VzIG5vdCBleGlzdC5cIik7XG5cbiAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShfY3VycmVudEZyYW1lLCBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBpZiBXaWRnZXQgaXMgcGxheWluZyByaWdodCBub3csIHJ1biB0aGUgdGltZXJcbiAgICAgIGlmICghX3ZpZXdlclBhdXNlZCkge1xuICAgICAgICBfc3RhcnROb0ZpbGVUaW1lcigpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gb25TdG9yYWdlSW5pdCh1cmwpIHtcbiAgICBfY3VycmVudEZpbGUgPSB1cmw7XG5cbiAgICBfbWVzc2FnZS5oaWRlKCk7XG5cbiAgICBpZiAoIV92aWV3ZXJQYXVzZWQpIHtcbiAgICAgIHBsYXkoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBvblN0b3JhZ2VSZWZyZXNoKHVybCkge1xuICAgIF9jdXJyZW50RmlsZSA9IHVybDtcblxuICAgIC8vIGluIGNhc2UgcmVmcmVzaGVkIGZpbGUgZml4ZXMgYW4gZXJyb3Igd2l0aCBwcmV2aW91cyBmaWxlLCBlbnN1cmUgZmxhZyBpcyByZW1vdmVkIHNvIHBsYXliYWNrIGlzIGF0dGVtcHRlZCBhZ2FpblxuICAgIF9wbGF5YmFja0Vycm9yID0gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICB2YXIgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuXG4gICAgX3ZpZXdlclBhdXNlZCA9IHRydWU7XG5cbiAgICBpZiAoX25vRmlsZUZsYWcpIHtcbiAgICAgIF9jbGVhck5vRmlsZVRpbWVyKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICBmcmFtZU9iai5wYXVzZSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gIC8vICBjb25zb2xlLmxvZyhcIlBsYXkgZXZlbnQgXCIpO1xuICAgIHZhciBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICBfdmlld2VyUGF1c2VkID0gZmFsc2U7XG5cbiAgICBpZiAoX25vRmlsZUZsYWcpIHtcbiAgICAgIF9zdGFydE5vRmlsZVRpbWVyKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCFfcGxheWJhY2tFcnJvcikge1xuICAgICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICAgIGZyYW1lT2JqLnBsYXkoKTtcbiAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgaWYgKF9jdXJyZW50RmlsZSAmJiBfY3VycmVudEZpbGUgIT09IFwiXCIpIHtcbiAgICAgICAgICAvLyBhZGQgZnJhbWUgYW5kIGNyZWF0ZSB0aGUgcGxheWVyXG4gICAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5hZGQoMCk7XG4gICAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcigwLCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlLCBjb25maWcuU0tJTiwgXCJwbGF5ZXIuaHRtbFwiKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRoaXMgZmxhZyBvbmx5IGdvdCBzZXQgdXBvbiBhIHJlZnJlc2ggb2YgaGlkZGVuIGZyYW1lIGFuZCB0aGVyZSB3YXMgYW4gZXJyb3IgaW4gc2V0dXAgb3IgdmlkZW9cbiAgICAgIC8vIFNlbmQgVmlld2VyIFwiZG9uZVwiXG4gICAgICBfZG9uZSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllckVuZGVkKCkge1xuICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKF9jdXJyZW50RnJhbWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgIF9kb25lKCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJSZWFkeSgpIHtcbiAgICB2YXIgZnJhbWVPYmo7XG5cbiAgICAvLyBub24tc3RvcmFnZSwgY2hlY2sgaWYgcmVmcmVzaCBpbnRlcnZhbCBleGlzdHMgeWV0LCBzdGFydCBpdCBpZiBub3RcbiAgICBpZiAoIV9pc1N0b3JhZ2VGaWxlICYmIF9yZWZyZXNoSW50ZXJ2YWxJZCA9PT0gbnVsbCkge1xuICAgICAgX3JlZnJlc2hJbnRlcnZhbChfcmVmcmVzaER1cmF0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAoIV92aWV3ZXJQYXVzZWQpIHtcbiAgICAgIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcbiAgICAgIGZyYW1lT2JqLnBsYXkoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzdGFydFBsYXlsaXN0Q2hhbmdlVGltZXIoKSB7XG4gICAgY2xlYXJUaW1lb3V0KF9wbGF5bGlzdENoYW5nZVRpbWVyKTtcblxuICAgIF9wbGF5bGlzdENoYW5nZVRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgY29uc29sZS5sb2coXCJJbnRlcnZhbCBjaGVja1wiKTtcblxuICAgICAgbG9hZFZpZGVvTGlua0Zyb21YTFN1aXRlKGRpc3BsYXlJZCwgZnVuY3Rpb24gKHZpZGVvVXJsKSB7XG4gICAgICAgIGlmICh2aWRlb1VybCAhPSBfY3VycmVudEZpbGUpIHtcbiAgICAgICAgICBfY3VycmVudEZpbGUgPSB2aWRlb1VybDtcbiAgICAgICAgICB2YXIgJG1haW5JZnJhbWUgPSAkKCcjbWFpbklmcmFtZScpO1xuICAgICAgICAgICRtYWluSWZyYW1lLmF0dHIoJ3NyYycsIF9jdXJyZW50RmlsZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgfSwgeGxTdWl0ZVBsYXlsaXN0UmVmcmVzaER1cmF0aW9uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldEFkZGl0aW9uYWxQYXJhbXMobmFtZXMsIHZhbHVlcykge1xuICAgIGNvbnNvbGUubG9nKFwiYWRkaXRpb25hbCBwYXJhbXMgdmFsdWVzXCIsIHZhbHVlcyk7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZXMpICYmIG5hbWVzLmxlbmd0aCA+IDAgJiYgbmFtZXNbMF0gPT09IFwiYWRkaXRpb25hbFBhcmFtc1wiKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpICYmIHZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gSlNPTi5wYXJzZSh2YWx1ZXNbMF0pO1xuICAgICAgICBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpO1xuXG4gICAgICAgIGlmICghX2FkZGl0aW9uYWxQYXJhbXMpIHtcbiAgICAgICAgICBfYWRkaXRpb25hbFBhcmFtcyA9IHt9O1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiYWRkaXRpb25hbCBwYXJhbXMgcmVjcmVhdGVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKS5zdHlsZS5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpICsgXCJweFwiO1xuXG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLndpZHRoID0gX3ByZWZzLmdldEludChcInJzV1wiKTtcbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKTtcblxuICAgICAgICBfZnJhbWVDb250cm9sbGVyID0gbmV3IFJpc2VWaXNpb24uQ29tbW9uLlZpZGVvLkZyYW1lQ29udHJvbGxlcigpO1xuXG4gICAgICAgIF9pc1N0b3JhZ2VGaWxlID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKF9wcmVmcy5nZXRTdHJpbmcoXCJkaXNwbGF5SWRcIikpIHtcbiAgICAgICAgICBkaXNwbGF5SWQgPSBfcHJlZnMuZ2V0U3RyaW5nKFwiZGlzcGxheUlkXCIpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiZGlzcGxheUlkIHNldCBmcm9tIGNocm9tZUFwcCBwYXJhbVwiLCBkaXNwbGF5SWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpc3BsYXlJZCA9IF9hZGRpdGlvbmFsUGFyYW1zLmRpc3BsYXlJZDtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcImRpc3BsYXlJZCBzZXQgZnJvbSBkZWZhdWx0IHNldHRpbmdzXCIsIGRpc3BsYXlJZCk7XG4gICAgICAgIH1cblxuICAgICAgICBsb2FkVmlkZW9MaW5rRnJvbVhMU3VpdGUoZGlzcGxheUlkLCBzdGFydFhMU3VpdGVQbGF5ZXIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmIChkaXNwbGF5SWQgIT0gX3ByZWZzLmdldFN0cmluZyhcImRpc3BsYXlJZFwiKSkge1xuICAgICAgICAgICAgZGlzcGxheUlkID0gX2FkZGl0aW9uYWxQYXJhbXMuZGlzcGxheUlkO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJUcnlpbmcgdG8gdXNlIGRlZmF1bHQgZGlzcGxheUlkXCIsIGRpc3BsYXlJZCk7XG4gICAgICAgICAgICBsb2FkVmlkZW9MaW5rRnJvbVhMU3VpdGUoZGlzcGxheUlkLCBzdGFydFhMU3VpdGVQbGF5ZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gc3RhcnRYTFN1aXRlUGxheWVyKHZpZGVvVXJsKSB7XG4gICAgX2N1cnJlbnRGaWxlID0gdmlkZW9Vcmw7XG5cbiAgICB2YXIgJG1haW5JZnJhbWUgPSAkKCcjbWFpbklmcmFtZScpO1xuICAgICRtYWluSWZyYW1lLmF0dHIoJ3NyYycsIF9jdXJyZW50RmlsZSk7XG4gICAgJG1haW5JZnJhbWUuYXR0cignd2lkdGgnLCBfYWRkaXRpb25hbFBhcmFtcy53aWR0aCk7XG4gICAgJG1haW5JZnJhbWUuYXR0cignaGVpZ2h0JywgX2FkZGl0aW9uYWxQYXJhbXMuaGVpZ2h0KTtcblxuICAgIHN0YXJ0UGxheWxpc3RDaGFuZ2VUaW1lcigpO1xuXG4gICAgX3JlYWR5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFcnJvcihlcnJvcikge1xuICAgIGNvbnNvbGUuZGVidWcoXCJ2aWRlby1mb2xkZXI6OnBsYXllckVycm9yKClcIiwgZXJyb3IpO1xuXG4gICAgLy8gZmxhZyB0aGUgdmlkZW8gaGFzIGFuIGVycm9yXG4gICAgX3BsYXliYWNrRXJyb3IgPSB0cnVlO1xuXG4gICAgLy8gYWN0IGFzIHRob3VnaCB2aWRlbyBoYXMgZW5kZWRcbiAgICBwbGF5ZXJFbmRlZCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBwYXVzZSgpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcIm5vU3RvcmFnZUZpbGVcIjogbm9TdG9yYWdlRmlsZSxcbiAgICBcIm9uU3RvcmFnZUluaXRcIjogb25TdG9yYWdlSW5pdCxcbiAgICBcIm9uU3RvcmFnZVJlZnJlc2hcIjogb25TdG9yYWdlUmVmcmVzaCxcbiAgICBcInBhdXNlXCI6IHBhdXNlLFxuICAgIFwicGxheVwiOiBwbGF5LFxuICAgIFwic2V0QWRkaXRpb25hbFBhcmFtc1wiOiBzZXRBZGRpdGlvbmFsUGFyYW1zLFxuICAgIFwicGxheWVyRW5kZWRcIjogcGxheWVyRW5kZWQsXG4gICAgXCJwbGF5ZXJSZWFkeVwiOiBwbGF5ZXJSZWFkeSxcbiAgICBcInBsYXllckVycm9yXCI6IHBsYXllckVycm9yLFxuICAgIFwic3RvcFwiOiBzdG9wXG4gIH07XG5cbn0pKGdhZGdldHMpO1xuXHJcbi8qIGdsb2JhbCBjb25maWcgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlbyA9IFJpc2VWaXNpb24uVmlkZW8gfHwge307XG5cblJpc2VWaXNpb24uVmlkZW8uU3RvcmFnZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfaW5pdGlhbExvYWQgPSB0cnVlO1xuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICB2YXIgc3RvcmFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9TdG9yYWdlXCIpO1xuXG4gICAgaWYgKCFzdG9yYWdlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGlmIChlLmRldGFpbCAmJiBlLmRldGFpbC51cmwpIHtcblxuICAgICAgICBpZiAoX2luaXRpYWxMb2FkKSB7XG4gICAgICAgICAgX2luaXRpYWxMb2FkID0gZmFsc2U7XG5cbiAgICAgICAgICBSaXNlVmlzaW9uLlZpZGVvLm9uU3RvcmFnZUluaXQoZS5kZXRhaWwudXJsKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAvLyBjaGVjayBmb3IgXCJjaGFuZ2VkXCIgcHJvcGVydHkgYW5kIGVuc3VyZSBpdCBpcyB0cnVlXG4gICAgICAgICAgaWYgKGUuZGV0YWlsLmhhc093blByb3BlcnR5KFwiY2hhbmdlZFwiKSAmJiBlLmRldGFpbC5jaGFuZ2VkKSB7XG4gICAgICAgICAgICBSaXNlVmlzaW9uLlZpZGVvLm9uU3RvcmFnZVJlZnJlc2goZS5kZXRhaWwudXJsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1uby1maWxlXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby5ub1N0b3JhZ2VGaWxlKCk7XG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBkYXRhLnN0b3JhZ2UuZm9sZGVyKTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZpbGVOYW1lXCIsIGRhdGEuc3RvcmFnZS5maWxlTmFtZSk7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgZGF0YS5zdG9yYWdlLmNvbXBhbnlJZCk7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJlbnZcIiwgY29uZmlnLlNUT1JBR0VfRU5WKTtcbiAgICBzdG9yYWdlLmdvKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaW5pdFwiOiBpbml0XG4gIH07XG59O1xuXHJcbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcclxuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcclxuXHJcblJpc2VWaXNpb24uQ29tbW9uLlZpZGVvID0gUmlzZVZpc2lvbi5Db21tb24uVmlkZW8gfHwge307XHJcblxyXG5SaXNlVmlzaW9uLkNvbW1vbi5WaWRlby5GcmFtZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gIHZhciBQUkVGSVggPSBcImlmX1wiO1xyXG5cclxuICBmdW5jdGlvbiBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCkge1xyXG4gICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGdldEZyYW1lT2JqZWN0KGluZGV4KSB7XHJcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXHJcbiAgICAgIGlmcmFtZTtcclxuXHJcbiAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xyXG5cclxuICAgIGlmIChpZnJhbWUpIHtcclxuICAgICAgcmV0dXJuIChpZnJhbWUuY29udGVudFdpbmRvdykgPyBpZnJhbWUuY29udGVudFdpbmRvdyA6XHJcbiAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBfY2xlYXIoaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcclxuICAgICAgZnJhbWVPYmogPSBnZXRGcmFtZU9iamVjdChpbmRleCksXHJcbiAgICAgIGlmcmFtZTtcclxuXHJcbiAgICBpZiAoZnJhbWVPYmopIHtcclxuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcclxuICAgICAgZnJhbWVPYmoucmVtb3ZlKCk7XHJcbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgXCJhYm91dDpibGFua1wiKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGFkZChpbmRleCkge1xyXG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxyXG4gICAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpO1xyXG5cclxuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJhbGxvd1RyYW5zcGFyZW5jeVwiLCB0cnVlKTtcclxuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJmcmFtZWJvcmRlclwiLCBcIjBcIik7XHJcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic2Nyb2xsaW5nXCIsIFwibm9cIik7XHJcblxyXG4gICAgZnJhbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGNyZWF0ZUZyYW1lUGxheWVyKGluZGV4LCBwYXJhbXMsIGZpbGVzLCBza2luLCBzcmMpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcclxuICAgICAgZnJhbWVPYmogPSBnZXRGcmFtZU9iamVjdChpbmRleCksXHJcbiAgICAgIGlmcmFtZTtcclxuXHJcbiAgICBpZiAoZnJhbWVPYmopIHtcclxuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcclxuXHJcbiAgICAgIGlmcmFtZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWZyYW1lLm9ubG9hZCA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGluaXRpYWxpemUgYW5kIGxvYWQgdGhlIHBsYXllciBpbnNpZGUgdGhlIGlmcmFtZVxyXG4gICAgICAgIGZyYW1lT2JqLmluaXQocGFyYW1zLCBmaWxlcywgc2tpbik7XHJcbiAgICAgICAgZnJhbWVPYmoubG9hZCgpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBzcmMpO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGhpZGUoaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KTtcclxuXHJcbiAgICBmcmFtZUNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHJlbW92ZShpbmRleCwgY2FsbGJhY2spIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcclxuXHJcbiAgICBfY2xlYXIoaW5kZXgpO1xyXG5cclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAvLyByZW1vdmUgdGhlIGlmcmFtZSBieSBjbGVhcmluZyBhbGwgZWxlbWVudHMgaW5zaWRlIGRpdiBjb250YWluZXJcclxuICAgICAgd2hpbGUgKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpIHtcclxuICAgICAgICBmcmFtZUNvbnRhaW5lci5yZW1vdmVDaGlsZChmcmFtZUNvbnRhaW5lci5maXJzdENoaWxkKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGNhbGxiYWNrICYmIHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgfVxyXG4gICAgfSwgMjAwKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNob3coaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KTtcclxuXHJcbiAgICBmcmFtZUNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgYWRkOiBhZGQsXHJcbiAgICBjcmVhdGVGcmFtZVBsYXllcjogY3JlYXRlRnJhbWVQbGF5ZXIsXHJcbiAgICBnZXRGcmFtZUNvbnRhaW5lcjogZ2V0RnJhbWVDb250YWluZXIsXHJcbiAgICBnZXRGcmFtZU9iamVjdDogZ2V0RnJhbWVPYmplY3QsXHJcbiAgICBoaWRlOiBoaWRlLFxyXG4gICAgcmVtb3ZlOiByZW1vdmUsXHJcbiAgICBzaG93OiBzaG93XHJcbiAgfTtcclxufTtcclxuXHJcbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcclxuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcclxuXHJcblJpc2VWaXNpb24uQ29tbW9uLk1lc3NhZ2UgPSBmdW5jdGlvbiAobWFpbkNvbnRhaW5lciwgbWVzc2FnZUNvbnRhaW5lcikge1xyXG4gIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICB2YXIgX2FjdGl2ZSA9IGZhbHNlO1xyXG5cclxuICBmdW5jdGlvbiBfaW5pdCgpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gbWFpbkNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihcIkNhbid0IGluaXRpYWxpemUgTWVzc2FnZSAtIFwiLCBlLm1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiAgUHVibGljIE1ldGhvZHNcclxuICAgKi9cclxuICBmdW5jdGlvbiBoaWRlKCkge1xyXG4gICAgaWYgKF9hY3RpdmUpIHtcclxuICAgICAgLy8gY2xlYXIgY29udGVudCBvZiBtZXNzYWdlIGNvbnRhaW5lclxyXG4gICAgICB3aGlsZSAobWVzc2FnZUNvbnRhaW5lci5maXJzdENoaWxkKSB7XHJcbiAgICAgICAgbWVzc2FnZUNvbnRhaW5lci5yZW1vdmVDaGlsZChtZXNzYWdlQ29udGFpbmVyLmZpcnN0Q2hpbGQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBoaWRlIG1lc3NhZ2UgY29udGFpbmVyXHJcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG5cclxuICAgICAgLy8gc2hvdyBtYWluIGNvbnRhaW5lclxyXG4gICAgICBtYWluQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcclxuXHJcbiAgICAgIF9hY3RpdmUgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNob3cobWVzc2FnZSkge1xyXG4gICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLFxyXG4gICAgICBwO1xyXG5cclxuICAgIGlmICghX2FjdGl2ZSkge1xyXG4gICAgICAvLyBoaWRlIG1haW4gY29udGFpbmVyXHJcbiAgICAgIG1haW5Db250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XHJcblxyXG4gICAgICBtZXNzYWdlQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcblxyXG4gICAgICAvLyBjcmVhdGUgbWVzc2FnZSBlbGVtZW50XHJcbiAgICAgIHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcclxuICAgICAgcC5pbm5lckhUTUwgPSBtZXNzYWdlO1xyXG4gICAgICBwLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwibWVzc2FnZVwiKTtcclxuICAgICAgcC5zdHlsZS5saW5lSGVpZ2h0ID0gbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7XHJcblxyXG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChwKTtcclxuICAgICAgbWVzc2FnZUNvbnRhaW5lci5hcHBlbmRDaGlsZChmcmFnbWVudCk7XHJcblxyXG4gICAgICBfYWN0aXZlID0gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIG1lc3NhZ2UgYWxyZWFkeSBiZWluZyBzaG93biwgdXBkYXRlIG1lc3NhZ2UgdGV4dFxyXG4gICAgICBwID0gbWVzc2FnZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiLm1lc3NhZ2VcIik7XHJcbiAgICAgIHAuaW5uZXJIVE1MID0gbWVzc2FnZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9pbml0KCk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBcImhpZGVcIjogaGlkZSxcclxuICAgIFwic2hvd1wiOiBzaG93XHJcbiAgfTtcclxufTtcclxuXHJcbi8qIGdsb2JhbCBnYWRnZXRzLCBSaXNlVmlzaW9uICovXG5cbihmdW5jdGlvbiAod2luZG93LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBwcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCksXG4gICAgaWQgPSBwcmVmcy5nZXRTdHJpbmcoXCJpZFwiKTtcblxuICAvLyBEaXNhYmxlIGNvbnRleHQgbWVudSAocmlnaHQgY2xpY2sgbWVudSlcbiAgd2luZG93Lm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5wbGF5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8uc3RvcCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9seW1lclJlYWR5KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbiAgICBpZiAoaWQgJiYgaWQgIT09IFwiXCIpIHtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGxheV9cIiArIGlkLCBwbGF5KTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGF1c2VfXCIgKyBpZCwgcGF1c2UpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9zdG9wX1wiICsgaWQsIHN0b3ApO1xuXG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzcGFyYW1fc2V0X1wiICsgaWQsIFJpc2VWaXNpb24uVmlkZW8uc2V0QWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNwYXJhbV9nZXRcIiwgbnVsbCwgaWQsIFtcImFkZGl0aW9uYWxQYXJhbXNcIl0pO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXHJcbi8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbnZhciBfZ2FxID0gX2dhcSB8fCBbXTtcblxuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNTcwOTIxNTktMiddKTtcbl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pO1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOyBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IGdhLmFzeW5jID0gdHJ1ZTtcbiAgZ2Euc3JjID0gKCdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID8gJ2h0dHBzOi8vc3NsJyA6ICdodHRwOi8vd3d3JykgKyAnLmdvb2dsZS1hbmFseXRpY3MuY29tL2dhLmpzJztcbiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07IHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpO1xufSkoKTtcbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
