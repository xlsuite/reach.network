function loadVideoLinkFromXLSuite(e,t,i){var n="2ae45fc2-72b9-45ce-9771-caf0fabf9c97";console.log("displayKey param",e),$.ajax({url:"https://rn.xlsuite.com/admin/api/liquids/call?api_key="+n+"&tag=load_screen&display_key="+e}).then(function(e){if(!e||!e.screen)return console.log("Error - Returned data is empty",e),i&&i(),void 0;var n=e.screen.channel_url;console.log("Loaded channel URL",n);var o=n+"&amp;autoplay=1&amp;controls=0&amp;showinfo=0 frameborder=0";t(o)})}if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml",STORAGE_ENV:"prod"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e){"use strict";function t(){clearTimeout(k),k=null}function i(){e.rpc.call("","rsevent_done",null,R.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,R.getString("id"),!0,!0,!0,!0,!0)}function o(e){F=setInterval(function(){w=h.url+E+"cb="+(new Date).getTime(),I=!1},e)}function r(){t(),k=setTimeout(function(){i()},5e3)}function s(){P=!0,w="",b.show("The selected video does not exist."),S.remove(A,function(){_||r()})}function a(e){w=e,b.hide(),_||d()}function l(e){w=e,I=!1}function c(){var e=S.getFrameObject(A);return _=!0,P?(t(),void 0):(e&&e.pause(),void 0)}function d(){var e=S.getFrameObject(A);return _=!1,P?(r(),void 0):(I?i():e?e.play():w&&""!==w&&(S.add(0),S.createFramePlayer(0,h,w,config.SKIN,"player.html")),void 0)}function u(){S.remove(A,function(){i()})}function m(){var e;C||null!==F||o(L),_||(e=S.getFrameObject(A),e.play())}function f(){clearTimeout(O),O=setInterval(function(){console.log("Interval check"),loadVideoLinkFromXLSuite(V,function(e){if(e!=w){w=e;var t=$("#mainIframe");t.attr("src",w)}})},T)}function g(t,i){Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(i)&&i.length>0&&(h=JSON.parse(i[0]),R=new e.Prefs,document.getElementById("videoContainer").style.height=R.getInt("rsH")+"px",h.width=R.getInt("rsW"),h.height=R.getInt("rsH"),S=new RiseVision.Common.Video.FrameController,C=!1,R.getString("displayId")?(V=R.getString("displayId"),console.log("displayId set from chromeApp param",V)):(V=h.displayId,console.log("displayId set from default settings",V)),loadVideoLinkFromXLSuite(V,p,function(){V!=R.getString("displayId")&&(V=h.displayId,console.log("Trying to use default displayId",V),loadVideoLinkFromXLSuite(V,p))}))}function p(e){w=e;var t=$("#mainIframe");t.attr("src",w),t.attr("width",h.width),t.attr("height",h.height),f(),n()}function y(e){console.debug("video-folder::playerError()",e),I=!0,u()}function v(){c()}var h,V,R=null,b=null,S=null,I=!1,C=!1,_=!0,A=0,E="",w="",L=9e5,F=null,T=5e3,k=null,P=!1,O=null;return{noStorageFile:s,onStorageInit:a,onStorageRefresh:l,pause:c,play:d,setAdditionalParams:g,playerEnded:u,playerReady:m,playerError:y,stop:v}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoStorage");t&&(t.addEventListener("rise-storage-response",function(e){e.detail&&e.detail.url&&(i?(i=!1,RiseVision.Video.onStorageInit(e.detail.url)):e.detail.hasOwnProperty("changed")&&e.detail.changed&&RiseVision.Video.onStorageRefresh(e.detail.url))}),t.addEventListener("rise-storage-no-file",function(){RiseVision.Video.noStorageFile()}),t.setAttribute("folder",e.storage.folder),t.setAttribute("fileName",e.storage.fileName),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("env",config.STORAGE_ENV),t.go())}var i=!0;return{init:t}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function e(e){return document.getElementById(l+e)}function t(t){var i,n=e(t);return i=n.querySelector("iframe"),i?i.contentWindow?i.contentWindow:i.contentDocument.document?i.contentDocument.document:i.contentDocument:null}function i(i){var n,o=e(i),r=t(i);r&&(n=o.querySelector("iframe"),r.remove(),n.setAttribute("src","about:blank"))}function n(t){var i=e(t),n=document.createElement("iframe");n.setAttribute("allowTransparency",!0),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),i.appendChild(n)}function o(i,n,o,r,s){var a,l=e(i),c=t(i);c&&(a=l.querySelector("iframe"),a.onload=function(){a.onload=null,c.init(n,o,r),c.load()},a.setAttribute("src",s))}function r(t){var i=e(t);i.style.visibility="hidden"}function s(e,t){var n=document.getElementById(l+e);i(e),setTimeout(function(){for(;n.firstChild;)n.removeChild(n.firstChild);t&&"function"==typeof t&&t()},200)}function a(t){var i=e(t);i.style.visibility="visible"}var l="if_";return{add:n,createFramePlayer:o,getFrameContainer:e,getFrameObject:t,hide:r,remove:s,show:a}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Message=function(e,t){"use strict";function i(){try{t.style.height=e.style.height}catch(i){console.warn("Can't initialize Message - ",i.message)}}function n(){if(r){for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none",e.style.visibility="visible",r=!1}}function o(i){var n,o=document.createDocumentFragment();r?(n=t.querySelector(".message"),n.innerHTML=i):(e.style.visibility="hidden",t.style.display="block",n=document.createElement("p"),n.innerHTML=i,n.setAttribute("class","message"),n.style.lineHeight=t.style.height,o.appendChild(n),t.appendChild(o),r=!0)}var r=!1;return i(),{hide:n,show:o}},function(e,t){"use strict";function i(){RiseVision.Video.play()}function n(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function r(){e.removeEventListener("WebComponentsReady",r),a&&""!==a&&(t.rpc.register("rscmd_play_"+a,i),t.rpc.register("rscmd_pause_"+a,n),t.rpc.register("rscmd_stop_"+a,o),t.rpc.register("rsparam_set_"+a,RiseVision.Video.setAdditionalParams),t.rpc.call("","rsparam_get",null,a,["additionalParams"]))}var s=new t.Prefs,a=s.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("WebComponentsReady",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsibG9hZFZpZGVvTGlua0Zyb21YTFN1aXRlIiwiZGlzcGxheUtleSIsInN1Y2Nlc3NDYWxsYmFjayIsImVycm9yQ2FsbGJhY2siLCJhcGlLZXkiLCJjb25zb2xlIiwibG9nIiwiJCIsImFqYXgiLCJ1cmwiLCJ0aGVuIiwiZGF0YSIsInNjcmVlbiIsImNoYW5lbFVybCIsImNoYW5uZWxfdXJsIiwiZnVsbFVybCIsImNvbmZpZyIsIlNLSU4iLCJTVE9SQUdFX0VOViIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIlJpc2VWaXNpb24iLCJWaWRlbyIsImdhZGdldHMiLCJfY2xlYXJOb0ZpbGVUaW1lciIsImNsZWFyVGltZW91dCIsIl9ub0ZpbGVUaW1lciIsIl9kb25lIiwicnBjIiwiY2FsbCIsIl9wcmVmcyIsImdldFN0cmluZyIsIl9yZWFkeSIsIl9yZWZyZXNoSW50ZXJ2YWwiLCJkdXJhdGlvbiIsIl9yZWZyZXNoSW50ZXJ2YWxJZCIsInNldEludGVydmFsIiwiX2N1cnJlbnRGaWxlIiwiX2FkZGl0aW9uYWxQYXJhbXMiLCJfc2VwYXJhdG9yIiwiRGF0ZSIsImdldFRpbWUiLCJfcGxheWJhY2tFcnJvciIsIl9zdGFydE5vRmlsZVRpbWVyIiwic2V0VGltZW91dCIsIm5vU3RvcmFnZUZpbGUiLCJfbm9GaWxlRmxhZyIsIl9tZXNzYWdlIiwic2hvdyIsIl9mcmFtZUNvbnRyb2xsZXIiLCJyZW1vdmUiLCJfY3VycmVudEZyYW1lIiwiX3ZpZXdlclBhdXNlZCIsIm9uU3RvcmFnZUluaXQiLCJoaWRlIiwicGxheSIsIm9uU3RvcmFnZVJlZnJlc2giLCJwYXVzZSIsImZyYW1lT2JqIiwiZ2V0RnJhbWVPYmplY3QiLCJhZGQiLCJjcmVhdGVGcmFtZVBsYXllciIsInBsYXllckVuZGVkIiwicGxheWVyUmVhZHkiLCJfaXNTdG9yYWdlRmlsZSIsIl9yZWZyZXNoRHVyYXRpb24iLCJzdGFydFBsYXlsaXN0Q2hhbmdlVGltZXIiLCJfcGxheWxpc3RDaGFuZ2VUaW1lciIsImRpc3BsYXlJZCIsInZpZGVvVXJsIiwiJG1haW5JZnJhbWUiLCJhdHRyIiwieGxTdWl0ZVBsYXlsaXN0UmVmcmVzaER1cmF0aW9uIiwic2V0QWRkaXRpb25hbFBhcmFtcyIsIm5hbWVzIiwidmFsdWVzIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiSlNPTiIsInBhcnNlIiwiUHJlZnMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJoZWlnaHQiLCJnZXRJbnQiLCJ3aWR0aCIsIkNvbW1vbiIsIkZyYW1lQ29udHJvbGxlciIsInN0YXJ0WExTdWl0ZVBsYXllciIsInBsYXllckVycm9yIiwiZXJyb3IiLCJkZWJ1ZyIsInN0b3AiLCJTdG9yYWdlIiwiaW5pdCIsInN0b3JhZ2UiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImRldGFpbCIsIl9pbml0aWFsTG9hZCIsImhhc093blByb3BlcnR5IiwiY2hhbmdlZCIsInNldEF0dHJpYnV0ZSIsImZvbGRlciIsImZpbGVOYW1lIiwiY29tcGFueUlkIiwiZ28iLCJnZXRGcmFtZUNvbnRhaW5lciIsImluZGV4IiwiUFJFRklYIiwiaWZyYW1lIiwiZnJhbWVDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudFdpbmRvdyIsImNvbnRlbnREb2N1bWVudCIsIl9jbGVhciIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsInBhcmFtcyIsImZpbGVzIiwic2tpbiIsInNyYyIsIm9ubG9hZCIsImxvYWQiLCJ2aXNpYmlsaXR5IiwiY2FsbGJhY2siLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJNZXNzYWdlIiwibWFpbkNvbnRhaW5lciIsIm1lc3NhZ2VDb250YWluZXIiLCJfaW5pdCIsIndhcm4iLCJtZXNzYWdlIiwiX2FjdGl2ZSIsImRpc3BsYXkiLCJwIiwiZnJhZ21lbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwiaW5uZXJIVE1MIiwibGluZUhlaWdodCIsIndpbmRvdyIsInBvbHltZXJSZWFkeSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJpZCIsInJlZ2lzdGVyIiwicHJlZnMiLCJvbmNvbnRleHRtZW51IiwiX2dhcSIsInB1c2giLCJnYSIsInR5cGUiLCJhc3luYyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIl0sIm1hcHBpbmdzIjoiQUFpQkEsUUFBU0EsMEJBQXlCQyxFQUFZQyxFQUFpQkMsR0FDN0QsR0FBSUMsR0FBUyxzQ0FFYkMsU0FBUUMsSUFBSSxtQkFBb0JMLEdBRWhDTSxFQUFFQyxNQUNBQyxJQUFLLHlEQUEyREwsRUFBUyxnQ0FBa0NILElBQzFHUyxLQUFLLFNBQVVDLEdBQ2hCLElBQUtBLElBQVNBLEVBQUtDLE9BS2pCLE1BSkFQLFNBQVFDLElBQUksaUNBQWtDSyxHQUMxQ1IsR0FDRkEsSUFFRixNQUdGLElBQUlVLEdBQVlGLEVBQUtDLE9BQU9FLFdBRzVCVCxTQUFRQyxJQUFJLHFCQUFzQk8sRUFFbEMsSUFBSUUsR0FBVUYsRUFBWSw2REFFMUJYLEdBQWdCYSxLQXRDcEIsR0FBc0IsbUJBQVhDLFFBQXdCLENBQ2pDLEdBQUlBLFNBQ0ZDLEtBQU0sa0JBQ05DLFlBQWEsT0FHUSxvQkFBWkMsVUFDVEEsUUFBUUMsT0FBTyxvQ0FDWkMsU0FBUyxpQkFBa0Isd0JBQzNCQSxTQUFTLGdCQUFpQixTQXVDakMsR0FBSUMsWUFBYUEsY0FDakJBLFlBQVdDLFNBRVhELFdBQVdDLE1BQVEsU0FBV0MsR0FDNUIsWUFpQ0EsU0FBU0MsS0FDUEMsYUFBYUMsR0FDYkEsRUFBZSxLQUdqQixRQUFTQyxLQUNQSixFQUFRSyxJQUFJQyxLQUFLLEdBQUksZUFBZ0IsS0FBTUMsRUFBT0MsVUFBVSxPQUk5RCxRQUFTQyxLQUNQVCxFQUFRSyxJQUFJQyxLQUFLLEdBQUksZ0JBQWlCLEtBQU1DLEVBQU9DLFVBQVUsT0FDM0QsR0FBTSxHQUFNLEdBQU0sR0FBTSxHQUc1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QkQsS0FBS0MsTUFBTSxtQkFFWCxXQUNFLEdBQUlDLEdBQUt0RSxTQUFTb0MsY0FBYyxTQUFXa0MsR0FBR0MsS0FBTyxrQkFBbUJELEVBQUdFLE9BQVEsRUFDbkZGLEVBQUc3QixLQUFPLFVBQVl6QyxTQUFTeUUsU0FBU0MsU0FBVyxjQUFnQixjQUFnQiw2QkFDbkYsSUFBSUMsR0FBSTNFLFNBQVM0RSxxQkFBcUIsVUFBVSxFQUFJRCxHQUFFRSxXQUFXQyxhQUFhUixFQUFJSyIsImZpbGUiOiJqcy93aWRnZXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGNvbmZpZzogdHJ1ZSAqL1xuLyogZXhwb3J0ZWQgY29uZmlnICovXG5pZiAodHlwZW9mIGNvbmZpZyA9PT0gXCJ1bmRlZmluZWRcIikge1xuICB2YXIgY29uZmlnID0ge1xuICAgIFNLSU46IFwic2tpbi9SVlNraW4ueG1sXCIsXG4gICAgU1RPUkFHRV9FTlY6IFwicHJvZFwiXG4gIH07XG5cbiAgaWYgKHR5cGVvZiBhbmd1bGFyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLmNvbW1vbi5pMThuLmNvbmZpZ1wiLCBbXSlcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfUFJFRklYXCIsIFwibG9jYWxlcy90cmFuc2xhdGlvbl9cIilcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfU1VGSVhcIiwgXCIuanNvblwiKTtcbiAgfVxufVxuXHJcbid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gbG9hZFZpZGVvTGlua0Zyb21YTFN1aXRlKGRpc3BsYXlLZXksIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xuICB2YXIgYXBpS2V5ID0gXCIyYWU0NWZjMi03MmI5LTQ1Y2UtOTc3MS1jYWYwZmFiZjljOTdcIjtcblxuICBjb25zb2xlLmxvZyhcImRpc3BsYXlLZXkgcGFyYW1cIiwgZGlzcGxheUtleSk7XG5cbiAgJC5hamF4KHtcbiAgICB1cmw6IFwiaHR0cHM6Ly9ybi54bHN1aXRlLmNvbS9hZG1pbi9hcGkvbGlxdWlkcy9jYWxsP2FwaV9rZXk9XCIgKyBhcGlLZXkgKyBcIiZ0YWc9bG9hZF9zY3JlZW4mZGlzcGxheV9rZXk9XCIgKyBkaXNwbGF5S2V5XG4gIH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICBpZiAoIWRhdGEgfHwgIWRhdGEuc2NyZWVuKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkVycm9yIC0gUmV0dXJuZWQgZGF0YSBpcyBlbXB0eVwiLCBkYXRhKTtcbiAgICAgIGlmIChlcnJvckNhbGxiYWNrKSB7XG4gICAgICAgIGVycm9yQ2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgY2hhbmVsVXJsID0gZGF0YS5zY3JlZW4uY2hhbm5lbF91cmw7XG5cbiAgICAvL3RvZG86IHNhdmUgY2hhbm5lbCBVUkwgdG8gc29tZSBzZXR0aW5ncyAvIHZhcmlhYmxlXG4gICAgY29uc29sZS5sb2coXCJMb2FkZWQgY2hhbm5lbCBVUkxcIiwgY2hhbmVsVXJsKTtcblxuICAgIHZhciBmdWxsVXJsID0gY2hhbmVsVXJsICsgXCImYW1wO2F1dG9wbGF5PTEmYW1wO2NvbnRyb2xzPTAmYW1wO3Nob3dpbmZvPTAgZnJhbWVib3JkZXI9MFwiO1xuXG4gICAgc3VjY2Vzc0NhbGxiYWNrKGZ1bGxVcmwpO1xuXG4gICAgLy9STiAtIGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkL3ZpZGVvc2VyaWVzP2xpc3Q9UExuNTZWYnhPUzc3ZmQtcWJadzBtdm5TMlBtX190dlNIWlxuICAgIC8vbXkgLSBodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC92aWRlb3Nlcmllcz9saXN0PVBMNDhaR3dDcHdQeUZWaUVMZ3NudlVrblJ6SnlvMmdPaEFcbiAgfSk7XG5cbn1cblxyXG4vKiBnbG9iYWwgZ2FkZ2V0cywgY29uZmlnICovXG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW8gPSB7fTtcblxuUmlzZVZpc2lvbi5WaWRlbyA9IChmdW5jdGlvbiAoZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2FkZGl0aW9uYWxQYXJhbXM7XG5cbiAgdmFyIF9wcmVmcyA9IG51bGwsXG4gICAgX3N0b3JhZ2UgPSBudWxsLFxuICAgIF9tZXNzYWdlID0gbnVsbCxcbiAgICBfZnJhbWVDb250cm9sbGVyID0gbnVsbDtcblxuICB2YXIgX3BsYXliYWNrRXJyb3IgPSBmYWxzZSxcbiAgICBfaXNTdG9yYWdlRmlsZSA9IGZhbHNlLFxuICAgIF92aWV3ZXJQYXVzZWQgPSB0cnVlO1xuXG4gIHZhciBfY3VycmVudEZyYW1lID0gMDtcblxuICB2YXIgX3NlcGFyYXRvciA9IFwiXCIsXG4gICAgX2N1cnJlbnRGaWxlID0gXCJcIjtcblxuICB2YXIgZGlzcGxheUlkO1xuXG4gIHZhciBfcmVmcmVzaER1cmF0aW9uID0gOTAwMDAwLCAgLy8gMTUgbWludXRlc1xuICAgIF9yZWZyZXNoSW50ZXJ2YWxJZCA9IG51bGw7XG5cbiAgdmFyIHhsU3VpdGVQbGF5bGlzdFJlZnJlc2hEdXJhdGlvbiA9IDUwMDA7IC8vNSBzZWNcblxuICB2YXIgX25vRmlsZVRpbWVyID0gbnVsbCxcbiAgICBfbm9GaWxlRmxhZyA9IGZhbHNlO1xuXG4gIHZhciBfcGxheWxpc3RDaGFuZ2VUaW1lciA9IG51bGw7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX2NsZWFyTm9GaWxlVGltZXIoKSB7XG4gICAgY2xlYXJUaW1lb3V0KF9ub0ZpbGVUaW1lcik7XG4gICAgX25vRmlsZVRpbWVyID0gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9kb25lKCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X2RvbmVcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpKTtcblxuICB9XG5cbiAgZnVuY3Rpb24gX3JlYWR5KCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X3JlYWR5XCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSxcbiAgICAgIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gX3JlZnJlc2hJbnRlcnZhbChkdXJhdGlvbikge1xuICAgIF9yZWZyZXNoSW50ZXJ2YWxJZCA9IHNldEludGVydmFsKGZ1bmN0aW9uIHZpZGVvUmVmcmVzaCgpIHtcbiAgICAgIC8vIHNldCBuZXcgdmFsdWUgb2Ygbm9uIHJpc2Utc3RvcmFnZSB1cmwgd2l0aCBhIGNhY2hlYnVzdGVyXG4gICAgICBfY3VycmVudEZpbGUgPSBfYWRkaXRpb25hbFBhcmFtcy51cmwgKyBfc2VwYXJhdG9yICsgXCJjYj1cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuXG4gICAgICAvLyBpbiBjYXNlIHJlZnJlc2hlZCBmaWxlIGZpeGVzIGFuIGVycm9yIHdpdGggcHJldmlvdXMgZmlsZSwgZW5zdXJlIGZsYWcgaXMgcmVtb3ZlZCBzbyBwbGF5YmFjayBpcyBhdHRlbXB0ZWQgYWdhaW5cbiAgICAgIF9wbGF5YmFja0Vycm9yID0gZmFsc2U7XG5cbiAgICB9LCBkdXJhdGlvbik7XG4gIH1cblxuICBmdW5jdGlvbiBfc3RhcnROb0ZpbGVUaW1lcigpIHtcbiAgICBfY2xlYXJOb0ZpbGVUaW1lcigpO1xuXG4gICAgX25vRmlsZVRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBub3RpZnkgVmlld2VyIHdpZGdldCBpcyBkb25lXG4gICAgICBfZG9uZSgpO1xuICAgIH0sIDUwMDApO1xuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBub1N0b3JhZ2VGaWxlKCkge1xuICAgIF9ub0ZpbGVGbGFnID0gdHJ1ZTtcbiAgICBfY3VycmVudEZpbGUgPSBcIlwiO1xuXG4gICAgX21lc3NhZ2Uuc2hvdyhcIlRoZSBzZWxlY3RlZCB2aWRlbyBkb2VzIG5vdCBleGlzdC5cIik7XG5cbiAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShfY3VycmVudEZyYW1lLCBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBpZiBXaWRnZXQgaXMgcGxheWluZyByaWdodCBub3csIHJ1biB0aGUgdGltZXJcbiAgICAgIGlmICghX3ZpZXdlclBhdXNlZCkge1xuICAgICAgICBfc3RhcnROb0ZpbGVUaW1lcigpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gb25TdG9yYWdlSW5pdCh1cmwpIHtcbiAgICBfY3VycmVudEZpbGUgPSB1cmw7XG5cbiAgICBfbWVzc2FnZS5oaWRlKCk7XG5cbiAgICBpZiAoIV92aWV3ZXJQYXVzZWQpIHtcbiAgICAgIHBsYXkoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBvblN0b3JhZ2VSZWZyZXNoKHVybCkge1xuICAgIF9jdXJyZW50RmlsZSA9IHVybDtcblxuICAgIC8vIGluIGNhc2UgcmVmcmVzaGVkIGZpbGUgZml4ZXMgYW4gZXJyb3Igd2l0aCBwcmV2aW91cyBmaWxlLCBlbnN1cmUgZmxhZyBpcyByZW1vdmVkIHNvIHBsYXliYWNrIGlzIGF0dGVtcHRlZCBhZ2FpblxuICAgIF9wbGF5YmFja0Vycm9yID0gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICB2YXIgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuXG4gICAgX3ZpZXdlclBhdXNlZCA9IHRydWU7XG5cbiAgICBpZiAoX25vRmlsZUZsYWcpIHtcbiAgICAgIF9jbGVhck5vRmlsZVRpbWVyKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICBmcmFtZU9iai5wYXVzZSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gIC8vICBjb25zb2xlLmxvZyhcIlBsYXkgZXZlbnQgXCIpO1xuICAgIHZhciBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICBfdmlld2VyUGF1c2VkID0gZmFsc2U7XG5cbiAgICBpZiAoX25vRmlsZUZsYWcpIHtcbiAgICAgIF9zdGFydE5vRmlsZVRpbWVyKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCFfcGxheWJhY2tFcnJvcikge1xuICAgICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICAgIGZyYW1lT2JqLnBsYXkoKTtcbiAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgaWYgKF9jdXJyZW50RmlsZSAmJiBfY3VycmVudEZpbGUgIT09IFwiXCIpIHtcbiAgICAgICAgICAvLyBhZGQgZnJhbWUgYW5kIGNyZWF0ZSB0aGUgcGxheWVyXG4gICAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5hZGQoMCk7XG4gICAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcigwLCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlLCBjb25maWcuU0tJTiwgXCJwbGF5ZXIuaHRtbFwiKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRoaXMgZmxhZyBvbmx5IGdvdCBzZXQgdXBvbiBhIHJlZnJlc2ggb2YgaGlkZGVuIGZyYW1lIGFuZCB0aGVyZSB3YXMgYW4gZXJyb3IgaW4gc2V0dXAgb3IgdmlkZW9cbiAgICAgIC8vIFNlbmQgVmlld2VyIFwiZG9uZVwiXG4gICAgICBfZG9uZSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllckVuZGVkKCkge1xuICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKF9jdXJyZW50RnJhbWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgIF9kb25lKCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJSZWFkeSgpIHtcbiAgICB2YXIgZnJhbWVPYmo7XG5cbiAgICAvLyBub24tc3RvcmFnZSwgY2hlY2sgaWYgcmVmcmVzaCBpbnRlcnZhbCBleGlzdHMgeWV0LCBzdGFydCBpdCBpZiBub3RcbiAgICBpZiAoIV9pc1N0b3JhZ2VGaWxlICYmIF9yZWZyZXNoSW50ZXJ2YWxJZCA9PT0gbnVsbCkge1xuICAgICAgX3JlZnJlc2hJbnRlcnZhbChfcmVmcmVzaER1cmF0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAoIV92aWV3ZXJQYXVzZWQpIHtcbiAgICAgIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcbiAgICAgIGZyYW1lT2JqLnBsYXkoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzdGFydFBsYXlsaXN0Q2hhbmdlVGltZXIoKSB7XG4gICAgY2xlYXJUaW1lb3V0KF9wbGF5bGlzdENoYW5nZVRpbWVyKTtcblxuICAgIF9wbGF5bGlzdENoYW5nZVRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgY29uc29sZS5sb2coXCJJbnRlcnZhbCBjaGVja1wiKTtcblxuICAgICAgbG9hZFZpZGVvTGlua0Zyb21YTFN1aXRlKGRpc3BsYXlJZCwgZnVuY3Rpb24gKHZpZGVvVXJsKSB7XG4gICAgICAgIGlmICh2aWRlb1VybCAhPSBfY3VycmVudEZpbGUpIHtcbiAgICAgICAgICBfY3VycmVudEZpbGUgPSB2aWRlb1VybDtcbiAgICAgICAgICB2YXIgJG1haW5JZnJhbWUgPSAkKCcjbWFpbklmcmFtZScpO1xuICAgICAgICAgICRtYWluSWZyYW1lLmF0dHIoJ3NyYycsIF9jdXJyZW50RmlsZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgfSwgeGxTdWl0ZVBsYXlsaXN0UmVmcmVzaER1cmF0aW9uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldEFkZGl0aW9uYWxQYXJhbXMobmFtZXMsIHZhbHVlcykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWVzKSAmJiBuYW1lcy5sZW5ndGggPiAwICYmIG5hbWVzWzBdID09PSBcImFkZGl0aW9uYWxQYXJhbXNcIikge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSAmJiB2YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcyA9IEpTT04ucGFyc2UodmFsdWVzWzBdKTtcbiAgICAgICAgX3ByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKTtcblxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvQ29udGFpbmVyXCIpLnN0eWxlLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIikgKyBcInB4XCI7XG5cbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMud2lkdGggPSBfcHJlZnMuZ2V0SW50KFwicnNXXCIpO1xuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpO1xuXG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIgPSBuZXcgUmlzZVZpc2lvbi5Db21tb24uVmlkZW8uRnJhbWVDb250cm9sbGVyKCk7XG5cbiAgICAgICAgX2lzU3RvcmFnZUZpbGUgPSBmYWxzZTtcblxuICAgICAgICBpZiAoX3ByZWZzLmdldFN0cmluZyhcImRpc3BsYXlJZFwiKSkge1xuICAgICAgICAgIGRpc3BsYXlJZCA9IF9wcmVmcy5nZXRTdHJpbmcoXCJkaXNwbGF5SWRcIik7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJkaXNwbGF5SWQgc2V0IGZyb20gY2hyb21lQXBwIHBhcmFtXCIsIGRpc3BsYXlJZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGlzcGxheUlkID0gX2FkZGl0aW9uYWxQYXJhbXMuZGlzcGxheUlkO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiZGlzcGxheUlkIHNldCBmcm9tIGRlZmF1bHQgc2V0dGluZ3NcIiwgZGlzcGxheUlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvYWRWaWRlb0xpbmtGcm9tWExTdWl0ZShkaXNwbGF5SWQsIHN0YXJ0WExTdWl0ZVBsYXllciwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKGRpc3BsYXlJZCAhPSBfcHJlZnMuZ2V0U3RyaW5nKFwiZGlzcGxheUlkXCIpKSB7XG4gICAgICAgICAgICBkaXNwbGF5SWQgPSBfYWRkaXRpb25hbFBhcmFtcy5kaXNwbGF5SWQ7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRyeWluZyB0byB1c2UgZGVmYXVsdCBkaXNwbGF5SWRcIiwgZGlzcGxheUlkKTtcbiAgICAgICAgICAgIGxvYWRWaWRlb0xpbmtGcm9tWExTdWl0ZShkaXNwbGF5SWQsIHN0YXJ0WExTdWl0ZVBsYXllcik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzdGFydFhMU3VpdGVQbGF5ZXIodmlkZW9VcmwpIHtcbiAgICBfY3VycmVudEZpbGUgPSB2aWRlb1VybDtcblxuICAgIHZhciAkbWFpbklmcmFtZSA9ICQoJyNtYWluSWZyYW1lJyk7XG4gICAgJG1haW5JZnJhbWUuYXR0cignc3JjJywgX2N1cnJlbnRGaWxlKTtcbiAgICAkbWFpbklmcmFtZS5hdHRyKCd3aWR0aCcsIF9hZGRpdGlvbmFsUGFyYW1zLndpZHRoKTtcbiAgICAkbWFpbklmcmFtZS5hdHRyKCdoZWlnaHQnLCBfYWRkaXRpb25hbFBhcmFtcy5oZWlnaHQpO1xuXG4gICAgc3RhcnRQbGF5bGlzdENoYW5nZVRpbWVyKCk7XG5cbiAgICBfcmVhZHkoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllckVycm9yKGVycm9yKSB7XG4gICAgY29uc29sZS5kZWJ1ZyhcInZpZGVvLWZvbGRlcjo6cGxheWVyRXJyb3IoKVwiLCBlcnJvcik7XG5cbiAgICAvLyBmbGFnIHRoZSB2aWRlbyBoYXMgYW4gZXJyb3JcbiAgICBfcGxheWJhY2tFcnJvciA9IHRydWU7XG5cbiAgICAvLyBhY3QgYXMgdGhvdWdoIHZpZGVvIGhhcyBlbmRlZFxuICAgIHBsYXllckVuZGVkKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIHBhdXNlKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwibm9TdG9yYWdlRmlsZVwiOiBub1N0b3JhZ2VGaWxlLFxuICAgIFwib25TdG9yYWdlSW5pdFwiOiBvblN0b3JhZ2VJbml0LFxuICAgIFwib25TdG9yYWdlUmVmcmVzaFwiOiBvblN0b3JhZ2VSZWZyZXNoLFxuICAgIFwicGF1c2VcIjogcGF1c2UsXG4gICAgXCJwbGF5XCI6IHBsYXksXG4gICAgXCJzZXRBZGRpdGlvbmFsUGFyYW1zXCI6IHNldEFkZGl0aW9uYWxQYXJhbXMsXG4gICAgXCJwbGF5ZXJFbmRlZFwiOiBwbGF5ZXJFbmRlZCxcbiAgICBcInBsYXllclJlYWR5XCI6IHBsYXllclJlYWR5LFxuICAgIFwicGxheWVyRXJyb3JcIjogcGxheWVyRXJyb3IsXG4gICAgXCJzdG9wXCI6IHN0b3BcbiAgfTtcblxufSkoZ2FkZ2V0cyk7XG5cclxuLyogZ2xvYmFsIGNvbmZpZyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvID0gUmlzZVZpc2lvbi5WaWRlbyB8fCB7fTtcblxuUmlzZVZpc2lvbi5WaWRlby5TdG9yYWdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9pbml0aWFsTG9hZCA9IHRydWU7XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIHZhciBzdG9yYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb1N0b3JhZ2VcIik7XG5cbiAgICBpZiAoIXN0b3JhZ2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLnVybCkge1xuXG4gICAgICAgIGlmIChfaW5pdGlhbExvYWQpIHtcbiAgICAgICAgICBfaW5pdGlhbExvYWQgPSBmYWxzZTtcblxuICAgICAgICAgIFJpc2VWaXNpb24uVmlkZW8ub25TdG9yYWdlSW5pdChlLmRldGFpbC51cmwpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIC8vIGNoZWNrIGZvciBcImNoYW5nZWRcIiBwcm9wZXJ0eSBhbmQgZW5zdXJlIGl0IGlzIHRydWVcbiAgICAgICAgICBpZiAoZS5kZXRhaWwuaGFzT3duUHJvcGVydHkoXCJjaGFuZ2VkXCIpICYmIGUuZGV0YWlsLmNoYW5nZWQpIHtcbiAgICAgICAgICAgIFJpc2VWaXNpb24uVmlkZW8ub25TdG9yYWdlUmVmcmVzaChlLmRldGFpbC51cmwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLW5vLWZpbGVcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBSaXNlVmlzaW9uLlZpZGVvLm5vU3RvcmFnZUZpbGUoKTtcbiAgICB9KTtcblxuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZm9sZGVyXCIsIGRhdGEuc3RvcmFnZS5mb2xkZXIpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZmlsZU5hbWVcIiwgZGF0YS5zdG9yYWdlLmZpbGVOYW1lKTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImNvbXBhbnlJZFwiLCBkYXRhLnN0b3JhZ2UuY29tcGFueUlkKTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImVudlwiLCBjb25maWcuU1RPUkFHRV9FTlYpO1xuICAgIHN0b3JhZ2UuZ28oKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJpbml0XCI6IGluaXRcbiAgfTtcbn07XG5cclxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xyXG5SaXNlVmlzaW9uLkNvbW1vbiA9IFJpc2VWaXNpb24uQ29tbW9uIHx8IHt9O1xyXG5cclxuUmlzZVZpc2lvbi5Db21tb24uVmlkZW8gPSBSaXNlVmlzaW9uLkNvbW1vbi5WaWRlbyB8fCB7fTtcclxuXHJcblJpc2VWaXNpb24uQ29tbW9uLlZpZGVvLkZyYW1lQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcclxuICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgdmFyIFBSRUZJWCA9IFwiaWZfXCI7XHJcblxyXG4gIGZ1bmN0aW9uIGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSB7XHJcbiAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0RnJhbWVPYmplY3QoaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcclxuICAgICAgaWZyYW1lO1xyXG5cclxuICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XHJcblxyXG4gICAgaWYgKGlmcmFtZSkge1xyXG4gICAgICByZXR1cm4gKGlmcmFtZS5jb250ZW50V2luZG93KSA/IGlmcmFtZS5jb250ZW50V2luZG93IDpcclxuICAgICAgICAoaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCkgPyBpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50IDogaWZyYW1lLmNvbnRlbnREb2N1bWVudDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIF9jbGVhcihpbmRleCkge1xyXG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxyXG4gICAgICBmcmFtZU9iaiA9IGdldEZyYW1lT2JqZWN0KGluZGV4KSxcclxuICAgICAgaWZyYW1lO1xyXG5cclxuICAgIGlmIChmcmFtZU9iaikge1xyXG4gICAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xyXG4gICAgICBmcmFtZU9iai5yZW1vdmUoKTtcclxuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBcImFib3V0OmJsYW5rXCIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYWRkKGluZGV4KSB7XHJcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXHJcbiAgICAgIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpZnJhbWVcIik7XHJcblxyXG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcImFsbG93VHJhbnNwYXJlbmN5XCIsIHRydWUpO1xyXG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcImZyYW1lYm9yZGVyXCIsIFwiMFwiKTtcclxuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzY3JvbGxpbmdcIiwgXCJub1wiKTtcclxuXHJcbiAgICBmcmFtZUNvbnRhaW5lci5hcHBlbmRDaGlsZChpZnJhbWUpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gY3JlYXRlRnJhbWVQbGF5ZXIoaW5kZXgsIHBhcmFtcywgZmlsZXMsIHNraW4sIHNyYykge1xyXG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxyXG4gICAgICBmcmFtZU9iaiA9IGdldEZyYW1lT2JqZWN0KGluZGV4KSxcclxuICAgICAgaWZyYW1lO1xyXG5cclxuICAgIGlmIChmcmFtZU9iaikge1xyXG4gICAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xyXG5cclxuICAgICAgaWZyYW1lLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZnJhbWUub25sb2FkID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gaW5pdGlhbGl6ZSBhbmQgbG9hZCB0aGUgcGxheWVyIGluc2lkZSB0aGUgaWZyYW1lXHJcbiAgICAgICAgZnJhbWVPYmouaW5pdChwYXJhbXMsIGZpbGVzLCBza2luKTtcclxuICAgICAgICBmcmFtZU9iai5sb2FkKCk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsIHNyYyk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gaGlkZShpbmRleCkge1xyXG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpO1xyXG5cclxuICAgIGZyYW1lQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVtb3ZlKGluZGV4LCBjYWxsYmFjaykge1xyXG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpO1xyXG5cclxuICAgIF9jbGVhcihpbmRleCk7XHJcblxyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgIC8vIHJlbW92ZSB0aGUgaWZyYW1lIGJ5IGNsZWFyaW5nIGFsbCBlbGVtZW50cyBpbnNpZGUgZGl2IGNvbnRhaW5lclxyXG4gICAgICB3aGlsZSAoZnJhbWVDb250YWluZXIuZmlyc3RDaGlsZCkge1xyXG4gICAgICAgIGZyYW1lQ29udGFpbmVyLnJlbW92ZUNoaWxkKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICB9XHJcbiAgICB9LCAyMDApO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2hvdyhpbmRleCkge1xyXG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpO1xyXG5cclxuICAgIGZyYW1lQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcclxuICB9XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBhZGQ6IGFkZCxcclxuICAgIGNyZWF0ZUZyYW1lUGxheWVyOiBjcmVhdGVGcmFtZVBsYXllcixcclxuICAgIGdldEZyYW1lQ29udGFpbmVyOiBnZXRGcmFtZUNvbnRhaW5lcixcclxuICAgIGdldEZyYW1lT2JqZWN0OiBnZXRGcmFtZU9iamVjdCxcclxuICAgIGhpZGU6IGhpZGUsXHJcbiAgICByZW1vdmU6IHJlbW92ZSxcclxuICAgIHNob3c6IHNob3dcclxuICB9O1xyXG59O1xyXG5cclxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xyXG5SaXNlVmlzaW9uLkNvbW1vbiA9IFJpc2VWaXNpb24uQ29tbW9uIHx8IHt9O1xyXG5cclxuUmlzZVZpc2lvbi5Db21tb24uTWVzc2FnZSA9IGZ1bmN0aW9uIChtYWluQ29udGFpbmVyLCBtZXNzYWdlQ29udGFpbmVyKSB7XHJcbiAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gIHZhciBfYWN0aXZlID0gZmFsc2U7XHJcblxyXG4gIGZ1bmN0aW9uIF9pbml0KCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBtYWluQ29udGFpbmVyLnN0eWxlLmhlaWdodDtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS53YXJuKFwiQ2FuJ3QgaW5pdGlhbGl6ZSBNZXNzYWdlIC0gXCIsIGUubWVzc2FnZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqICBQdWJsaWMgTWV0aG9kc1xyXG4gICAqL1xyXG4gIGZ1bmN0aW9uIGhpZGUoKSB7XHJcbiAgICBpZiAoX2FjdGl2ZSkge1xyXG4gICAgICAvLyBjbGVhciBjb250ZW50IG9mIG1lc3NhZ2UgY29udGFpbmVyXHJcbiAgICAgIHdoaWxlIChtZXNzYWdlQ29udGFpbmVyLmZpcnN0Q2hpbGQpIHtcclxuICAgICAgICBtZXNzYWdlQ29udGFpbmVyLnJlbW92ZUNoaWxkKG1lc3NhZ2VDb250YWluZXIuZmlyc3RDaGlsZCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGhpZGUgbWVzc2FnZSBjb250YWluZXJcclxuICAgICAgbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcblxyXG4gICAgICAvLyBzaG93IG1haW4gY29udGFpbmVyXHJcbiAgICAgIG1haW5Db250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xyXG5cclxuICAgICAgX2FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2hvdyhtZXNzYWdlKSB7XHJcbiAgICB2YXIgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksXHJcbiAgICAgIHA7XHJcblxyXG4gICAgaWYgKCFfYWN0aXZlKSB7XHJcbiAgICAgIC8vIGhpZGUgbWFpbiBjb250YWluZXJcclxuICAgICAgbWFpbkNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcclxuXHJcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuXHJcbiAgICAgIC8vIGNyZWF0ZSBtZXNzYWdlIGVsZW1lbnRcclxuICAgICAgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xyXG4gICAgICBwLmlubmVySFRNTCA9IG1lc3NhZ2U7XHJcbiAgICAgIHAuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJtZXNzYWdlXCIpO1xyXG4gICAgICBwLnN0eWxlLmxpbmVIZWlnaHQgPSBtZXNzYWdlQ29udGFpbmVyLnN0eWxlLmhlaWdodDtcclxuXHJcbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHApO1xyXG4gICAgICBtZXNzYWdlQ29udGFpbmVyLmFwcGVuZENoaWxkKGZyYWdtZW50KTtcclxuXHJcbiAgICAgIF9hY3RpdmUgPSB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gbWVzc2FnZSBhbHJlYWR5IGJlaW5nIHNob3duLCB1cGRhdGUgbWVzc2FnZSB0ZXh0XHJcbiAgICAgIHAgPSBtZXNzYWdlQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIubWVzc2FnZVwiKTtcclxuICAgICAgcC5pbm5lckhUTUwgPSBtZXNzYWdlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2luaXQoKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIFwiaGlkZVwiOiBoaWRlLFxyXG4gICAgXCJzaG93XCI6IHNob3dcclxuICB9O1xyXG59O1xyXG5cclxuLyogZ2xvYmFsIGdhZGdldHMsIFJpc2VWaXNpb24gKi9cblxuKGZ1bmN0aW9uICh3aW5kb3csIGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIHByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKSxcbiAgICBpZCA9IHByZWZzLmdldFN0cmluZyhcImlkXCIpO1xuXG4gIC8vIERpc2FibGUgY29udGV4dCBtZW51IChyaWdodCBjbGljayBtZW51KVxuICB3aW5kb3cub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnBsYXkoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8ucGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5zdG9wKCk7XG4gIH1cblxuICBmdW5jdGlvbiBwb2x5bWVyUmVhZHkoKSB7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJXZWJDb21wb25lbnRzUmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxuICAgIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wbGF5X1wiICsgaWQsIHBsYXkpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wYXVzZV9cIiArIGlkLCBwYXVzZSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3N0b3BfXCIgKyBpZCwgc3RvcCk7XG5cbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgUmlzZVZpc2lvbi5WaWRlby5zZXRBZGRpdGlvbmFsUGFyYW1zKTtcbiAgICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc3BhcmFtX2dldFwiLCBudWxsLCBpZCwgW1wiYWRkaXRpb25hbFBhcmFtc1wiXSk7XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJXZWJDb21wb25lbnRzUmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxufSkod2luZG93LCBnYWRnZXRzKTtcblxuXG5cclxuLyoganNoaW50IGlnbm9yZTpzdGFydCAqL1xudmFyIF9nYXEgPSBfZ2FxIHx8IFtdO1xuXG5fZ2FxLnB1c2goWydfc2V0QWNjb3VudCcsICdVQS01NzA5MjE1OS0yJ10pO1xuX2dhcS5wdXNoKFsnX3RyYWNrUGFnZXZpZXcnXSk7XG5cbihmdW5jdGlvbigpIHtcbiAgdmFyIGdhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7IGdhLnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsgZ2EuYXN5bmMgPSB0cnVlO1xuICBnYS5zcmMgPSAoJ2h0dHBzOicgPT0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgPyAnaHR0cHM6Ly9zc2wnIDogJ2h0dHA6Ly93d3cnKSArICcuZ29vZ2xlLWFuYWx5dGljcy5jb20vZ2EuanMnO1xuICB2YXIgcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKVswXTsgcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShnYSwgcyk7XG59KSgpO1xuLyoganNoaW50IGlnbm9yZTplbmQgKi9cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
