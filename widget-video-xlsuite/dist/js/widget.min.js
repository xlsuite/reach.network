function loadVideoLinkFromXLSuite(e,t,i){var n="2ae45fc2-72b9-45ce-9771-caf0fabf9c97";console.log("displayKey param",e),$.ajax({url:"https://rn.xlsuite.com/admin/api/liquids/call?api_key="+n+"&tag=load_screen&display_key="+e}).then(function(e){if(!e||!e.screen)return console.log("Error - Returned data is empty",e),i&&i(),void 0;var n=e.screen.channel_url,o=n.substring(n.indexOf("?list=")+6);console.log("Loaded channel URL, channel ID",n,o),t(o)})}if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml",STORAGE_ENV:"prod"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e){"use strict";function t(){clearTimeout(N),N=null}function i(){e.rpc.call("","rsevent_done",null,C.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,C.getString("id"),!0,!0,!0,!0,!0)}function o(e){O=setInterval(function(){k=b.url+F+"cb="+(new Date).getTime(),I=!1},e)}function r(){t(),N=setTimeout(function(){i()},5e3)}function s(){q=!0,k="",_.show("The selected video does not exist."),E.remove(T,function(){L||r()})}function a(e){k=e,_.hide(),L||d()}function l(e){k=e,I=!1}function c(){var e=E.getFrameObject(T);return L=!0,q?(t(),void 0):(e&&e.pause(),void 0)}function d(){var e=E.getFrameObject(T);return L=!1,q?(r(),void 0):(I?i():e&&e.play(),void 0)}function u(){E.remove(T,function(){i()})}function m(){var e;A||null!==O||o(P),L||(e=E.getFrameObject(T),e.play())}function g(){clearTimeout(j),j=setInterval(function(){console.log("Interval check"),loadVideoLinkFromXLSuite(w,function(e){e!=k&&(k=e,y(k,b.width,b.height))})},x)}function f(t,i){console.log("additional params values",i),Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(i)&&i.length>0&&(b=JSON.parse(i[0]),C=new e.Prefs,b||(b={},console.log("additional params recreated")),document.getElementById("videoContainer").style.height=C.getInt("rsH")+"px",b.width=C.getInt("rsW"),b.height=C.getInt("rsH"),E=new RiseVision.Common.Video.FrameController,A=!1,C.getString("displayId")?(w=C.getString("displayId"),console.log("displayId set from chromeApp param",w)):(w=b.displayId,console.log("displayId set from default settings",w)),loadVideoLinkFromXLSuite(w,p,function(){w!=C.getString("displayId")&&(w=b.displayId,console.log("Trying to use default displayId",w),loadVideoLinkFromXLSuite(w,p))}))}function p(e){k=e,y(k,b.width,b.height),g(),n()}function y(e,t,i){console.log("Video url, w, h",e,t,i),B=new YT.Player("mainIframe",{width:t,height:i,playerVars:{listType:"playlist",list:e,autoplay:1,controls:0,loop:1,showinfo:0},events:{onError:v,onReady:V,onStateChange:h}})}function v(e){console.log("Player error code",e),B&&null!=B&&e&&e.data>=100&&(B.nextVideo(),console.log("Error, playing next video",e))}function h(){}function V(){}function R(e){console.debug("video-folder::playerError()",e),I=!0,u()}function S(){c()}var b,w,C=null,_=null,E=null,I=!1,A=!1,L=!0,T=0,F="",k="",P=9e5,O=null,x=5e3,N=null,q=!1,j=null,B=null;return{noStorageFile:s,onStorageInit:a,onStorageRefresh:l,pause:c,play:d,setAdditionalParams:f,playerEnded:u,playerReady:m,playerError:R,stop:S}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoStorage");t&&(t.addEventListener("rise-storage-response",function(e){e.detail&&e.detail.url&&(i?(i=!1,RiseVision.Video.onStorageInit(e.detail.url)):e.detail.hasOwnProperty("changed")&&e.detail.changed&&RiseVision.Video.onStorageRefresh(e.detail.url))}),t.addEventListener("rise-storage-no-file",function(){RiseVision.Video.noStorageFile()}),t.setAttribute("folder",e.storage.folder),t.setAttribute("fileName",e.storage.fileName),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("env",config.STORAGE_ENV),t.go())}var i=!0;return{init:t}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function e(e){return document.getElementById(l+e)}function t(t){var i,n=e(t);return i=n.querySelector("iframe"),i?i.contentWindow?i.contentWindow:i.contentDocument.document?i.contentDocument.document:i.contentDocument:null}function i(i){var n,o=e(i),r=t(i);r&&(n=o.querySelector("iframe"),r.remove(),n.setAttribute("src","about:blank"))}function n(t){var i=e(t),n=document.createElement("iframe");n.setAttribute("allowTransparency",!0),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),i.appendChild(n)}function o(i,n,o,r,s){var a,l=e(i),c=t(i);c&&(a=l.querySelector("iframe"),a.onload=function(){a.onload=null,c.init(n,o,r),c.load()},a.setAttribute("src",s))}function r(t){var i=e(t);i.style.visibility="hidden"}function s(e,t){var n=document.getElementById(l+e);i(e),setTimeout(function(){for(;n.firstChild;)n.removeChild(n.firstChild);t&&"function"==typeof t&&t()},200)}function a(t){var i=e(t);i.style.visibility="visible"}var l="if_";return{add:n,createFramePlayer:o,getFrameContainer:e,getFrameObject:t,hide:r,remove:s,show:a}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Message=function(e,t){"use strict";function i(){try{t.style.height=e.style.height}catch(i){console.warn("Can't initialize Message - ",i.message)}}function n(){if(r){for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none",e.style.visibility="visible",r=!1}}function o(i){var n,o=document.createDocumentFragment();r?(n=t.querySelector(".message"),n.innerHTML=i):(e.style.visibility="hidden",t.style.display="block",n=document.createElement("p"),n.innerHTML=i,n.setAttribute("class","message"),n.style.lineHeight=t.style.height,o.appendChild(n),t.appendChild(o),r=!0)}var r=!1;return i(),{hide:n,show:o}},function(e,t){"use strict";function i(){RiseVision.Video.play()}function n(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function r(){e.removeEventListener("WebComponentsReady",r),a&&""!==a&&(t.rpc.register("rscmd_play_"+a,i),t.rpc.register("rscmd_pause_"+a,n),t.rpc.register("rscmd_stop_"+a,o),t.rpc.register("rsparam_set_"+a,RiseVision.Video.setAdditionalParams),t.rpc.call("","rsparam_get",null,a,["additionalParams"]))}var s=new t.Prefs,a=s.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("WebComponentsReady",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsibG9hZFZpZGVvTGlua0Zyb21YTFN1aXRlIiwiZGlzcGxheUtleSIsInN1Y2Nlc3NDYWxsYmFjayIsImVycm9yQ2FsbGJhY2siLCJhcGlLZXkiLCJjb25zb2xlIiwibG9nIiwiJCIsImFqYXgiLCJ1cmwiLCJ0aGVuIiwiZGF0YSIsInNjcmVlbiIsImNoYW5lbFVybCIsImNoYW5uZWxfdXJsIiwiY2hhbm5lbElkIiwic3Vic3RyaW5nIiwiaW5kZXhPZiIsImNvbmZpZyIsIlNLSU4iLCJTVE9SQUdFX0VOViIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsInRhZyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNyYyIsImZpcnN0U2NyaXB0VGFnIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIiwiUmlzZVZpc2lvbiIsIlZpZGVvIiwiZ2FkZ2V0cyIsIl9jbGVhck5vRmlsZVRpbWVyIiwiY2xlYXJUaW1lb3V0IiwiX25vRmlsZVRpbWVyIiwiX2RvbmUiLCJycGMiLCJjYWxsIiwiX3ByZWZzIiwiZ2V0U3RyaW5nIiwiX3JlYWR5IiwiX3JlZnJlc2hJbnRlcnZhbCIsImR1cmF0aW9uIiwiX3JlZnJlc2hJbnRlcnZhbElkIiwic2V0SW50ZXJ2YWwiLCJfY3VycmVudEZpbGUiLCJfYWRkaXRpb25hbFBhcmFtcyIsIl9zZXBhcmF0b3IiLCJEYXRlIiwiZ2V0VGltZSIsIl9wbGF5YmFja0Vycm9yIiwiX3N0YXJ0Tm9GaWxlVGltZXIiLCJzZXRUaW1lb3V0Iiwibm9TdG9yYWdlRmlsZSIsIl9ub0ZpbGVGbGFnIiwiX21lc3NhZ2UiLCJzaG93IiwiX2ZyYW1lQ29udHJvbGxlciIsInJlbW92ZSIsIl9jdXJyZW50RnJhbWUiLCJfdmlld2VyUGF1c2VkIiwib25TdG9yYWdlSW5pdCIsImhpZGUiLCJwbGF5Iiwib25TdG9yYWdlUmVmcmVzaCIsInBhdXNlIiwiZnJhbWVPYmoiLCJnZXRGcmFtZU9iamVjdCIsInBsYXllckVuZGVkIiwicGxheWVyUmVhZHkiLCJfaXNTdG9yYWdlRmlsZSIsIl9yZWZyZXNoRHVyYXRpb24iLCJzdGFydFBsYXlsaXN0Q2hhbmdlVGltZXIiLCJfcGxheWxpc3RDaGFuZ2VUaW1lciIsImRpc3BsYXlJZCIsInZpZGVvVXJsIiwiaW5pdFlUUGxheWVyIiwid2lkdGgiLCJoZWlnaHQiLCJ4bFN1aXRlUGxheWxpc3RSZWZyZXNoRHVyYXRpb24iLCJzZXRBZGRpdGlvbmFsUGFyYW1zIiwibmFtZXMiLCJ2YWx1ZXMiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJKU09OIiwicGFyc2UiLCJQcmVmcyIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJnZXRJbnQiLCJDb21tb24iLCJGcmFtZUNvbnRyb2xsZXIiLCJzdGFydFhMU3VpdGVQbGF5ZXIiLCJwbGF5bGlzdElkIiwieW91dHViZVBsYXllckpTIiwiWVQiLCJQbGF5ZXIiLCJwbGF5ZXJWYXJzIiwibGlzdFR5cGUiLCJsaXN0IiwiYXV0b3BsYXkiLCJjb250cm9scyIsImxvb3AiLCJzaG93aW5mbyIsImV2ZW50cyIsIm9uRXJyb3IiLCJvblBsYXllckVycm9yIiwib25SZWFkeSIsIm9uUGxheWVyUmVhZHkiLCJvblN0YXRlQ2hhbmdlIiwib25QbGF5ZXJTdGF0ZUNoYW5nZSIsImV2ZW50IiwibmV4dFZpZGVvIiwicGxheWVyRXJyb3IiLCJlcnJvciIsImRlYnVnIiwic3RvcCIsIlN0b3JhZ2UiLCJpbml0Iiwic3RvcmFnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiZGV0YWlsIiwiX2luaXRpYWxMb2FkIiwiaGFzT3duUHJvcGVydHkiLCJjaGFuZ2VkIiwic2V0QXR0cmlidXRlIiwiZm9sZGVyIiwiZmlsZU5hbWUiLCJjb21wYW55SWQiLCJnbyIsImdldEZyYW1lQ29udGFpbmVyIiwiaW5kZXgiLCJQUkVGSVgiLCJpZnJhbWUiLCJmcmFtZUNvbnRhaW5lciIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50V2luZG93IiwiY29udGVudERvY3VtZW50IiwiX2NsZWFyIiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJjcmVhdGVGcmFtZVBsYXllciIsInBhcmFtcyIsImZpbGVzIiwic2tpbiIsIm9ubG9hZCIsImxvYWQiLCJ2aXNpYmlsaXR5IiwiY2FsbGJhY2siLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJNZXNzYWdlIiwibWFpbkNvbnRhaW5lciIsIm1lc3NhZ2VDb250YWluZXIiLCJfaW5pdCIsIndhcm4iLCJtZXNzYWdlIiwiX2FjdGl2ZSIsImRpc3BsYXkiLCJwIiwiZnJhZ21lbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwiaW5uZXJIVE1MIiwibGluZUhlaWdodCIsIndpbmRvdyIsInBvbHltZXJSZWFkeSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJpZCIsInJlZ2lzdGVyIiwicHJlZnMiLCJvbmNvbnRleHRtZW51IiwiX2dhcSIsInB1c2giLCJnYSIsInR5cGUiLCJhc3luYyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJzIl0sIm1hcHBpbmdzIjoiQUFpQkEsUUFBU0EsMEJBQXlCQyxFQUFZQyxFQUFpQkMsR0FDN0QsR0FBSUMsR0FBUyxzQ0FFYkMsU0FBUUMsSUFBSSxtQkFBb0JMLEdBRWhDTSxFQUFFQyxNQUNBQyxJQUFLLHlEQUEyREwsRUFBUyxnQ0FBa0NILElBQzFHUyxLQUFLLFNBQVVDLEdBQ2hCLElBQUtBLElBQVNBLEVBQUtDLE9BS2pCLE1BSkFQLFNBQVFDLElBQUksaUNBQWtDSyxHQUMxQ1IsR0FDRkEsSUFFRixNQUlGLElBQUlVLEdBQVlGLEVBQUtDLE9BQU9FLFlBQ3hCQyxFQUFZRixFQUFVRyxVQUFVSCxFQUFVSSxRQUFRLFVBQVksRUFTbEVaLFNBQVFDLElBQUksaUNBQWtDTyxFQUFXRSxHQUd6RGIsRUFBZ0JhLEtBN0NwQixHQUFzQixtQkFBWEcsUUFBd0IsQ0FDakMsR0FBSUEsU0FDRkMsS0FBTSxrQkFDTkMsWUFBYSxPQUdRLG9CQUFaQyxVQUNUQSxRQUFR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SixXQUFXQyxhQUFhb0osRUFBSUsiLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICBTS0lOOiBcInNraW4vUlZTa2luLnhtbFwiLFxuICAgIFNUT1JBR0VfRU5WOiBcInByb2RcIlxuICB9O1xuXG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1BSRUZJWFwiLCBcImxvY2FsZXMvdHJhbnNsYXRpb25fXCIpXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1NVRklYXCIsIFwiLmpzb25cIik7XG4gIH1cbn1cblxyXG4ndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIGxvYWRWaWRlb0xpbmtGcm9tWExTdWl0ZShkaXNwbGF5S2V5LCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcbiAgdmFyIGFwaUtleSA9IFwiMmFlNDVmYzItNzJiOS00NWNlLTk3NzEtY2FmMGZhYmY5Yzk3XCI7XG5cbiAgY29uc29sZS5sb2coXCJkaXNwbGF5S2V5IHBhcmFtXCIsIGRpc3BsYXlLZXkpO1xuXG4gICQuYWpheCh7XG4gICAgdXJsOiBcImh0dHBzOi8vcm4ueGxzdWl0ZS5jb20vYWRtaW4vYXBpL2xpcXVpZHMvY2FsbD9hcGlfa2V5PVwiICsgYXBpS2V5ICsgXCImdGFnPWxvYWRfc2NyZWVuJmRpc3BsYXlfa2V5PVwiICsgZGlzcGxheUtleVxuICB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgaWYgKCFkYXRhIHx8ICFkYXRhLnNjcmVlbikge1xuICAgICAgY29uc29sZS5sb2coXCJFcnJvciAtIFJldHVybmVkIGRhdGEgaXMgZW1wdHlcIiwgZGF0YSk7XG4gICAgICBpZiAoZXJyb3JDYWxsYmFjaykge1xuICAgICAgICBlcnJvckNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy90b2RvOiBzYXZlIGNoYW5uZWwgVVJMIHRvIHNvbWUgIHNldHRpbmdzIC8gdmFyaWFibGVcbiAgICB2YXIgY2hhbmVsVXJsID0gZGF0YS5zY3JlZW4uY2hhbm5lbF91cmw7XG4gICAgdmFyIGNoYW5uZWxJZCA9IGNoYW5lbFVybC5zdWJzdHJpbmcoY2hhbmVsVXJsLmluZGV4T2YoXCI/bGlzdD1cIikgKyA2KTtcblxuICAgIC8vdmFyIGZ1bGxVcmwgPSBjaGFuZWxVcmwgK1xuICAgIC8vICBcIiZhbXA7YXV0b3BsYXk9MVwiICtcbiAgICAvLyAgXCImYW1wO2VuYWJsZWpzYXBpPTFcIiArXG4gICAgLy8gIFwiJmFtcDtsb29wPTFcIiArXG4gICAgLy8gIFwiJmFtcDtjb250cm9scz0wXCIgK1xuICAgIC8vICBcIiZhbXA7c2hvd2luZm89MCBmcmFtZWJvcmRlcj0wXCI7XG5cbiAgICBjb25zb2xlLmxvZyhcIkxvYWRlZCBjaGFubmVsIFVSTCwgY2hhbm5lbCBJRFwiLCBjaGFuZWxVcmwsIGNoYW5uZWxJZCk7XG4gIC8vICBjb25zb2xlLmxvZyhcIkZ1bGwgVVJMXCIsIGZ1bGxVcmwpO1xuXG4gICAgc3VjY2Vzc0NhbGxiYWNrKGNoYW5uZWxJZCk7XG5cbiAgICAvL1JOIC0gaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvdmlkZW9zZXJpZXM/bGlzdD1QTG41NlZieE9TNzdmZC1xYlp3MG12blMyUG1fX3R2U0haXG4gICAgLy9teSAtIGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkL3ZpZGVvc2VyaWVzP2xpc3Q9UEw0OFpHd0Nwd1B5RlZpRUxnc252VWtuUnpKeW8yZ09oQVxuXG4gICAgLy90b2RvOiBmaXggZW1iZWRkZWQgZXJyb3JzXG4gICAgLy9odHRwczovL3d3dy5kcnVwYWwub3JnL25vZGUvMTg4NzgxOFxuICAgIC8vaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMjUyMjI5MS9wYXVzaW5nLXlvdXR1YmUtaWZyYW1lLWFwaS1pbi1qYXZhc2NyaXB0XG4gICAgLy9odHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzgyMDUxNzkveW91dHViZS1hcGktaGFuZGxpbmctdmlkZW9zLXRoYXQtaGF2ZS1iZWVuLXJlbW92ZWQtYnkteW91dHViZVxuXG4gIH0pO1xuXG59XG5cclxuLyogZ2xvYmFsIGdhZGdldHMsIGNvbmZpZyAqL1xuXG52YXIgdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG50YWcuc3JjID0gXCJodHRwczovL3d3dy55b3V0dWJlLmNvbS9pZnJhbWVfYXBpXCI7XG5cbnZhciBmaXJzdFNjcmlwdFRhZyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKVswXTtcbmZpcnN0U2NyaXB0VGFnLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRhZywgZmlyc3RTY3JpcHRUYWcpO1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvID0ge307XG5cblJpc2VWaXNpb24uVmlkZW8gPSAoZnVuY3Rpb24gKGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9hZGRpdGlvbmFsUGFyYW1zO1xuXG4gIHZhciBfcHJlZnMgPSBudWxsLFxuICAgIF9zdG9yYWdlID0gbnVsbCxcbiAgICBfbWVzc2FnZSA9IG51bGwsXG4gICAgX2ZyYW1lQ29udHJvbGxlciA9IG51bGw7XG5cbiAgdmFyIF9wbGF5YmFja0Vycm9yID0gZmFsc2UsXG4gICAgX2lzU3RvcmFnZUZpbGUgPSBmYWxzZSxcbiAgICBfdmlld2VyUGF1c2VkID0gdHJ1ZTtcblxuICB2YXIgX2N1cnJlbnRGcmFtZSA9IDA7XG5cbiAgdmFyIF9zZXBhcmF0b3IgPSBcIlwiLFxuICAgIF9jdXJyZW50RmlsZSA9IFwiXCI7XG5cbiAgdmFyIGRpc3BsYXlJZDtcblxuICB2YXIgX3JlZnJlc2hEdXJhdGlvbiA9IDkwMDAwMCwgIC8vIDE1IG1pbnV0ZXNcbiAgICBfcmVmcmVzaEludGVydmFsSWQgPSBudWxsO1xuXG4gIHZhciB4bFN1aXRlUGxheWxpc3RSZWZyZXNoRHVyYXRpb24gPSA1MDAwOyAvLzUgc2VjXG5cbiAgdmFyIF9ub0ZpbGVUaW1lciA9IG51bGwsXG4gICAgX25vRmlsZUZsYWcgPSBmYWxzZTtcblxuICB2YXIgX3BsYXlsaXN0Q2hhbmdlVGltZXIgPSBudWxsO1xuXG4gIHZhciB5b3V0dWJlUGxheWVySlMgPSBudWxsO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9jbGVhck5vRmlsZVRpbWVyKCkge1xuICAgIGNsZWFyVGltZW91dChfbm9GaWxlVGltZXIpO1xuICAgIF9ub0ZpbGVUaW1lciA9IG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBfZG9uZSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9kb25lXCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSk7XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWFkeSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9yZWFkeVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIiksXG4gICAgICB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWZyZXNoSW50ZXJ2YWwoZHVyYXRpb24pIHtcbiAgICBfcmVmcmVzaEludGVydmFsSWQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiB2aWRlb1JlZnJlc2goKSB7XG4gICAgICAvLyBzZXQgbmV3IHZhbHVlIG9mIG5vbiByaXNlLXN0b3JhZ2UgdXJsIHdpdGggYSBjYWNoZWJ1c3RlclxuICAgICAgX2N1cnJlbnRGaWxlID0gX2FkZGl0aW9uYWxQYXJhbXMudXJsICsgX3NlcGFyYXRvciArIFwiY2I9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcblxuICAgICAgLy8gaW4gY2FzZSByZWZyZXNoZWQgZmlsZSBmaXhlcyBhbiBlcnJvciB3aXRoIHByZXZpb3VzIGZpbGUsIGVuc3VyZSBmbGFnIGlzIHJlbW92ZWQgc28gcGxheWJhY2sgaXMgYXR0ZW1wdGVkIGFnYWluXG4gICAgICBfcGxheWJhY2tFcnJvciA9IGZhbHNlO1xuXG4gICAgfSwgZHVyYXRpb24pO1xuICB9XG5cbiAgZnVuY3Rpb24gX3N0YXJ0Tm9GaWxlVGltZXIoKSB7XG4gICAgX2NsZWFyTm9GaWxlVGltZXIoKTtcblxuICAgIF9ub0ZpbGVUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgLy8gbm90aWZ5IFZpZXdlciB3aWRnZXQgaXMgZG9uZVxuICAgICAgX2RvbmUoKTtcbiAgICB9LCA1MDAwKTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gbm9TdG9yYWdlRmlsZSgpIHtcbiAgICBfbm9GaWxlRmxhZyA9IHRydWU7XG4gICAgX2N1cnJlbnRGaWxlID0gXCJcIjtcblxuICAgIF9tZXNzYWdlLnNob3coXCJUaGUgc2VsZWN0ZWQgdmlkZW8gZG9lcyBub3QgZXhpc3QuXCIpO1xuXG4gICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSwgZnVuY3Rpb24gKCkge1xuICAgICAgLy8gaWYgV2lkZ2V0IGlzIHBsYXlpbmcgcmlnaHQgbm93LCBydW4gdGhlIHRpbWVyXG4gICAgICBpZiAoIV92aWV3ZXJQYXVzZWQpIHtcbiAgICAgICAgX3N0YXJ0Tm9GaWxlVGltZXIoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZUluaXQodXJsKSB7XG4gICAgX2N1cnJlbnRGaWxlID0gdXJsO1xuXG4gICAgX21lc3NhZ2UuaGlkZSgpO1xuXG4gICAgaWYgKCFfdmlld2VyUGF1c2VkKSB7XG4gICAgICBwbGF5KCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gb25TdG9yYWdlUmVmcmVzaCh1cmwpIHtcbiAgICBfY3VycmVudEZpbGUgPSB1cmw7XG5cbiAgICAvLyBpbiBjYXNlIHJlZnJlc2hlZCBmaWxlIGZpeGVzIGFuIGVycm9yIHdpdGggcHJldmlvdXMgZmlsZSwgZW5zdXJlIGZsYWcgaXMgcmVtb3ZlZCBzbyBwbGF5YmFjayBpcyBhdHRlbXB0ZWQgYWdhaW5cbiAgICBfcGxheWJhY2tFcnJvciA9IGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgdmFyIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcblxuICAgIF92aWV3ZXJQYXVzZWQgPSB0cnVlO1xuXG4gICAgaWYgKF9ub0ZpbGVGbGFnKSB7XG4gICAgICBfY2xlYXJOb0ZpbGVUaW1lcigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgZnJhbWVPYmoucGF1c2UoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAvLyAgY29uc29sZS5sb2coXCJQbGF5IGV2ZW50IFwiKTtcbiAgICB2YXIgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuXG4gICAgX3ZpZXdlclBhdXNlZCA9IGZhbHNlO1xuXG4gICAgaWYgKF9ub0ZpbGVGbGFnKSB7XG4gICAgICBfc3RhcnROb0ZpbGVUaW1lcigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghX3BsYXliYWNrRXJyb3IpIHtcbiAgICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgICBmcmFtZU9iai5wbGF5KCk7XG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgIC8vaWYgKF9jdXJyZW50RmlsZSAmJiBfY3VycmVudEZpbGUgIT09IFwiXCIpIHtcbiAgICAgICAgLy8gIC8vIGFkZCBmcmFtZSBhbmQgY3JlYXRlIHRoZSBwbGF5ZXJcbiAgICAgICAgLy8gIF9mcmFtZUNvbnRyb2xsZXIuYWRkKDApO1xuICAgICAgICAvLyAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcigwLCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlLCBjb25maWcuU0tJTiwgXCJwbGF5ZXIuaHRtbFwiKTtcbiAgICAgICAgLy99XG5cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVGhpcyBmbGFnIG9ubHkgZ290IHNldCB1cG9uIGEgcmVmcmVzaCBvZiBoaWRkZW4gZnJhbWUgYW5kIHRoZXJlIHdhcyBhbiBlcnJvciBpbiBzZXR1cCBvciB2aWRlb1xuICAgICAgLy8gU2VuZCBWaWV3ZXIgXCJkb25lXCJcbiAgICAgIF9kb25lKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyRW5kZWQoKSB7XG4gICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSwgZnVuY3Rpb24gKCkge1xuICAgICAgX2RvbmUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllclJlYWR5KCkge1xuICAgIHZhciBmcmFtZU9iajtcblxuICAgIC8vIG5vbi1zdG9yYWdlLCBjaGVjayBpZiByZWZyZXNoIGludGVydmFsIGV4aXN0cyB5ZXQsIHN0YXJ0IGl0IGlmIG5vdFxuICAgIGlmICghX2lzU3RvcmFnZUZpbGUgJiYgX3JlZnJlc2hJbnRlcnZhbElkID09PSBudWxsKSB7XG4gICAgICBfcmVmcmVzaEludGVydmFsKF9yZWZyZXNoRHVyYXRpb24pO1xuICAgIH1cblxuICAgIGlmICghX3ZpZXdlclBhdXNlZCkge1xuICAgICAgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuICAgICAgZnJhbWVPYmoucGxheSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHN0YXJ0UGxheWxpc3RDaGFuZ2VUaW1lcigpIHtcbiAgICBjbGVhclRpbWVvdXQoX3BsYXlsaXN0Q2hhbmdlVGltZXIpO1xuXG4gICAgX3BsYXlsaXN0Q2hhbmdlVGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkludGVydmFsIGNoZWNrXCIpO1xuXG4gICAgICBsb2FkVmlkZW9MaW5rRnJvbVhMU3VpdGUoZGlzcGxheUlkLCBmdW5jdGlvbiAodmlkZW9VcmwpIHtcbiAgICAgICAgaWYgKHZpZGVvVXJsICE9IF9jdXJyZW50RmlsZSkge1xuICAgICAgICAgIF9jdXJyZW50RmlsZSA9IHZpZGVvVXJsO1xuICAgICAgICAgIGluaXRZVFBsYXllcihfY3VycmVudEZpbGUsIF9hZGRpdGlvbmFsUGFyYW1zLndpZHRoLCBfYWRkaXRpb25hbFBhcmFtcy5oZWlnaHQpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIH0sIHhsU3VpdGVQbGF5bGlzdFJlZnJlc2hEdXJhdGlvbik7XG5cbiAgICAvL2lmICh5b3V0dWJlUGxheWVySlMgIT0gbnVsbCkge1xuICAgIC8vICB2YXIgc3RhdGUgPSB5b3V0dWJlUGxheWVySlMuZ2V0UGxheWVyU3RhdGUoKTtcbiAgICAvLyAgY29uc29sZS5sb2coXCJUaW1lciBwbGF5ZXIgc3RhdGVcIiwgc3RhdGUpO1xuICAgIC8vfVxuICB9XG5cbiAgZnVuY3Rpb24gc2V0QWRkaXRpb25hbFBhcmFtcyhuYW1lcywgdmFsdWVzKSB7XG4gICAgY29uc29sZS5sb2coXCJhZGRpdGlvbmFsIHBhcmFtcyB2YWx1ZXNcIiwgdmFsdWVzKTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShuYW1lcykgJiYgbmFtZXMubGVuZ3RoID4gMCAmJiBuYW1lc1swXSA9PT0gXCJhZGRpdGlvbmFsUGFyYW1zXCIpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlcykgJiYgdmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMgPSBKU09OLnBhcnNlKHZhbHVlc1swXSk7XG4gICAgICAgIF9wcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCk7XG5cbiAgICAgICAgaWYgKCFfYWRkaXRpb25hbFBhcmFtcykge1xuICAgICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zID0ge307XG4gICAgICAgICAgY29uc29sZS5sb2coXCJhZGRpdGlvbmFsIHBhcmFtcyByZWNyZWF0ZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvQ29udGFpbmVyXCIpLnN0eWxlLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIikgKyBcInB4XCI7XG5cbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMud2lkdGggPSBfcHJlZnMuZ2V0SW50KFwicnNXXCIpO1xuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpO1xuXG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIgPSBuZXcgUmlzZVZpc2lvbi5Db21tb24uVmlkZW8uRnJhbWVDb250cm9sbGVyKCk7XG5cbiAgICAgICAgX2lzU3RvcmFnZUZpbGUgPSBmYWxzZTtcblxuICAgICAgICBpZiAoX3ByZWZzLmdldFN0cmluZyhcImRpc3BsYXlJZFwiKSkge1xuICAgICAgICAgIGRpc3BsYXlJZCA9IF9wcmVmcy5nZXRTdHJpbmcoXCJkaXNwbGF5SWRcIik7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJkaXNwbGF5SWQgc2V0IGZyb20gY2hyb21lQXBwIHBhcmFtXCIsIGRpc3BsYXlJZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGlzcGxheUlkID0gX2FkZGl0aW9uYWxQYXJhbXMuZGlzcGxheUlkO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiZGlzcGxheUlkIHNldCBmcm9tIGRlZmF1bHQgc2V0dGluZ3NcIiwgZGlzcGxheUlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvYWRWaWRlb0xpbmtGcm9tWExTdWl0ZShkaXNwbGF5SWQsIHN0YXJ0WExTdWl0ZVBsYXllciwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKGRpc3BsYXlJZCAhPSBfcHJlZnMuZ2V0U3RyaW5nKFwiZGlzcGxheUlkXCIpKSB7XG4gICAgICAgICAgICBkaXNwbGF5SWQgPSBfYWRkaXRpb25hbFBhcmFtcy5kaXNwbGF5SWQ7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRyeWluZyB0byB1c2UgZGVmYXVsdCBkaXNwbGF5SWRcIiwgZGlzcGxheUlkKTtcbiAgICAgICAgICAgIGxvYWRWaWRlb0xpbmtGcm9tWExTdWl0ZShkaXNwbGF5SWQsIHN0YXJ0WExTdWl0ZVBsYXllcik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzdGFydFhMU3VpdGVQbGF5ZXIodmlkZW9VcmwpIHtcbiAgICBfY3VycmVudEZpbGUgPSB2aWRlb1VybDtcbiAgICBpbml0WVRQbGF5ZXIoX2N1cnJlbnRGaWxlLCBfYWRkaXRpb25hbFBhcmFtcy53aWR0aCwgX2FkZGl0aW9uYWxQYXJhbXMuaGVpZ2h0KTtcbiAgICBzdGFydFBsYXlsaXN0Q2hhbmdlVGltZXIoKTtcblxuICAgIF9yZWFkeSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5pdFlUUGxheWVyKHBsYXlsaXN0SWQsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAvL3ZhciAkbWFpbklmcmFtZSA9ICQoJyNtYWluSWZyYW1lJyk7XG4gICAgLy8kbWFpbklmcmFtZS5hdHRyKCdzcmMnLCBwbGF5bGlzdFNyYyk7XG4gICAgLy8kbWFpbklmcmFtZS5hdHRyKCd3aWR0aCcsIHdpZHRoKTtcbiAgICAvLyRtYWluSWZyYW1lLmF0dHIoJ2hlaWdodCcsIGhlaWdodCk7XG5cbiAgICBjb25zb2xlLmxvZyhcIlZpZGVvIHVybCwgdywgaFwiLCBwbGF5bGlzdElkLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgIHlvdXR1YmVQbGF5ZXJKUyA9IG5ldyBZVC5QbGF5ZXIoJ21haW5JZnJhbWUnLCB7XG4gICAgICB3aWR0aDogd2lkdGgsXG4gICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgIHBsYXllclZhcnM6IHtcbiAgICAgICAgbGlzdFR5cGU6J3BsYXlsaXN0JyxcbiAgICAgICAgbGlzdDogcGxheWxpc3RJZCxcbiAgICAgICAgJ2F1dG9wbGF5JzogMSxcbiAgICAgICAgJ2NvbnRyb2xzJzogMCxcbiAgICAgICAgJ2xvb3AnOiAxLFxuICAgICAgICAnc2hvd2luZm8nOiAwXG4gICAgICB9LFxuICAgICAgZXZlbnRzOiB7XG4gICAgICAgICdvbkVycm9yJzogb25QbGF5ZXJFcnJvcixcbiAgICAgICAgJ29uUmVhZHknOiBvblBsYXllclJlYWR5LFxuICAgICAgICAnb25TdGF0ZUNoYW5nZSc6IG9uUGxheWVyU3RhdGVDaGFuZ2VcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uUGxheWVyRXJyb3IoZXZlbnQpIHtcbiAgICBjb25zb2xlLmxvZyhcIlBsYXllciBlcnJvciBjb2RlXCIsIGV2ZW50KTtcbiAgICBpZiAoeW91dHViZVBsYXllckpTICYmIHlvdXR1YmVQbGF5ZXJKUyAhPSBudWxsICYmIGV2ZW50ICYmIGV2ZW50LmRhdGEgPj0gMTAwKSB7XG4gICAgICB5b3V0dWJlUGxheWVySlMubmV4dFZpZGVvKCk7XG4gICAgICBjb25zb2xlLmxvZyhcIkVycm9yLCBwbGF5aW5nIG5leHQgdmlkZW9cIiwgZXZlbnQpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG9uUGxheWVyU3RhdGVDaGFuZ2UoZXZlbnQpIHtcbiAgLy8gIGNvbnNvbGUubG9nKFwiT24gcGxheWVyIHN0YXRlIGNoYW5nZVwiLCBldmVudCk7XG4gIH1cblxuICBmdW5jdGlvbiBvblBsYXllclJlYWR5KGV2ZW50KSB7XG4vLyAgICBjb25zb2xlLmxvZyhcIk9uIHBsYXllciByZWFkeVwiLCBldmVudCk7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFcnJvcihlcnJvcikge1xuICAgIGNvbnNvbGUuZGVidWcoXCJ2aWRlby1mb2xkZXI6OnBsYXllckVycm9yKClcIiwgZXJyb3IpO1xuXG4gICAgLy8gZmxhZyB0aGUgdmlkZW8gaGFzIGFuIGVycm9yXG4gICAgX3BsYXliYWNrRXJyb3IgPSB0cnVlO1xuXG4gICAgLy8gYWN0IGFzIHRob3VnaCB2aWRlbyBoYXMgZW5kZWRcbiAgICBwbGF5ZXJFbmRlZCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBwYXVzZSgpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcIm5vU3RvcmFnZUZpbGVcIjogbm9TdG9yYWdlRmlsZSxcbiAgICBcIm9uU3RvcmFnZUluaXRcIjogb25TdG9yYWdlSW5pdCxcbiAgICBcIm9uU3RvcmFnZVJlZnJlc2hcIjogb25TdG9yYWdlUmVmcmVzaCxcbiAgICBcInBhdXNlXCI6IHBhdXNlLFxuICAgIFwicGxheVwiOiBwbGF5LFxuICAgIFwic2V0QWRkaXRpb25hbFBhcmFtc1wiOiBzZXRBZGRpdGlvbmFsUGFyYW1zLFxuICAgIFwicGxheWVyRW5kZWRcIjogcGxheWVyRW5kZWQsXG4gICAgXCJwbGF5ZXJSZWFkeVwiOiBwbGF5ZXJSZWFkeSxcbiAgICBcInBsYXllckVycm9yXCI6IHBsYXllckVycm9yLFxuICAgIFwic3RvcFwiOiBzdG9wXG4gIH07XG5cbn0pKGdhZGdldHMpO1xuXHJcbi8qIGdsb2JhbCBjb25maWcgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlbyA9IFJpc2VWaXNpb24uVmlkZW8gfHwge307XG5cblJpc2VWaXNpb24uVmlkZW8uU3RvcmFnZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfaW5pdGlhbExvYWQgPSB0cnVlO1xuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICB2YXIgc3RvcmFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9TdG9yYWdlXCIpO1xuXG4gICAgaWYgKCFzdG9yYWdlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGlmIChlLmRldGFpbCAmJiBlLmRldGFpbC51cmwpIHtcblxuICAgICAgICBpZiAoX2luaXRpYWxMb2FkKSB7XG4gICAgICAgICAgX2luaXRpYWxMb2FkID0gZmFsc2U7XG5cbiAgICAgICAgICBSaXNlVmlzaW9uLlZpZGVvLm9uU3RvcmFnZUluaXQoZS5kZXRhaWwudXJsKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAvLyBjaGVjayBmb3IgXCJjaGFuZ2VkXCIgcHJvcGVydHkgYW5kIGVuc3VyZSBpdCBpcyB0cnVlXG4gICAgICAgICAgaWYgKGUuZGV0YWlsLmhhc093blByb3BlcnR5KFwiY2hhbmdlZFwiKSAmJiBlLmRldGFpbC5jaGFuZ2VkKSB7XG4gICAgICAgICAgICBSaXNlVmlzaW9uLlZpZGVvLm9uU3RvcmFnZVJlZnJlc2goZS5kZXRhaWwudXJsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1uby1maWxlXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby5ub1N0b3JhZ2VGaWxlKCk7XG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBkYXRhLnN0b3JhZ2UuZm9sZGVyKTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZpbGVOYW1lXCIsIGRhdGEuc3RvcmFnZS5maWxlTmFtZSk7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgZGF0YS5zdG9yYWdlLmNvbXBhbnlJZCk7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJlbnZcIiwgY29uZmlnLlNUT1JBR0VfRU5WKTtcbiAgICBzdG9yYWdlLmdvKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaW5pdFwiOiBpbml0XG4gIH07XG59O1xuXHJcbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcclxuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcclxuXHJcblJpc2VWaXNpb24uQ29tbW9uLlZpZGVvID0gUmlzZVZpc2lvbi5Db21tb24uVmlkZW8gfHwge307XHJcblxyXG5SaXNlVmlzaW9uLkNvbW1vbi5WaWRlby5GcmFtZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gIHZhciBQUkVGSVggPSBcImlmX1wiO1xyXG5cclxuICBmdW5jdGlvbiBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCkge1xyXG4gICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGdldEZyYW1lT2JqZWN0KGluZGV4KSB7XHJcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXHJcbiAgICAgIGlmcmFtZTtcclxuXHJcbiAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xyXG5cclxuICAgIGlmIChpZnJhbWUpIHtcclxuICAgICAgcmV0dXJuIChpZnJhbWUuY29udGVudFdpbmRvdykgPyBpZnJhbWUuY29udGVudFdpbmRvdyA6XHJcbiAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBfY2xlYXIoaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcclxuICAgICAgZnJhbWVPYmogPSBnZXRGcmFtZU9iamVjdChpbmRleCksXHJcbiAgICAgIGlmcmFtZTtcclxuXHJcbiAgICBpZiAoZnJhbWVPYmopIHtcclxuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcclxuICAgICAgZnJhbWVPYmoucmVtb3ZlKCk7XHJcbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgXCJhYm91dDpibGFua1wiKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGFkZChpbmRleCkge1xyXG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxyXG4gICAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpO1xyXG5cclxuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJhbGxvd1RyYW5zcGFyZW5jeVwiLCB0cnVlKTtcclxuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJmcmFtZWJvcmRlclwiLCBcIjBcIik7XHJcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic2Nyb2xsaW5nXCIsIFwibm9cIik7XHJcblxyXG4gICAgZnJhbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGNyZWF0ZUZyYW1lUGxheWVyKGluZGV4LCBwYXJhbXMsIGZpbGVzLCBza2luLCBzcmMpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcclxuICAgICAgZnJhbWVPYmogPSBnZXRGcmFtZU9iamVjdChpbmRleCksXHJcbiAgICAgIGlmcmFtZTtcclxuXHJcbiAgICBpZiAoZnJhbWVPYmopIHtcclxuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcclxuXHJcbiAgICAgIGlmcmFtZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWZyYW1lLm9ubG9hZCA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGluaXRpYWxpemUgYW5kIGxvYWQgdGhlIHBsYXllciBpbnNpZGUgdGhlIGlmcmFtZVxyXG4gICAgICAgIGZyYW1lT2JqLmluaXQocGFyYW1zLCBmaWxlcywgc2tpbik7XHJcbiAgICAgICAgZnJhbWVPYmoubG9hZCgpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBzcmMpO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGhpZGUoaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KTtcclxuXHJcbiAgICBmcmFtZUNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHJlbW92ZShpbmRleCwgY2FsbGJhY2spIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcclxuXHJcbiAgICBfY2xlYXIoaW5kZXgpO1xyXG5cclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAvLyByZW1vdmUgdGhlIGlmcmFtZSBieSBjbGVhcmluZyBhbGwgZWxlbWVudHMgaW5zaWRlIGRpdiBjb250YWluZXJcclxuICAgICAgd2hpbGUgKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpIHtcclxuICAgICAgICBmcmFtZUNvbnRhaW5lci5yZW1vdmVDaGlsZChmcmFtZUNvbnRhaW5lci5maXJzdENoaWxkKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGNhbGxiYWNrICYmIHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgfVxyXG4gICAgfSwgMjAwKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNob3coaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KTtcclxuXHJcbiAgICBmcmFtZUNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgYWRkOiBhZGQsXHJcbiAgICBjcmVhdGVGcmFtZVBsYXllcjogY3JlYXRlRnJhbWVQbGF5ZXIsXHJcbiAgICBnZXRGcmFtZUNvbnRhaW5lcjogZ2V0RnJhbWVDb250YWluZXIsXHJcbiAgICBnZXRGcmFtZU9iamVjdDogZ2V0RnJhbWVPYmplY3QsXHJcbiAgICBoaWRlOiBoaWRlLFxyXG4gICAgcmVtb3ZlOiByZW1vdmUsXHJcbiAgICBzaG93OiBzaG93XHJcbiAgfTtcclxufTtcclxuXHJcbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcclxuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcclxuXHJcblJpc2VWaXNpb24uQ29tbW9uLk1lc3NhZ2UgPSBmdW5jdGlvbiAobWFpbkNvbnRhaW5lciwgbWVzc2FnZUNvbnRhaW5lcikge1xyXG4gIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICB2YXIgX2FjdGl2ZSA9IGZhbHNlO1xyXG5cclxuICBmdW5jdGlvbiBfaW5pdCgpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gbWFpbkNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihcIkNhbid0IGluaXRpYWxpemUgTWVzc2FnZSAtIFwiLCBlLm1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiAgUHVibGljIE1ldGhvZHNcclxuICAgKi9cclxuICBmdW5jdGlvbiBoaWRlKCkge1xyXG4gICAgaWYgKF9hY3RpdmUpIHtcclxuICAgICAgLy8gY2xlYXIgY29udGVudCBvZiBtZXNzYWdlIGNvbnRhaW5lclxyXG4gICAgICB3aGlsZSAobWVzc2FnZUNvbnRhaW5lci5maXJzdENoaWxkKSB7XHJcbiAgICAgICAgbWVzc2FnZUNvbnRhaW5lci5yZW1vdmVDaGlsZChtZXNzYWdlQ29udGFpbmVyLmZpcnN0Q2hpbGQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBoaWRlIG1lc3NhZ2UgY29udGFpbmVyXHJcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG5cclxuICAgICAgLy8gc2hvdyBtYWluIGNvbnRhaW5lclxyXG4gICAgICBtYWluQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcclxuXHJcbiAgICAgIF9hY3RpdmUgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNob3cobWVzc2FnZSkge1xyXG4gICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLFxyXG4gICAgICBwO1xyXG5cclxuICAgIGlmICghX2FjdGl2ZSkge1xyXG4gICAgICAvLyBoaWRlIG1haW4gY29udGFpbmVyXHJcbiAgICAgIG1haW5Db250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XHJcblxyXG4gICAgICBtZXNzYWdlQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcblxyXG4gICAgICAvLyBjcmVhdGUgbWVzc2FnZSBlbGVtZW50XHJcbiAgICAgIHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcclxuICAgICAgcC5pbm5lckhUTUwgPSBtZXNzYWdlO1xyXG4gICAgICBwLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwibWVzc2FnZVwiKTtcclxuICAgICAgcC5zdHlsZS5saW5lSGVpZ2h0ID0gbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7XHJcblxyXG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChwKTtcclxuICAgICAgbWVzc2FnZUNvbnRhaW5lci5hcHBlbmRDaGlsZChmcmFnbWVudCk7XHJcblxyXG4gICAgICBfYWN0aXZlID0gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIG1lc3NhZ2UgYWxyZWFkeSBiZWluZyBzaG93biwgdXBkYXRlIG1lc3NhZ2UgdGV4dFxyXG4gICAgICBwID0gbWVzc2FnZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiLm1lc3NhZ2VcIik7XHJcbiAgICAgIHAuaW5uZXJIVE1MID0gbWVzc2FnZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9pbml0KCk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBcImhpZGVcIjogaGlkZSxcclxuICAgIFwic2hvd1wiOiBzaG93XHJcbiAgfTtcclxufTtcclxuXHJcbi8qIGdsb2JhbCBnYWRnZXRzLCBSaXNlVmlzaW9uICovXG5cbihmdW5jdGlvbiAod2luZG93LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBwcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCksXG4gICAgaWQgPSBwcmVmcy5nZXRTdHJpbmcoXCJpZFwiKTtcblxuICAvLyBEaXNhYmxlIGNvbnRleHQgbWVudSAocmlnaHQgY2xpY2sgbWVudSlcbiAgd2luZG93Lm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5wbGF5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8uc3RvcCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9seW1lclJlYWR5KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbiAgICBpZiAoaWQgJiYgaWQgIT09IFwiXCIpIHtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGxheV9cIiArIGlkLCBwbGF5KTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGF1c2VfXCIgKyBpZCwgcGF1c2UpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9zdG9wX1wiICsgaWQsIHN0b3ApO1xuXG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzcGFyYW1fc2V0X1wiICsgaWQsIFJpc2VWaXNpb24uVmlkZW8uc2V0QWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNwYXJhbV9nZXRcIiwgbnVsbCwgaWQsIFtcImFkZGl0aW9uYWxQYXJhbXNcIl0pO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXHJcbi8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbnZhciBfZ2FxID0gX2dhcSB8fCBbXTtcblxuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNTcwOTIxNTktMiddKTtcbl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pO1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOyBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IGdhLmFzeW5jID0gdHJ1ZTtcbiAgZ2Euc3JjID0gKCdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID8gJ2h0dHBzOi8vc3NsJyA6ICdodHRwOi8vd3d3JykgKyAnLmdvb2dsZS1hbmFseXRpY3MuY29tL2dhLmpzJztcbiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07IHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpO1xufSkoKTtcbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
