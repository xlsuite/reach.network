if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml",STORAGE_ENV:"prod"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e){"use strict";function t(){clearTimeout(F),F=null}function i(){e.rpc.call("","rsevent_done",null,v.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,v.getString("id"),!0,!0,!0,!0,!0)}function o(e){I=setInterval(function(){_=p.url+E+"cb="+(new Date).getTime(),C=!1},e)}function r(){t(),F=setTimeout(function(){i()},5e3)}function s(){P=!0,_="",h.show("The selected video does not exist."),R.remove(S,function(){w||r()})}function a(e){_=e,h.hide(),w||d()}function l(e){_=e,C=!1}function c(){var e=R.getFrameObject(S);return w=!0,P?(t(),void 0):(e&&e.pause(),void 0)}function d(){var e=R.getFrameObject(S);return w=!1,P?(r(),void 0):(C?i():e?e.play():_&&""!==_&&(R.add(0),R.createFramePlayer(0,p,_,config.SKIN,"player.html")),void 0)}function u(){R.remove(S,function(){i()})}function m(){var e;b||null!==I||o(A),w||(e=R.getFrameObject(S),e.play())}function g(t,i){var o;Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(i)&&i.length>0&&(p=JSON.parse(i[0]),v=new e.Prefs,document.getElementById("videoContainer").style.height=v.getInt("rsH")+"px",p.width=v.getInt("rsW"),p.height=v.getInt("rsH"),h=new RiseVision.Common.Message(document.getElementById("videoContainer"),document.getElementById("messageContainer")),h.show("Please wait while your video is downloaded."),R=new RiseVision.Common.Video.FrameController,b=0!==Object.keys(p.storage).length,b?(V=new RiseVision.Video.Storage(p),V.init()):(o=p.url.split("?"),E=1===o.length?"?":"&",_=p.url),n())}function f(e){console.debug("video-folder::playerError()",e),C=!0,u()}function y(){c()}var p,v=null,V=null,h=null,R=null,C=!1,b=!1,w=!0,S=0,E="",_="",A=9e5,I=null,F=null,P=!1;return{noStorageFile:s,onStorageInit:a,onStorageRefresh:l,pause:c,play:d,setAdditionalParams:g,playerEnded:u,playerReady:m,playerError:f,stop:y}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoStorage");t&&(t.addEventListener("rise-storage-response",function(e){e.detail&&e.detail.url&&(i?(i=!1,RiseVision.Video.onStorageInit(e.detail.url)):e.detail.hasOwnProperty("changed")&&e.detail.changed&&RiseVision.Video.onStorageRefresh(e.detail.url))}),t.addEventListener("rise-storage-no-file",function(){RiseVision.Video.noStorageFile()}),t.setAttribute("folder",e.storage.folder),t.setAttribute("fileName",e.storage.fileName),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("env",config.STORAGE_ENV),t.go())}var i=!0;return{init:t}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function e(e){return document.getElementById(l+e)}function t(t){var i,n=e(t);return i=n.querySelector("iframe"),i?i.contentWindow?i.contentWindow:i.contentDocument.document?i.contentDocument.document:i.contentDocument:null}function i(i){var n,o=e(i),r=t(i);r&&(n=o.querySelector("iframe"),r.remove(),n.setAttribute("src","about:blank"))}function n(t){var i=e(t),n=document.createElement("iframe");n.setAttribute("allowTransparency",!0),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),i.appendChild(n)}function o(i,n,o,r,s){var a,l=e(i),c=t(i);c&&(a=l.querySelector("iframe"),a.onload=function(){a.onload=null,c.init(n,o,r),c.load()},a.setAttribute("src",s))}function r(t){var i=e(t);i.style.visibility="hidden"}function s(e,t){var n=document.getElementById(l+e);i(e),setTimeout(function(){for(;n.firstChild;)n.removeChild(n.firstChild);t&&"function"==typeof t&&t()},200)}function a(t){var i=e(t);i.style.visibility="visible"}var l="if_";return{add:n,createFramePlayer:o,getFrameContainer:e,getFrameObject:t,hide:r,remove:s,show:a}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Message=function(e,t){"use strict";function i(){try{t.style.height=e.style.height}catch(i){console.warn("Can't initialize Message - ",i.message)}}function n(){if(r){for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none",e.style.visibility="visible",r=!1}}function o(i){var n,o=document.createDocumentFragment();r?(n=t.querySelector(".message"),n.innerHTML=i):(e.style.visibility="hidden",t.style.display="block",n=document.createElement("p"),n.innerHTML=i,n.setAttribute("class","message"),n.style.lineHeight=t.style.height,o.appendChild(n),t.appendChild(o),r=!0)}var r=!1;return i(),{hide:n,show:o}},function(e,t){"use strict";function i(){RiseVision.Video.play()}function n(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function r(){e.removeEventListener("WebComponentsReady",r),a&&""!==a&&(t.rpc.register("rscmd_play_"+a,i),t.rpc.register("rscmd_pause_"+a,n),t.rpc.register("rscmd_stop_"+a,o),t.rpc.register("rsparam_set_"+a,RiseVision.Video.setAdditionalParams),t.rpc.call("","rsparam_get",null,a,["additionalParams"]))}var s=new t.Prefs,a=s.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("WebComponentsReady",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiU0tJTiIsIlNUT1JBR0VfRU5WIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiUmlzZVZpc2lvbiIsIlZpZGVvIiwiZ2FkZ2V0cyIsIl9jbGVhck5vRmlsZVRpbWVyIiwiY2xlYXJUaW1lb3V0IiwiX25vRmlsZVRpbWVyIiwiX2RvbmUiLCJycGMiLCJjYWxsIiwiX3ByZWZzIiwiZ2V0U3RyaW5nIiwiX3JlYWR5IiwiX3JlZnJlc2hJbnRlcnZhbCIsImR1cmF0aW9uIiwiX3JlZnJlc2hJbnRlcnZhbElkIiwic2V0SW50ZXJ2YWwiLCJfY3VycmVudEZpbGUiLCJfYWRkaXRpb25hbFBhcmFtcyIsInVybCIsIl9zZXBhcmF0b3IiLCJEYXRlIiwiZ2V0VGltZSIsIl9wbGF5YmFja0Vycm9yIiwiX3N0YXJ0Tm9GaWxlVGltZXIiLCJzZXRUaW1lb3V0Iiwibm9TdG9yYWdlRmlsZSIsIl9ub0ZpbGVGbGFnIiwiX21lc3NhZ2UiLCJzaG93IiwiX2ZyYW1lQ29udHJvbGxlciIsInJlbW92ZSIsIl9jdXJyZW50RnJhbWUiLCJfdmlld2VyUGF1c2VkIiwib25TdG9yYWdlSW5pdCIsImhpZGUiLCJwbGF5Iiwib25TdG9yYWdlUmVmcmVzaCIsInBhdXNlIiwiZnJhbWVPYmoiLCJnZXRGcmFtZU9iamVjdCIsImFkZCIsImNyZWF0ZUZyYW1lUGxheWVyIiwicGxheWVyRW5kZWQiLCJwbGF5ZXJSZWFkeSIsIl9pc1N0b3JhZ2VGaWxlIiwiX3JlZnJlc2hEdXJhdGlvbiIsInNldEFkZGl0aW9uYWxQYXJhbXMiLCJuYW1lcyIsInZhbHVlcyIsInN0ciIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsIkpTT04iLCJwYXJzZSIsIlByZWZzIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiaGVpZ2h0IiwiZ2V0SW50Iiwid2lkdGgiLCJDb21tb24iLCJNZXNzYWdlIiwiRnJhbWVDb250cm9sbGVyIiwiT2JqZWN0Iiwia2V5cyIsInN0b3JhZ2UiLCJfc3RvcmFnZSIsIlN0b3JhZ2UiLCJpbml0Iiwic3BsaXQiLCJwbGF5ZXJFcnJvciIsImVycm9yIiwiY29uc29sZSIsImRlYnVnIiwic3RvcCIsImRhdGEiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImRldGFpbCIsIl9pbml0aWFsTG9hZCIsImhhc093blByb3BlcnR5IiwiY2hhbmdlZCIsInNldEF0dHJpYnV0ZSIsImZvbGRlciIsImZpbGVOYW1lIiwiY29tcGFueUlkIiwiZ28iLCJnZXRGcmFtZUNvbnRhaW5lciIsImluZGV4IiwiUFJFRklYIiwiaWZyYW1lIiwiZnJhbWVDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudFdpbmRvdyIsImNvbnRlbnREb2N1bWVudCIsIl9jbGVhciIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsInBhcmFtcyIsImZpbGVzIiwic2tpbiIsInNyYyIsIm9ubG9hZCIsImxvYWQiLCJ2aXNpYmlsaXR5IiwiY2FsbGJhY2siLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJtYWluQ29udGFpbmVyIiwibWVzc2FnZUNvbnRhaW5lciIsIl9pbml0Iiwid2FybiIsIm1lc3NhZ2UiLCJfYWN0aXZlIiwiZGlzcGxheSIsInAiLCJmcmFnbWVudCIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJpbm5lckhUTUwiLCJsaW5lSGVpZ2h0Iiwid2luZG93IiwicG9seW1lclJlYWR5IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImlkIiwicmVnaXN0ZXIiLCJwcmVmcyIsIm9uY29udGV4dG1lbnUiLCJfZ2FxIiwicHVzaCIsImdhIiwidHlwZSIsImFzeW5jIiwibG9jYXRpb24iLCJwcm90b2NvbCIsInMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiXSwibWFwcGluZ3MiOiJBQUVBLEdBQXNCLG1CQUFYQSxRQUF3QixDQUNqQyxHQUFJQSxTQUNGQyxLQUFN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LG1CQUVYLFdBQ0UsR0FBSUMsR0FBSzNFLFNBQVMwQyxjQUFjLFNBQVdpQyxHQUFHQyxLQUFPLGtCQUFtQkQsRUFBR0UsT0FBUSxFQUNuRkYsRUFBRzVCLEtBQU8sVUFBWS9DLFNBQVM4RSxTQUFTQyxTQUFXLGNBQWdCLGNBQWdCLDZCQUNuRixJQUFJQyxHQUFJaEYsU0FBU2lGLHFCQUFxQixVQUFVLEVBQUlELEdBQUVFLFdBQVdDLGFBQWFSLEVBQUlLIiwiZmlsZSI6ImpzL3dpZGdldC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgY29uZmlnOiB0cnVlICovXG4vKiBleHBvcnRlZCBjb25maWcgKi9cbmlmICh0eXBlb2YgY29uZmlnID09PSBcInVuZGVmaW5lZFwiKSB7XG4gIHZhciBjb25maWcgPSB7XG4gICAgU0tJTjogXCJza2luL1JWU2tpbi54bWxcIixcbiAgICBTVE9SQUdFX0VOVjogXCJwcm9kXCJcbiAgfTtcblxuICBpZiAodHlwZW9mIGFuZ3VsYXIgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcInJpc2V2aXNpb24uY29tbW9uLmkxOG4uY29uZmlnXCIsIFtdKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19QUkVGSVhcIiwgXCJsb2NhbGVzL3RyYW5zbGF0aW9uX1wiKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19TVUZJWFwiLCBcIi5qc29uXCIpO1xuICB9XG59XG5cbi8qIGdsb2JhbCBnYWRnZXRzLCBjb25maWcgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlbyA9IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvID0gKGZ1bmN0aW9uIChnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfYWRkaXRpb25hbFBhcmFtcztcblxuICB2YXIgX3ByZWZzID0gbnVsbCxcbiAgICBfc3RvcmFnZSA9IG51bGwsXG4gICAgX21lc3NhZ2UgPSBudWxsLFxuICAgIF9mcmFtZUNvbnRyb2xsZXIgPSBudWxsO1xuXG4gIHZhciBfcGxheWJhY2tFcnJvciA9IGZhbHNlLFxuICAgIF9pc1N0b3JhZ2VGaWxlID0gZmFsc2UsXG4gICAgX3ZpZXdlclBhdXNlZCA9IHRydWU7XG5cbiAgdmFyIF9jdXJyZW50RnJhbWUgPSAwO1xuXG4gIHZhciBfc2VwYXJhdG9yID0gXCJcIixcbiAgICBfY3VycmVudEZpbGUgPSBcIlwiO1xuXG4gIHZhciBfcmVmcmVzaER1cmF0aW9uID0gOTAwMDAwLCAgLy8gMTUgbWludXRlc1xuICAgIF9yZWZyZXNoSW50ZXJ2YWxJZCA9IG51bGw7XG5cbiAgdmFyIF9ub0ZpbGVUaW1lciA9IG51bGwsXG4gICAgX25vRmlsZUZsYWcgPSBmYWxzZTtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfY2xlYXJOb0ZpbGVUaW1lcigpIHtcbiAgICBjbGVhclRpbWVvdXQoX25vRmlsZVRpbWVyKTtcbiAgICBfbm9GaWxlVGltZXIgPSBudWxsO1xuICB9XG5cbiAgZnVuY3Rpb24gX2RvbmUoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfZG9uZVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIikpO1xuXG4gIH1cblxuICBmdW5jdGlvbiBfcmVhZHkoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfcmVhZHlcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpLFxuICAgICAgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfcmVmcmVzaEludGVydmFsKGR1cmF0aW9uKSB7XG4gICAgX3JlZnJlc2hJbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gdmlkZW9SZWZyZXNoKCkge1xuICAgICAgLy8gc2V0IG5ldyB2YWx1ZSBvZiBub24gcmlzZS1zdG9yYWdlIHVybCB3aXRoIGEgY2FjaGVidXN0ZXJcbiAgICAgIF9jdXJyZW50RmlsZSA9IF9hZGRpdGlvbmFsUGFyYW1zLnVybCArIF9zZXBhcmF0b3IgKyBcImNiPVwiICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cbiAgICAgIC8vIGluIGNhc2UgcmVmcmVzaGVkIGZpbGUgZml4ZXMgYW4gZXJyb3Igd2l0aCBwcmV2aW91cyBmaWxlLCBlbnN1cmUgZmxhZyBpcyByZW1vdmVkIHNvIHBsYXliYWNrIGlzIGF0dGVtcHRlZCBhZ2FpblxuICAgICAgX3BsYXliYWNrRXJyb3IgPSBmYWxzZTtcblxuICAgIH0sIGR1cmF0aW9uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zdGFydE5vRmlsZVRpbWVyKCkge1xuICAgIF9jbGVhck5vRmlsZVRpbWVyKCk7XG5cbiAgICBfbm9GaWxlVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIG5vdGlmeSBWaWV3ZXIgd2lkZ2V0IGlzIGRvbmVcbiAgICAgIF9kb25lKCk7XG4gICAgfSwgNTAwMCk7XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIG5vU3RvcmFnZUZpbGUoKSB7XG4gICAgX25vRmlsZUZsYWcgPSB0cnVlO1xuICAgIF9jdXJyZW50RmlsZSA9IFwiXCI7XG5cbiAgICBfbWVzc2FnZS5zaG93KFwiVGhlIHNlbGVjdGVkIHZpZGVvIGRvZXMgbm90IGV4aXN0LlwiKTtcblxuICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKF9jdXJyZW50RnJhbWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIGlmIFdpZGdldCBpcyBwbGF5aW5nIHJpZ2h0IG5vdywgcnVuIHRoZSB0aW1lclxuICAgICAgaWYgKCFfdmlld2VyUGF1c2VkKSB7XG4gICAgICAgIF9zdGFydE5vRmlsZVRpbWVyKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBvblN0b3JhZ2VJbml0KHVybCkge1xuICAgIF9jdXJyZW50RmlsZSA9IHVybDtcblxuICAgIF9tZXNzYWdlLmhpZGUoKTtcblxuICAgIGlmICghX3ZpZXdlclBhdXNlZCkge1xuICAgICAgcGxheSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZVJlZnJlc2godXJsKSB7XG4gICAgX2N1cnJlbnRGaWxlID0gdXJsO1xuXG4gICAgLy8gaW4gY2FzZSByZWZyZXNoZWQgZmlsZSBmaXhlcyBhbiBlcnJvciB3aXRoIHByZXZpb3VzIGZpbGUsIGVuc3VyZSBmbGFnIGlzIHJlbW92ZWQgc28gcGxheWJhY2sgaXMgYXR0ZW1wdGVkIGFnYWluXG4gICAgX3BsYXliYWNrRXJyb3IgPSBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICBfdmlld2VyUGF1c2VkID0gdHJ1ZTtcblxuICAgIGlmIChfbm9GaWxlRmxhZykge1xuICAgICAgX2NsZWFyTm9GaWxlVGltZXIoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgIGZyYW1lT2JqLnBhdXNlKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICB2YXIgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuXG4gICAgX3ZpZXdlclBhdXNlZCA9IGZhbHNlO1xuXG4gICAgaWYgKF9ub0ZpbGVGbGFnKSB7XG4gICAgICBfc3RhcnROb0ZpbGVUaW1lcigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghX3BsYXliYWNrRXJyb3IpIHtcbiAgICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgICBmcmFtZU9iai5wbGF5KCk7XG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgIGlmIChfY3VycmVudEZpbGUgJiYgX2N1cnJlbnRGaWxlICE9PSBcIlwiKSB7XG4gICAgICAgICAgLy8gYWRkIGZyYW1lIGFuZCBjcmVhdGUgdGhlIHBsYXllclxuICAgICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKDApO1xuICAgICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoMCwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZSwgY29uZmlnLlNLSU4sIFwicGxheWVyLmh0bWxcIik7XG4gICAgICAgIH1cblxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBUaGlzIGZsYWcgb25seSBnb3Qgc2V0IHVwb24gYSByZWZyZXNoIG9mIGhpZGRlbiBmcmFtZSBhbmQgdGhlcmUgd2FzIGFuIGVycm9yIGluIHNldHVwIG9yIHZpZGVvXG4gICAgICAvLyBTZW5kIFZpZXdlciBcImRvbmVcIlxuICAgICAgX2RvbmUoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFbmRlZCgpIHtcbiAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShfY3VycmVudEZyYW1lLCBmdW5jdGlvbiAoKSB7XG4gICAgICBfZG9uZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyUmVhZHkoKSB7XG4gICAgdmFyIGZyYW1lT2JqO1xuXG4gICAgLy8gbm9uLXN0b3JhZ2UsIGNoZWNrIGlmIHJlZnJlc2ggaW50ZXJ2YWwgZXhpc3RzIHlldCwgc3RhcnQgaXQgaWYgbm90XG4gICAgaWYgKCFfaXNTdG9yYWdlRmlsZSAmJiBfcmVmcmVzaEludGVydmFsSWQgPT09IG51bGwpIHtcbiAgICAgIF9yZWZyZXNoSW50ZXJ2YWwoX3JlZnJlc2hEdXJhdGlvbik7XG4gICAgfVxuXG4gICAgaWYgKCFfdmlld2VyUGF1c2VkKSB7XG4gICAgICBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG4gICAgICBmcmFtZU9iai5wbGF5KCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gc2V0QWRkaXRpb25hbFBhcmFtcyhuYW1lcywgdmFsdWVzKSB7XG4gICAgdmFyIHN0cjtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWVzKSAmJiBuYW1lcy5sZW5ndGggPiAwICYmIG5hbWVzWzBdID09PSBcImFkZGl0aW9uYWxQYXJhbXNcIikge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSAmJiB2YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcyA9IEpTT04ucGFyc2UodmFsdWVzWzBdKTtcbiAgICAgICAgX3ByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKTtcblxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvQ29udGFpbmVyXCIpLnN0eWxlLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIikgKyBcInB4XCI7XG5cbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMud2lkdGggPSBfcHJlZnMuZ2V0SW50KFwicnNXXCIpO1xuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpO1xuXG4gICAgICAgIF9tZXNzYWdlID0gbmV3IFJpc2VWaXNpb24uQ29tbW9uLk1lc3NhZ2UoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKSxcbiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1lc3NhZ2VDb250YWluZXJcIikpO1xuXG4gICAgICAgIC8vIHNob3cgd2FpdCBtZXNzYWdlIHdoaWxlIFN0b3JhZ2UgaW5pdGlhbGl6ZXNcbiAgICAgICAgX21lc3NhZ2Uuc2hvdyhcIlBsZWFzZSB3YWl0IHdoaWxlIHlvdXIgdmlkZW8gaXMgZG93bmxvYWRlZC5cIik7XG5cbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlciA9IG5ldyBSaXNlVmlzaW9uLkNvbW1vbi5WaWRlby5GcmFtZUNvbnRyb2xsZXIoKTtcblxuICAgICAgICBfaXNTdG9yYWdlRmlsZSA9IChPYmplY3Qua2V5cyhfYWRkaXRpb25hbFBhcmFtcy5zdG9yYWdlKS5sZW5ndGggIT09IDApO1xuXG4gICAgICAgIGlmICghX2lzU3RvcmFnZUZpbGUpIHtcbiAgICAgICAgICBzdHIgPSBfYWRkaXRpb25hbFBhcmFtcy51cmwuc3BsaXQoXCI/XCIpO1xuXG4gICAgICAgICAgLy8gc3RvcmUgdGhpcyBmb3IgdGhlIHJlZnJlc2ggdGltZXJcbiAgICAgICAgICBfc2VwYXJhdG9yID0gKHN0ci5sZW5ndGggPT09IDEpID8gXCI/XCIgOiBcIiZcIjtcblxuICAgICAgICAgIF9jdXJyZW50RmlsZSA9IF9hZGRpdGlvbmFsUGFyYW1zLnVybDtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGNyZWF0ZSBhbmQgaW5pdGlhbGl6ZSB0aGUgU3RvcmFnZSBtb2R1bGUgaW5zdGFuY2VcbiAgICAgICAgICBfc3RvcmFnZSA9IG5ldyBSaXNlVmlzaW9uLlZpZGVvLlN0b3JhZ2UoX2FkZGl0aW9uYWxQYXJhbXMpO1xuICAgICAgICAgIF9zdG9yYWdlLmluaXQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIF9yZWFkeSgpO1xuXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyRXJyb3IoZXJyb3IpIHtcbiAgICBjb25zb2xlLmRlYnVnKFwidmlkZW8tZm9sZGVyOjpwbGF5ZXJFcnJvcigpXCIsIGVycm9yKTtcblxuICAgIC8vIGZsYWcgdGhlIHZpZGVvIGhhcyBhbiBlcnJvclxuICAgIF9wbGF5YmFja0Vycm9yID0gdHJ1ZTtcblxuICAgIC8vIGFjdCBhcyB0aG91Z2ggdmlkZW8gaGFzIGVuZGVkXG4gICAgcGxheWVyRW5kZWQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgcGF1c2UoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJub1N0b3JhZ2VGaWxlXCI6IG5vU3RvcmFnZUZpbGUsXG4gICAgXCJvblN0b3JhZ2VJbml0XCI6IG9uU3RvcmFnZUluaXQsXG4gICAgXCJvblN0b3JhZ2VSZWZyZXNoXCI6IG9uU3RvcmFnZVJlZnJlc2gsXG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInNldEFkZGl0aW9uYWxQYXJhbXNcIjogc2V0QWRkaXRpb25hbFBhcmFtcyxcbiAgICBcInBsYXllckVuZGVkXCI6IHBsYXllckVuZGVkLFxuICAgIFwicGxheWVyUmVhZHlcIjogcGxheWVyUmVhZHksXG4gICAgXCJwbGF5ZXJFcnJvclwiOiBwbGF5ZXJFcnJvcixcbiAgICBcInN0b3BcIjogc3RvcFxuICB9O1xuXG59KShnYWRnZXRzKTtcblxuLyogZ2xvYmFsIGNvbmZpZyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvID0gUmlzZVZpc2lvbi5WaWRlbyB8fCB7fTtcblxuUmlzZVZpc2lvbi5WaWRlby5TdG9yYWdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9pbml0aWFsTG9hZCA9IHRydWU7XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIHZhciBzdG9yYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb1N0b3JhZ2VcIik7XG5cbiAgICBpZiAoIXN0b3JhZ2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLnVybCkge1xuXG4gICAgICAgIGlmIChfaW5pdGlhbExvYWQpIHtcbiAgICAgICAgICBfaW5pdGlhbExvYWQgPSBmYWxzZTtcblxuICAgICAgICAgIFJpc2VWaXNpb24uVmlkZW8ub25TdG9yYWdlSW5pdChlLmRldGFpbC51cmwpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIC8vIGNoZWNrIGZvciBcImNoYW5nZWRcIiBwcm9wZXJ0eSBhbmQgZW5zdXJlIGl0IGlzIHRydWVcbiAgICAgICAgICBpZiAoZS5kZXRhaWwuaGFzT3duUHJvcGVydHkoXCJjaGFuZ2VkXCIpICYmIGUuZGV0YWlsLmNoYW5nZWQpIHtcbiAgICAgICAgICAgIFJpc2VWaXNpb24uVmlkZW8ub25TdG9yYWdlUmVmcmVzaChlLmRldGFpbC51cmwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLW5vLWZpbGVcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBSaXNlVmlzaW9uLlZpZGVvLm5vU3RvcmFnZUZpbGUoKTtcbiAgICB9KTtcblxuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZm9sZGVyXCIsIGRhdGEuc3RvcmFnZS5mb2xkZXIpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZmlsZU5hbWVcIiwgZGF0YS5zdG9yYWdlLmZpbGVOYW1lKTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImNvbXBhbnlJZFwiLCBkYXRhLnN0b3JhZ2UuY29tcGFueUlkKTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImVudlwiLCBjb25maWcuU1RPUkFHRV9FTlYpO1xuICAgIHN0b3JhZ2UuZ28oKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJpbml0XCI6IGluaXRcbiAgfTtcbn07XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uQ29tbW9uID0gUmlzZVZpc2lvbi5Db21tb24gfHwge307XG5cblJpc2VWaXNpb24uQ29tbW9uLlZpZGVvID0gUmlzZVZpc2lvbi5Db21tb24uVmlkZW8gfHwge307XG5cblJpc2VWaXNpb24uQ29tbW9uLlZpZGVvLkZyYW1lQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIFBSRUZJWCA9IFwiaWZfXCI7XG5cbiAgZnVuY3Rpb24gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0RnJhbWVPYmplY3QoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXG4gICAgICBpZnJhbWU7XG5cbiAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xuXG4gICAgaWYgKGlmcmFtZSkge1xuICAgICAgcmV0dXJuIChpZnJhbWUuY29udGVudFdpbmRvdykgPyBpZnJhbWUuY29udGVudFdpbmRvdyA6XG4gICAgICAgIChpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50KSA/IGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQgOiBpZnJhbWUuY29udGVudERvY3VtZW50O1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgZnVuY3Rpb24gX2NsZWFyKGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxuICAgICAgZnJhbWVPYmogPSBnZXRGcmFtZU9iamVjdChpbmRleCksXG4gICAgICBpZnJhbWU7XG5cbiAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XG4gICAgICBmcmFtZU9iai5yZW1vdmUoKTtcbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgXCJhYm91dDpibGFua1wiKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBhZGQoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXG4gICAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpO1xuXG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcImFsbG93VHJhbnNwYXJlbmN5XCIsIHRydWUpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJmcmFtZWJvcmRlclwiLCBcIjBcIik7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNjcm9sbGluZ1wiLCBcIm5vXCIpO1xuXG4gICAgZnJhbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNyZWF0ZUZyYW1lUGxheWVyKGluZGV4LCBwYXJhbXMsIGZpbGVzLCBza2luLCBzcmMpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXG4gICAgICBmcmFtZU9iaiA9IGdldEZyYW1lT2JqZWN0KGluZGV4KSxcbiAgICAgIGlmcmFtZTtcblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcblxuICAgICAgaWZyYW1lLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWZyYW1lLm9ubG9hZCA9IG51bGw7XG5cbiAgICAgICAgLy8gaW5pdGlhbGl6ZSBhbmQgbG9hZCB0aGUgcGxheWVyIGluc2lkZSB0aGUgaWZyYW1lXG4gICAgICAgIGZyYW1lT2JqLmluaXQocGFyYW1zLCBmaWxlcywgc2tpbik7XG4gICAgICAgIGZyYW1lT2JqLmxvYWQoKTtcbiAgICAgIH07XG5cbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgc3JjKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIGhpZGUoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCk7XG5cbiAgICBmcmFtZUNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZShpbmRleCwgY2FsbGJhY2spIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCk7XG5cbiAgICBfY2xlYXIoaW5kZXgpO1xuXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAvLyByZW1vdmUgdGhlIGlmcmFtZSBieSBjbGVhcmluZyBhbGwgZWxlbWVudHMgaW5zaWRlIGRpdiBjb250YWluZXJcbiAgICAgIHdoaWxlIChmcmFtZUNvbnRhaW5lci5maXJzdENoaWxkKSB7XG4gICAgICAgIGZyYW1lQ29udGFpbmVyLnJlbW92ZUNoaWxkKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICB9LCAyMDApO1xuICB9XG5cbiAgZnVuY3Rpb24gc2hvdyhpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KTtcblxuICAgIGZyYW1lQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgYWRkOiBhZGQsXG4gICAgY3JlYXRlRnJhbWVQbGF5ZXI6IGNyZWF0ZUZyYW1lUGxheWVyLFxuICAgIGdldEZyYW1lQ29udGFpbmVyOiBnZXRGcmFtZUNvbnRhaW5lcixcbiAgICBnZXRGcmFtZU9iamVjdDogZ2V0RnJhbWVPYmplY3QsXG4gICAgaGlkZTogaGlkZSxcbiAgICByZW1vdmU6IHJlbW92ZSxcbiAgICBzaG93OiBzaG93XG4gIH07XG59O1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLkNvbW1vbiA9IFJpc2VWaXNpb24uQ29tbW9uIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5NZXNzYWdlID0gZnVuY3Rpb24gKG1haW5Db250YWluZXIsIG1lc3NhZ2VDb250YWluZXIpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9hY3RpdmUgPSBmYWxzZTtcblxuICBmdW5jdGlvbiBfaW5pdCgpIHtcbiAgICB0cnkge1xuICAgICAgbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBtYWluQ29udGFpbmVyLnN0eWxlLmhlaWdodDtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJDYW4ndCBpbml0aWFsaXplIE1lc3NhZ2UgLSBcIiwgZS5tZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgaWYgKF9hY3RpdmUpIHtcbiAgICAgIC8vIGNsZWFyIGNvbnRlbnQgb2YgbWVzc2FnZSBjb250YWluZXJcbiAgICAgIHdoaWxlIChtZXNzYWdlQ29udGFpbmVyLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgbWVzc2FnZUNvbnRhaW5lci5yZW1vdmVDaGlsZChtZXNzYWdlQ29udGFpbmVyLmZpcnN0Q2hpbGQpO1xuICAgICAgfVxuXG4gICAgICAvLyBoaWRlIG1lc3NhZ2UgY29udGFpbmVyXG4gICAgICBtZXNzYWdlQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuICAgICAgLy8gc2hvdyBtYWluIGNvbnRhaW5lclxuICAgICAgbWFpbkNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG5cbiAgICAgIF9hY3RpdmUgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzaG93KG1lc3NhZ2UpIHtcbiAgICB2YXIgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksXG4gICAgICBwO1xuXG4gICAgaWYgKCFfYWN0aXZlKSB7XG4gICAgICAvLyBoaWRlIG1haW4gY29udGFpbmVyXG4gICAgICBtYWluQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuXG4gICAgICBtZXNzYWdlQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG5cbiAgICAgIC8vIGNyZWF0ZSBtZXNzYWdlIGVsZW1lbnRcbiAgICAgIHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgICAgIHAuaW5uZXJIVE1MID0gbWVzc2FnZTtcbiAgICAgIHAuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJtZXNzYWdlXCIpO1xuICAgICAgcC5zdHlsZS5saW5lSGVpZ2h0ID0gbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7XG5cbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHApO1xuICAgICAgbWVzc2FnZUNvbnRhaW5lci5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG5cbiAgICAgIF9hY3RpdmUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBtZXNzYWdlIGFscmVhZHkgYmVpbmcgc2hvd24sIHVwZGF0ZSBtZXNzYWdlIHRleHRcbiAgICAgIHAgPSBtZXNzYWdlQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIubWVzc2FnZVwiKTtcbiAgICAgIHAuaW5uZXJIVE1MID0gbWVzc2FnZTtcbiAgICB9XG4gIH1cblxuICBfaW5pdCgpO1xuXG4gIHJldHVybiB7XG4gICAgXCJoaWRlXCI6IGhpZGUsXG4gICAgXCJzaG93XCI6IHNob3dcbiAgfTtcbn07XG5cbi8qIGdsb2JhbCBnYWRnZXRzLCBSaXNlVmlzaW9uICovXG5cbihmdW5jdGlvbiAod2luZG93LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBwcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCksXG4gICAgaWQgPSBwcmVmcy5nZXRTdHJpbmcoXCJpZFwiKTtcblxuICAvLyBEaXNhYmxlIGNvbnRleHQgbWVudSAocmlnaHQgY2xpY2sgbWVudSlcbiAgd2luZG93Lm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5wbGF5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8uc3RvcCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9seW1lclJlYWR5KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbiAgICBpZiAoaWQgJiYgaWQgIT09IFwiXCIpIHtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGxheV9cIiArIGlkLCBwbGF5KTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGF1c2VfXCIgKyBpZCwgcGF1c2UpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9zdG9wX1wiICsgaWQsIHN0b3ApO1xuXG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzcGFyYW1fc2V0X1wiICsgaWQsIFJpc2VWaXNpb24uVmlkZW8uc2V0QWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNwYXJhbV9nZXRcIiwgbnVsbCwgaWQsIFtcImFkZGl0aW9uYWxQYXJhbXNcIl0pO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXG4vKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5cbl9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTU3MDkyMTU5LTInXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgZ2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyBnYS5hc3luYyA9IHRydWU7XG4gIGdhLnNyYyA9ICgnaHR0cHM6JyA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICdodHRwczovL3NzbCcgOiAnaHR0cDovL3d3dycpICsgJy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gIHZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTtcbn0pKCk7XG4vKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
