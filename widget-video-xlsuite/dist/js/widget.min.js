function loadVideoLinkFromXLSuite(e,t,n){var i="2ae45fc2-72b9-45ce-9771-caf0fabf9c97";console.log("displayKey param",e),$.ajax({url:"https://rn.xlsuite.com/admin/api/liquids/call?api_key="+i+"&tag=load_screen&display_key="+e}).then(function(e){if(!e||!e.screen)return console.log("Error - Returned data is empty",e),n&&n(),void 0;var i=e.screen.channel_url,o=i.substring(i.indexOf("?list=")+6);console.log("Loaded channel URL, channel ID",i,o),t(o)})}if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml",STORAGE_ENV:"prod"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e){"use strict";function t(){e.rpc.call("","rsevent_ready",null,R.getString("id"),!0,!0,!0,!0,!0)}function n(){}function i(){}function o(){}function r(){}function s(){}function a(){}function l(){}function c(){clearTimeout(_),_=setInterval(function(){console.log("Interval check"),loadVideoLinkFromXLSuite(V,function(e){e!=S&&(S=e,m(S,v.width,v.height))})},C)}function d(t,n){console.log("additional params values",n),Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(n)&&n.length>0&&(v=JSON.parse(n[0]),R=new e.Prefs,v||(v={},console.log("additional params recreated")),document.getElementById("videoContainer").style.height=R.getInt("rsH")+"px",v.width=R.getInt("rsW"),v.height=R.getInt("rsH"),R.getString("displayId")?(V=R.getString("displayId"),console.log("displayId set from gadget param",V)):(V=v.displayId,console.log("displayId set from default settings",V)),loadVideoLinkFromXLSuite(V,u,function(){V!=R.getString("displayId")&&(V=v.displayId,console.log("Trying to use default displayId",V),loadVideoLinkFromXLSuite(V,u))}))}function u(e){S=e,m(S,v.width,v.height),c(),t()}function m(e,t,n){console.log("Video url, w, h",e,t,n),w=new YT.Player("mainIframe",{width:t,height:n,playerVars:{listType:"playlist",list:e,autoplay:1,controls:0,loop:1,showinfo:0},events:{onError:g,onReady:p,onStateChange:f}})}function g(e){console.log("Player error code",e),w&&null!=w&&e&&e.data>=100&&(w.nextVideo(),console.log("Error, playing next video",e))}function f(){}function p(){}function y(e){console.debug("video-folder::playerError()",e),a()}function h(){r()}var v,V,R=null,S="",C=5e3,_=null,w=null;return{noStorageFile:n,onStorageInit:i,onStorageRefresh:o,pause:r,play:s,setAdditionalParams:d,playerEnded:a,playerReady:l,playerError:y,stop:h}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function e(e){return document.getElementById(l+e)}function t(t){var n,i=e(t);return n=i.querySelector("iframe"),n?n.contentWindow?n.contentWindow:n.contentDocument.document?n.contentDocument.document:n.contentDocument:null}function n(n){var i,o=e(n),r=t(n);r&&(i=o.querySelector("iframe"),r.remove(),i.setAttribute("src","about:blank"))}function i(t){var n=e(t),i=document.createElement("iframe");i.setAttribute("allowTransparency",!0),i.setAttribute("frameborder","0"),i.setAttribute("scrolling","no"),n.appendChild(i)}function o(n,i,o,r,s){var a,l=e(n),c=t(n);c&&(a=l.querySelector("iframe"),a.onload=function(){a.onload=null,c.init(i,o,r),c.load()},a.setAttribute("src",s))}function r(t){var n=e(t);n.style.visibility="hidden"}function s(e,t){var i=document.getElementById(l+e);n(e),setTimeout(function(){for(;i.firstChild;)i.removeChild(i.firstChild);t&&"function"==typeof t&&t()},200)}function a(t){var n=e(t);n.style.visibility="visible"}var l="if_";return{add:i,createFramePlayer:o,getFrameContainer:e,getFrameObject:t,hide:r,remove:s,show:a}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Message=function(e,t){"use strict";function n(){try{t.style.height=e.style.height}catch(n){console.warn("Can't initialize Message - ",n.message)}}function i(){if(r){for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none",e.style.visibility="visible",r=!1}}function o(n){var i,o=document.createDocumentFragment();r?(i=t.querySelector(".message"),i.innerHTML=n):(e.style.visibility="hidden",t.style.display="block",i=document.createElement("p"),i.innerHTML=n,i.setAttribute("class","message"),i.style.lineHeight=t.style.height,o.appendChild(i),t.appendChild(o),r=!0)}var r=!1;return n(),{hide:i,show:o}},function(e,t){"use strict";function n(){RiseVision.Video.play()}function i(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function r(){e.removeEventListener("WebComponentsReady",r),console.log("Registering gadget with id",a),a&&""!==a&&(t.rpc.register("rscmd_play_"+a,n),t.rpc.register("rscmd_pause_"+a,i),t.rpc.register("rscmd_stop_"+a,o),t.rpc.register("rsparam_set_"+a,RiseVision.Video.setAdditionalParams),t.rpc.call("","rsparam_get",null,a,["additionalParams"]))}var s=new t.Prefs,a=s.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("WebComponentsReady",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsibG9hZFZpZGVvTGlua0Zyb21YTFN1aXRlIiwiZGlzcGxheUtleSIsInN1Y2Nlc3NDYWxsYmFjayIsImVycm9yQ2FsbGJhY2siLCJhcGlLZXkiLCJjb25zb2xlIiwibG9nIiwiJCIsImFqYXgiLCJ1cmwiLCJ0aGVuIiwiZGF0YSIsInNjcmVlbiIsImNoYW5lbFVybCIsImNoYW5uZWxfdXJsIiwiY2hhbm5lbElkIiwic3Vic3RyaW5nIiwiaW5kZXhPZiIsImNvbmZpZyIsIlNLSU4iLCJTVE9SQUdFX0VOViIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsInRhZyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNyYyIsImZpcnN0U2NyaXB0VGFnIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIiwiUmlzZVZpc2lvbiIsIlZpZGVvIiwiZ2FkZ2V0cyIsIl9yZWFkeSIsInJwYyIsImNhbGwiLCJfcHJlZnMiLCJnZXRTdHJpbmciLCJub1N0b3JhZ2VGaWxlIiwib25TdG9yYWdlSW5pdCIsIm9uU3RvcmFnZVJlZnJlc2giLCJwYXVzZSIsInBsYXkiLCJwbGF5ZXJFbmRlZCIsInBsYXllclJlYWR5Iiwic3RhcnRQbGF5bGlzdENoYW5nZVRpbWVyIiwiY2xlYXJUaW1lb3V0IiwiX3BsYXlsaXN0Q2hhbmdlVGltZXIiLCJzZXRJbnRlcnZhbCIsImRpc3BsYXlJZCIsInZpZGVvVXJsIiwiX2N1cnJlbnRGaWxlIiwiaW5pdFlUUGxheWVyIiwiX2FkZGl0aW9uYWxQYXJhbXMiLCJ3aWR0aCIsImhlaWdodCIsInhsU3VpdGVQbGF5bGlzdFJlZnJlc2hEdXJhdGlvbiIsInNldEFkZGl0aW9uYWxQYXJhbXMiLCJuYW1lcyIsInZhbHVlcyIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsIkpTT04iLCJwYXJzZSIsIlByZWZzIiwiZ2V0RWxlbWVudEJ5SWQiLCJzdHlsZSIsImdldEludCIsInN0YXJ0WExTdWl0ZVBsYXllciIsInBsYXlsaXN0SWQiLCJ5b3V0dWJlUGxheWVySlMiLCJZVCIsIlBsYXllciIsInBsYXllclZhcnMiLCJsaXN0VHlwZSIsImxpc3QiLCJhdXRvcGxheSIsImNvbnRyb2xzIiwibG9vcCIsInNob3dpbmZvIiwiZXZlbnRzIiwib25FcnJvciIsIm9uUGxheWVyRXJyb3IiLCJvblJlYWR5Iiwib25QbGF5ZXJSZWFkeSIsIm9uU3RhdGVDaGFuZ2UiLCJvblBsYXllclN0YXRlQ2hhbmdlIiwiZXZlbnQiLCJuZXh0VmlkZW8iLCJwbGF5ZXJFcnJvciIsImVycm9yIiwiZGVidWciLCJzdG9wIiwiQ29tbW9uIiwiRnJhbWVDb250cm9sbGVyIiwiZ2V0RnJhbWVDb250YWluZXIiLCJpbmRleCIsIlBSRUZJWCIsImdldEZyYW1lT2JqZWN0IiwiaWZyYW1lIiwiZnJhbWVDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudFdpbmRvdyIsImNvbnRlbnREb2N1bWVudCIsIl9jbGVhciIsImZyYW1lT2JqIiwicmVtb3ZlIiwic2V0QXR0cmlidXRlIiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJjcmVhdGVGcmFtZVBsYXllciIsInBhcmFtcyIsImZpbGVzIiwic2tpbiIsIm9ubG9hZCIsImluaXQiLCJsb2FkIiwiaGlkZSIsInZpc2liaWxpdHkiLCJjYWxsYmFjayIsInNldFRpbWVvdXQiLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJzaG93IiwiTWVzc2FnZSIsIm1haW5Db250YWluZXIiLCJtZXNzYWdlQ29udGFpbmVyIiwiX2luaXQiLCJlIiwid2FybiIsIm1lc3NhZ2UiLCJfYWN0aXZlIiwiZGlzcGxheSIsInAiLCJmcmFnbWVudCIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJpbm5lckhUTUwiLCJsaW5lSGVpZ2h0Iiwid2luZG93IiwicG9seW1lclJlYWR5IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImlkIiwicmVnaXN0ZXIiLCJwcmVmcyIsIm9uY29udGV4dG1lbnUiLCJhZGRFdmVudExpc3RlbmVyIiwiX2dhcSIsInB1c2giLCJnYSIsInR5cGUiLCJhc3luYyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJzIl0sIm1hcHBpbmdzIjoiQUFpQkEsUUFBU0EsMEJBQXlCQyxFQUFZQyxFQUFpQkMsR0FDN0QsR0FBSUMsR0FBUyxzQ0FDYkMsU0FBUUMsSUFBSSxtQkFBb0JMLEdBRWhDTSxFQUFFQyxNQUNBQyxJQUFLLHlEQUEyREwsRUFBUyxnQ0FBa0NILElBQzFHUyxLQUFLLFNBQVVDLEdBQ2hCLElBQUtBLElBQVNBLEVBQUtDLE9BS2pCLE1BSkFQLFNBQVFDLElBQUksaUNBQWtDSyxHQUMxQ1IsR0FDRkEsSUFFRixNQUlGLElBQUlVLEdBQVlGLEVBQUtDLE9BQU9FLFlBQ3hCQyxFQUFZRixFQUFVRyxVQUFVSCxFQUFVSSxRQUFRLFVBQVksRUFFbEVaLFNBQVFDLElBQUksaUNBQWtDTyxFQUFXRSxHQUN6RGIsRUFBZ0JhLEtBbkNwQixHQUFzQixtQkFBWEcsUUFBd0IsQ0FDakMsR0FBSUEsU0FDRkMsS0FBTSxrQkFDTkMsWUFBYSxPQUdRLG9CQUFaQyxVQUNUQSxRQUFRQyxPQUFPLG9DQUNaQyxTQUFTLGlCQUFrQix3QkFDM0JBLFNBQVMsZ0JBQWlCLFNBMENqQyxHQUFJQyxLQUFNQyxTQUFTQyxjQUFjLFNBQ2pDRixLQUFJRyxJQUFNLG9DQUVWLElBQUlDLGdCQUFpQkgsU0FBU0kscUJBQXFCLFVBQVUsRUFDN0RELGdCQUFlRSxXQUFXQyxhQUFhUCxJQUFLSSxlQUU1QyxJQUFJSSxZQUFhQSxjQUNqQkEsWUFBV0MsU0FFWEQsV0FBV0MsTUFBUSxTQUFXQyxHQUM1QixZQWtCQSxTQUFTQyxLQUNQRCxFQUFRRSxJQUFJQyxLQUFLLEdBQUksZ0JBQWlCLEtBQU1DLEVBQU9DLFVBQVUsT0FBTyxHQUFNLEdBQU0sR0FBTSxHQUFNLEdBTTlGLFFBQVNDLE1BR1QsUUFBU0MsTUFHVCxRQUFTQyxNQUdULFFBQVNDLE1BR1QsUUFBU0MsTUFHVCxRQUFTQyxN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UFosV0FBV0MsTUFBTVcsT0FHbkIsUUFBU0QsS0FDUFgsV0FBV0MsTUFBTVUsUUFHbkIsUUFBU29ELEtBQ1AvRCxXQUFXQyxNQUFNOEQsT0FHbkIsUUFBUytDLEtBQ1BELEVBQU9FLG9CQUFvQixxQkFBc0JELEdBQ2pEekksUUFBUUMsSUFBSSw2QkFBOEIwSSxHQUV0Q0EsR0FBYSxLQUFQQSxJQUNSOUcsRUFBUUUsSUFBSTZHLFNBQVMsY0FBZ0JELEVBQUlwRyxHQUN6Q1YsRUFBUUUsSUFBSTZHLFNBQVMsZUFBaUJELEVBQUlyRyxHQUMxQ1QsRUFBUUUsSUFBSTZHLFNBQVMsY0FBZ0JELEVBQUlqRCxHQUV6QzdELEVBQVFFLElBQUk2RyxTQUFTLGVBQWlCRCxFQUFJaEgsV0FBV0MsTUFBTTBCLHFCQUMzRHpCLEVBQVFFLElBQUlDLEtBQUssR0FBSSxjQUFlLEtBQU0yRyxHQUFLLHNCQTlCbkQsR0FBSUUsR0FBUSxHQUFJaEgsR0FBUWlDLE1BQ3RCNkUsRUFBS0UsRUFBTTNHLFVBQVUsS0FHdkJzRyxHQUFPTSxjQUFnQixXQUNyQixPQUFPLEdBNkJUTixFQUFPTyxpQkFBaUIscUJBQXNCTixJQUU3Q0QsT0FBUTNHLFFBS1gsSUFBSW1ILE1BQU9BLFFBRVhBLE1BQUtDLE1BQU0sY0FBZSxrQkFDMUJELEtBQUtDLE1BQU0sbUJBRVgsV0FDRSxHQUFJQyxHQUFLOUgsU0FBU0MsY0FBYyxTQUFXNkgsR0FBR0MsS0FBTyxrQkFBbUJELEVBQUdFLE9BQVEsRUFDbkZGLEVBQUc1SCxLQUFPLFVBQVlGLFNBQVNpSSxTQUFTQyxTQUFXLGNBQWdCLGNBQWdCLDZCQUNuRixJQUFJQyxHQUFJbkksU0FBU0kscUJBQXFCLFVBQVUsRUFBSStILEdBQUU5SCxXQUFXQyxhQUFhd0gsRUFBSUsiLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICBTS0lOOiBcInNraW4vUlZTa2luLnhtbFwiLFxuICAgIFNUT1JBR0VfRU5WOiBcInByb2RcIlxuICB9O1xuXG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1BSRUZJWFwiLCBcImxvY2FsZXMvdHJhbnNsYXRpb25fXCIpXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1NVRklYXCIsIFwiLmpzb25cIik7XG4gIH1cbn1cblxyXG4ndXNlIHN0cmljdCc7XHJcblxyXG5mdW5jdGlvbiBsb2FkVmlkZW9MaW5rRnJvbVhMU3VpdGUoZGlzcGxheUtleSwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7XHJcbiAgdmFyIGFwaUtleSA9IFwiMmFlNDVmYzItNzJiOS00NWNlLTk3NzEtY2FmMGZhYmY5Yzk3XCI7XHJcbiAgY29uc29sZS5sb2coXCJkaXNwbGF5S2V5IHBhcmFtXCIsIGRpc3BsYXlLZXkpO1xyXG5cclxuICAkLmFqYXgoe1xyXG4gICAgdXJsOiBcImh0dHBzOi8vcm4ueGxzdWl0ZS5jb20vYWRtaW4vYXBpL2xpcXVpZHMvY2FsbD9hcGlfa2V5PVwiICsgYXBpS2V5ICsgXCImdGFnPWxvYWRfc2NyZWVuJmRpc3BsYXlfa2V5PVwiICsgZGlzcGxheUtleVxyXG4gIH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgIGlmICghZGF0YSB8fCAhZGF0YS5zY3JlZW4pIHtcclxuICAgICAgY29uc29sZS5sb2coXCJFcnJvciAtIFJldHVybmVkIGRhdGEgaXMgZW1wdHlcIiwgZGF0YSk7XHJcbiAgICAgIGlmIChlcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgZXJyb3JDYWxsYmFjaygpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvL3RvZG86IHNhdmUgY2hhbm5lbCBVUkwgdG8gc29tZSAgc2V0dGluZ3MgLyB2YXJpYWJsZVxyXG4gICAgdmFyIGNoYW5lbFVybCA9IGRhdGEuc2NyZWVuLmNoYW5uZWxfdXJsO1xyXG4gICAgdmFyIGNoYW5uZWxJZCA9IGNoYW5lbFVybC5zdWJzdHJpbmcoY2hhbmVsVXJsLmluZGV4T2YoXCI/bGlzdD1cIikgKyA2KTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhcIkxvYWRlZCBjaGFubmVsIFVSTCwgY2hhbm5lbCBJRFwiLCBjaGFuZWxVcmwsIGNoYW5uZWxJZCk7XHJcbiAgICBzdWNjZXNzQ2FsbGJhY2soY2hhbm5lbElkKTtcclxuXHJcbiAgICAvL1JOIC0gaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvdmlkZW9zZXJpZXM/bGlzdD1QTG41NlZieE9TNzdmZC1xYlp3MG12blMyUG1fX3R2U0haXHJcbiAgICAvL215IC0gaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvdmlkZW9zZXJpZXM/bGlzdD1QTDQ4Wkd3Q3B3UHlGVmlFTGdzbnZVa25Sekp5bzJnT2hBXHJcblxyXG4gICAgLy90b2RvOiBmaXggZW1iZWRkZWQgZXJyb3JzXHJcbiAgICAvL2h0dHBzOi8vd3d3LmRydXBhbC5vcmcvbm9kZS8xODg3ODE4XHJcbiAgICAvL2h0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTI1MjIyOTEvcGF1c2luZy15b3V0dWJlLWlmcmFtZS1hcGktaW4tamF2YXNjcmlwdFxyXG4gICAgLy9odHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzgyMDUxNzkveW91dHViZS1hcGktaGFuZGxpbmctdmlkZW9zLXRoYXQtaGF2ZS1iZWVuLXJlbW92ZWQtYnkteW91dHViZVxyXG5cclxuICB9KTtcclxuXHJcbn1cclxuXHJcbi8qIGdsb2JhbCBnYWRnZXRzLCBjb25maWcgKi9cblxudmFyIHRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xudGFnLnNyYyA9IFwiaHR0cHM6Ly93d3cueW91dHViZS5jb20vaWZyYW1lX2FwaVwiO1xuXG52YXIgZmlyc3RTY3JpcHRUYWcgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07XG5maXJzdFNjcmlwdFRhZy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0YWcsIGZpcnN0U2NyaXB0VGFnKTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlbyA9IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvID0gKGZ1bmN0aW9uIChnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfYWRkaXRpb25hbFBhcmFtcztcbiAgdmFyIF9wcmVmcyA9IG51bGw7XG5cbiAgdmFyIF9jdXJyZW50RmlsZSA9IFwiXCI7XG4gIHZhciBkaXNwbGF5SWQ7XG5cbiAgdmFyIHhsU3VpdGVQbGF5bGlzdFJlZnJlc2hEdXJhdGlvbiA9IDUwMDA7IC8vNSBzZWNcblxuICB2YXIgX3BsYXlsaXN0Q2hhbmdlVGltZXIgPSBudWxsO1xuXG4gIHZhciB5b3V0dWJlUGxheWVySlMgPSBudWxsO1xuXG4gIGZ1bmN0aW9uIF9kb25lKCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X2RvbmVcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWFkeSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9yZWFkeVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIiksIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUpO1xuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBub1N0b3JhZ2VGaWxlKCkge1xuICB9XG5cbiAgZnVuY3Rpb24gb25TdG9yYWdlSW5pdCh1cmwpIHtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZVJlZnJlc2godXJsKSB7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFbmRlZCgpIHtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllclJlYWR5KCkge1xuICB9XG5cbiAgZnVuY3Rpb24gc3RhcnRQbGF5bGlzdENoYW5nZVRpbWVyKCkge1xuICAgIGNsZWFyVGltZW91dChfcGxheWxpc3RDaGFuZ2VUaW1lcik7XG5cbiAgICBfcGxheWxpc3RDaGFuZ2VUaW1lciA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiSW50ZXJ2YWwgY2hlY2tcIik7XG5cbiAgICAgIGxvYWRWaWRlb0xpbmtGcm9tWExTdWl0ZShkaXNwbGF5SWQsIGZ1bmN0aW9uICh2aWRlb1VybCkge1xuICAgICAgICBpZiAodmlkZW9VcmwgIT0gX2N1cnJlbnRGaWxlKSB7XG4gICAgICAgICAgX2N1cnJlbnRGaWxlID0gdmlkZW9Vcmw7XG4gICAgICAgICAgaW5pdFlUUGxheWVyKF9jdXJyZW50RmlsZSwgX2FkZGl0aW9uYWxQYXJhbXMud2lkdGgsIF9hZGRpdGlvbmFsUGFyYW1zLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgfSwgeGxTdWl0ZVBsYXlsaXN0UmVmcmVzaER1cmF0aW9uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldEFkZGl0aW9uYWxQYXJhbXMobmFtZXMsIHZhbHVlcykge1xuICAgIGNvbnNvbGUubG9nKFwiYWRkaXRpb25hbCBwYXJhbXMgdmFsdWVzXCIsIHZhbHVlcyk7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZXMpICYmIG5hbWVzLmxlbmd0aCA+IDAgJiYgbmFtZXNbMF0gPT09IFwiYWRkaXRpb25hbFBhcmFtc1wiKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpICYmIHZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gSlNPTi5wYXJzZSh2YWx1ZXNbMF0pO1xuICAgICAgICBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpO1xuXG4gICAgICAgIGlmICghX2FkZGl0aW9uYWxQYXJhbXMpIHtcbiAgICAgICAgICBfYWRkaXRpb25hbFBhcmFtcyA9IHt9O1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiYWRkaXRpb25hbCBwYXJhbXMgcmVjcmVhdGVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKS5zdHlsZS5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpICsgXCJweFwiO1xuXG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLndpZHRoID0gX3ByZWZzLmdldEludChcInJzV1wiKTtcbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKTtcblxuICAgICAgICBpZiAoX3ByZWZzLmdldFN0cmluZyhcImRpc3BsYXlJZFwiKSkge1xuICAgICAgICAgIGRpc3BsYXlJZCA9IF9wcmVmcy5nZXRTdHJpbmcoXCJkaXNwbGF5SWRcIik7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJkaXNwbGF5SWQgc2V0IGZyb20gZ2FkZ2V0IHBhcmFtXCIsIGRpc3BsYXlJZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGlzcGxheUlkID0gX2FkZGl0aW9uYWxQYXJhbXMuZGlzcGxheUlkO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiZGlzcGxheUlkIHNldCBmcm9tIGRlZmF1bHQgc2V0dGluZ3NcIiwgZGlzcGxheUlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvYWRWaWRlb0xpbmtGcm9tWExTdWl0ZShkaXNwbGF5SWQsIHN0YXJ0WExTdWl0ZVBsYXllciwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKGRpc3BsYXlJZCAhPSBfcHJlZnMuZ2V0U3RyaW5nKFwiZGlzcGxheUlkXCIpKSB7XG4gICAgICAgICAgICBkaXNwbGF5SWQgPSBfYWRkaXRpb25hbFBhcmFtcy5kaXNwbGF5SWQ7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRyeWluZyB0byB1c2UgZGVmYXVsdCBkaXNwbGF5SWRcIiwgZGlzcGxheUlkKTtcbiAgICAgICAgICAgIGxvYWRWaWRlb0xpbmtGcm9tWExTdWl0ZShkaXNwbGF5SWQsIHN0YXJ0WExTdWl0ZVBsYXllcik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzdGFydFhMU3VpdGVQbGF5ZXIodmlkZW9VcmwpIHtcbiAgICBfY3VycmVudEZpbGUgPSB2aWRlb1VybDtcbiAgICBpbml0WVRQbGF5ZXIoX2N1cnJlbnRGaWxlLCBfYWRkaXRpb25hbFBhcmFtcy53aWR0aCwgX2FkZGl0aW9uYWxQYXJhbXMuaGVpZ2h0KTtcbiAgICBzdGFydFBsYXlsaXN0Q2hhbmdlVGltZXIoKTtcblxuICAgIF9yZWFkeSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5pdFlUUGxheWVyKHBsYXlsaXN0SWQsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICBjb25zb2xlLmxvZyhcIlZpZGVvIHVybCwgdywgaFwiLCBwbGF5bGlzdElkLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgIHlvdXR1YmVQbGF5ZXJKUyA9IG5ldyBZVC5QbGF5ZXIoJ21haW5JZnJhbWUnLCB7XG4gICAgICB3aWR0aDogd2lkdGgsXG4gICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgIHBsYXllclZhcnM6IHtcbiAgICAgICAgbGlzdFR5cGU6J3BsYXlsaXN0JyxcbiAgICAgICAgbGlzdDogcGxheWxpc3RJZCxcbiAgICAgICAgJ2F1dG9wbGF5JzogMSxcbiAgICAgICAgJ2NvbnRyb2xzJzogMCxcbiAgICAgICAgJ2xvb3AnOiAxLFxuICAgICAgICAnc2hvd2luZm8nOiAwXG4gICAgICB9LFxuICAgICAgZXZlbnRzOiB7XG4gICAgICAgICdvbkVycm9yJzogb25QbGF5ZXJFcnJvcixcbiAgICAgICAgJ29uUmVhZHknOiBvblBsYXllclJlYWR5LFxuICAgICAgICAnb25TdGF0ZUNoYW5nZSc6IG9uUGxheWVyU3RhdGVDaGFuZ2VcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uUGxheWVyRXJyb3IoZXZlbnQpIHtcbiAgICBjb25zb2xlLmxvZyhcIlBsYXllciBlcnJvciBjb2RlXCIsIGV2ZW50KTtcbiAgICBpZiAoeW91dHViZVBsYXllckpTICYmIHlvdXR1YmVQbGF5ZXJKUyAhPSBudWxsICYmIGV2ZW50ICYmIGV2ZW50LmRhdGEgPj0gMTAwKSB7XG4gICAgICB5b3V0dWJlUGxheWVySlMubmV4dFZpZGVvKCk7XG4gICAgICBjb25zb2xlLmxvZyhcIkVycm9yLCBwbGF5aW5nIG5leHQgdmlkZW9cIiwgZXZlbnQpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG9uUGxheWVyU3RhdGVDaGFuZ2UoZXZlbnQpIHtcbiAgLy8gIGNvbnNvbGUubG9nKFwiT24gcGxheWVyIHN0YXRlIGNoYW5nZVwiLCBldmVudCk7XG4gIH1cblxuICBmdW5jdGlvbiBvblBsYXllclJlYWR5KGV2ZW50KSB7XG4vLyAgICBjb25zb2xlLmxvZyhcIk9uIHBsYXllciByZWFkeVwiLCBldmVudCk7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFcnJvcihlcnJvcikge1xuICAgIGNvbnNvbGUuZGVidWcoXCJ2aWRlby1mb2xkZXI6OnBsYXllckVycm9yKClcIiwgZXJyb3IpO1xuXG4gICAgLy8gYWN0IGFzIHRob3VnaCB2aWRlbyBoYXMgZW5kZWRcbiAgICBwbGF5ZXJFbmRlZCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBwYXVzZSgpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcIm5vU3RvcmFnZUZpbGVcIjogbm9TdG9yYWdlRmlsZSxcbiAgICBcIm9uU3RvcmFnZUluaXRcIjogb25TdG9yYWdlSW5pdCxcbiAgICBcIm9uU3RvcmFnZVJlZnJlc2hcIjogb25TdG9yYWdlUmVmcmVzaCxcbiAgICBcInBhdXNlXCI6IHBhdXNlLFxuICAgIFwicGxheVwiOiBwbGF5LFxuICAgIFwic2V0QWRkaXRpb25hbFBhcmFtc1wiOiBzZXRBZGRpdGlvbmFsUGFyYW1zLFxuICAgIFwicGxheWVyRW5kZWRcIjogcGxheWVyRW5kZWQsXG4gICAgXCJwbGF5ZXJSZWFkeVwiOiBwbGF5ZXJSZWFkeSxcbiAgICBcInBsYXllckVycm9yXCI6IHBsYXllckVycm9yLFxuICAgIFwic3RvcFwiOiBzdG9wXG4gIH07XG5cbn0pKGdhZGdldHMpO1xuXHJcbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcclxuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcclxuXHJcblJpc2VWaXNpb24uQ29tbW9uLlZpZGVvID0gUmlzZVZpc2lvbi5Db21tb24uVmlkZW8gfHwge307XHJcblxyXG5SaXNlVmlzaW9uLkNvbW1vbi5WaWRlby5GcmFtZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gIHZhciBQUkVGSVggPSBcImlmX1wiO1xyXG5cclxuICBmdW5jdGlvbiBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCkge1xyXG4gICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGdldEZyYW1lT2JqZWN0KGluZGV4KSB7XHJcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXHJcbiAgICAgIGlmcmFtZTtcclxuXHJcbiAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xyXG5cclxuICAgIGlmIChpZnJhbWUpIHtcclxuICAgICAgcmV0dXJuIChpZnJhbWUuY29udGVudFdpbmRvdykgPyBpZnJhbWUuY29udGVudFdpbmRvdyA6XHJcbiAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBfY2xlYXIoaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcclxuICAgICAgZnJhbWVPYmogPSBnZXRGcmFtZU9iamVjdChpbmRleCksXHJcbiAgICAgIGlmcmFtZTtcclxuXHJcbiAgICBpZiAoZnJhbWVPYmopIHtcclxuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcclxuICAgICAgZnJhbWVPYmoucmVtb3ZlKCk7XHJcbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgXCJhYm91dDpibGFua1wiKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGFkZChpbmRleCkge1xyXG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxyXG4gICAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpO1xyXG5cclxuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJhbGxvd1RyYW5zcGFyZW5jeVwiLCB0cnVlKTtcclxuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJmcmFtZWJvcmRlclwiLCBcIjBcIik7XHJcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic2Nyb2xsaW5nXCIsIFwibm9cIik7XHJcblxyXG4gICAgZnJhbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGNyZWF0ZUZyYW1lUGxheWVyKGluZGV4LCBwYXJhbXMsIGZpbGVzLCBza2luLCBzcmMpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcclxuICAgICAgZnJhbWVPYmogPSBnZXRGcmFtZU9iamVjdChpbmRleCksXHJcbiAgICAgIGlmcmFtZTtcclxuXHJcbiAgICBpZiAoZnJhbWVPYmopIHtcclxuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcclxuXHJcbiAgICAgIGlmcmFtZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWZyYW1lLm9ubG9hZCA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGluaXRpYWxpemUgYW5kIGxvYWQgdGhlIHBsYXllciBpbnNpZGUgdGhlIGlmcmFtZVxyXG4gICAgICAgIGZyYW1lT2JqLmluaXQocGFyYW1zLCBmaWxlcywgc2tpbik7XHJcbiAgICAgICAgZnJhbWVPYmoubG9hZCgpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBzcmMpO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGhpZGUoaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KTtcclxuXHJcbiAgICBmcmFtZUNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHJlbW92ZShpbmRleCwgY2FsbGJhY2spIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcclxuXHJcbiAgICBfY2xlYXIoaW5kZXgpO1xyXG5cclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAvLyByZW1vdmUgdGhlIGlmcmFtZSBieSBjbGVhcmluZyBhbGwgZWxlbWVudHMgaW5zaWRlIGRpdiBjb250YWluZXJcclxuICAgICAgd2hpbGUgKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpIHtcclxuICAgICAgICBmcmFtZUNvbnRhaW5lci5yZW1vdmVDaGlsZChmcmFtZUNvbnRhaW5lci5maXJzdENoaWxkKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGNhbGxiYWNrICYmIHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgfVxyXG4gICAgfSwgMjAwKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNob3coaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KTtcclxuXHJcbiAgICBmcmFtZUNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgYWRkOiBhZGQsXHJcbiAgICBjcmVhdGVGcmFtZVBsYXllcjogY3JlYXRlRnJhbWVQbGF5ZXIsXHJcbiAgICBnZXRGcmFtZUNvbnRhaW5lcjogZ2V0RnJhbWVDb250YWluZXIsXHJcbiAgICBnZXRGcmFtZU9iamVjdDogZ2V0RnJhbWVPYmplY3QsXHJcbiAgICBoaWRlOiBoaWRlLFxyXG4gICAgcmVtb3ZlOiByZW1vdmUsXHJcbiAgICBzaG93OiBzaG93XHJcbiAgfTtcclxufTtcclxuXHJcbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcclxuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcclxuXHJcblJpc2VWaXNpb24uQ29tbW9uLk1lc3NhZ2UgPSBmdW5jdGlvbiAobWFpbkNvbnRhaW5lciwgbWVzc2FnZUNvbnRhaW5lcikge1xyXG4gIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICB2YXIgX2FjdGl2ZSA9IGZhbHNlO1xyXG5cclxuICBmdW5jdGlvbiBfaW5pdCgpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gbWFpbkNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihcIkNhbid0IGluaXRpYWxpemUgTWVzc2FnZSAtIFwiLCBlLm1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiAgUHVibGljIE1ldGhvZHNcclxuICAgKi9cclxuICBmdW5jdGlvbiBoaWRlKCkge1xyXG4gICAgaWYgKF9hY3RpdmUpIHtcclxuICAgICAgLy8gY2xlYXIgY29udGVudCBvZiBtZXNzYWdlIGNvbnRhaW5lclxyXG4gICAgICB3aGlsZSAobWVzc2FnZUNvbnRhaW5lci5maXJzdENoaWxkKSB7XHJcbiAgICAgICAgbWVzc2FnZUNvbnRhaW5lci5yZW1vdmVDaGlsZChtZXNzYWdlQ29udGFpbmVyLmZpcnN0Q2hpbGQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBoaWRlIG1lc3NhZ2UgY29udGFpbmVyXHJcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG5cclxuICAgICAgLy8gc2hvdyBtYWluIGNvbnRhaW5lclxyXG4gICAgICBtYWluQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcclxuXHJcbiAgICAgIF9hY3RpdmUgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNob3cobWVzc2FnZSkge1xyXG4gICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLFxyXG4gICAgICBwO1xyXG5cclxuICAgIGlmICghX2FjdGl2ZSkge1xyXG4gICAgICAvLyBoaWRlIG1haW4gY29udGFpbmVyXHJcbiAgICAgIG1haW5Db250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XHJcblxyXG4gICAgICBtZXNzYWdlQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcblxyXG4gICAgICAvLyBjcmVhdGUgbWVzc2FnZSBlbGVtZW50XHJcbiAgICAgIHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcclxuICAgICAgcC5pbm5lckhUTUwgPSBtZXNzYWdlO1xyXG4gICAgICBwLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwibWVzc2FnZVwiKTtcclxuICAgICAgcC5zdHlsZS5saW5lSGVpZ2h0ID0gbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7XHJcblxyXG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChwKTtcclxuICAgICAgbWVzc2FnZUNvbnRhaW5lci5hcHBlbmRDaGlsZChmcmFnbWVudCk7XHJcblxyXG4gICAgICBfYWN0aXZlID0gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIG1lc3NhZ2UgYWxyZWFkeSBiZWluZyBzaG93biwgdXBkYXRlIG1lc3NhZ2UgdGV4dFxyXG4gICAgICBwID0gbWVzc2FnZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiLm1lc3NhZ2VcIik7XHJcbiAgICAgIHAuaW5uZXJIVE1MID0gbWVzc2FnZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9pbml0KCk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBcImhpZGVcIjogaGlkZSxcclxuICAgIFwic2hvd1wiOiBzaG93XHJcbiAgfTtcclxufTtcclxuXHJcbi8qIGdsb2JhbCBnYWRnZXRzLCBSaXNlVmlzaW9uICovXG5cbihmdW5jdGlvbiAod2luZG93LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBwcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCksXG4gICAgaWQgPSBwcmVmcy5nZXRTdHJpbmcoXCJpZFwiKTtcblxuICAvLyBEaXNhYmxlIGNvbnRleHQgbWVudSAocmlnaHQgY2xpY2sgbWVudSlcbiAgd2luZG93Lm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5wbGF5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8uc3RvcCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9seW1lclJlYWR5KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG4gICAgY29uc29sZS5sb2coXCJSZWdpc3RlcmluZyBnYWRnZXQgd2l0aCBpZFwiLCBpZCk7XG5cbiAgICBpZiAoaWQgJiYgaWQgIT09IFwiXCIpIHtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGxheV9cIiArIGlkLCBwbGF5KTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGF1c2VfXCIgKyBpZCwgcGF1c2UpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9zdG9wX1wiICsgaWQsIHN0b3ApO1xuXG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzcGFyYW1fc2V0X1wiICsgaWQsIFJpc2VWaXNpb24uVmlkZW8uc2V0QWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNwYXJhbV9nZXRcIiwgbnVsbCwgaWQsIFtcImFkZGl0aW9uYWxQYXJhbXNcIl0pO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXHJcbi8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbnZhciBfZ2FxID0gX2dhcSB8fCBbXTtcblxuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNTcwOTIxNTktMiddKTtcbl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pO1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOyBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IGdhLmFzeW5jID0gdHJ1ZTtcbiAgZ2Euc3JjID0gKCdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID8gJ2h0dHBzOi8vc3NsJyA6ICdodHRwOi8vd3d3JykgKyAnLmdvb2dsZS1hbmFseXRpY3MuY29tL2dhLmpzJztcbiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07IHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpO1xufSkoKTtcbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
