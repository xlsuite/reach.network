function loadVideoLinkFromXLSuite(e,t,n){var i="818f22de-40a2-4fa0-a28e-c4d3fa64d331";console.log("displayKey param",e),$.ajax({url:"https://socialweedia.com/admin/api/liquids/call?api_key="+i+"&tag=load_screen&display_key="+e}).then(function(e){if(!e||!e.screen)return console.log("Error - Returned data is empty",e),n&&n(),void 0;var i=e.screen.channel_url,o=i.substring(i.indexOf("?list=")+6);console.log("Loaded channel URL, channel ID",i,o),t(o)})}if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml",STORAGE_ENV:"prod"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e){"use strict";function t(){e.rpc.call("","rsevent_ready",null,R.getString("id"),!0,!0,!0,!0,!0)}function n(){}function i(){}function o(){}function r(){}function s(){}function a(){}function l(){}function c(){clearTimeout(C),C=setInterval(function(){console.log("Interval check"),loadVideoLinkFromXLSuite(V,function(e){e!=S&&(S=e,m(S,v.width,v.height))})},w)}function d(t,n){console.log("additional params values",n),Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(n)&&n.length>0&&(v=JSON.parse(n[0]),R=new e.Prefs,v||(v={},console.log("additional params recreated")),document.getElementById("videoContainer").style.height=R.getInt("rsH")+"px",v.width=R.getInt("rsW"),v.height=R.getInt("rsH"),R.getString("displayId")?(V=R.getString("displayId"),console.log("displayId set from gadget param",V)):(V=v.displayId,console.log("displayId set from default settings",V)),loadVideoLinkFromXLSuite(V,u,function(){V!=R.getString("displayId")&&(V=v.displayId,console.log("Trying to use default displayId",V),loadVideoLinkFromXLSuite(V,u))}))}function u(e){S=e,m(S,v.width,v.height),c(),t()}function m(e,t,n){console.log("Video url, w, h",e,t,n),_=new YT.Player("mainIframe",{width:t,height:n,playerVars:{listType:"playlist",list:e,autoplay:1,controls:0,loop:1,showinfo:0},events:{onError:g,onReady:p,onStateChange:f}})}function g(e){console.log("Player error code",e),_&&null!=_&&e&&e.data>=100&&(_.nextVideo(),console.log("Error, playing next video",e))}function f(){}function p(){}function y(e){console.debug("video-folder::playerError()",e),a()}function h(){r()}var v,V,R=null,S="",w=5e3,C=null,_=null;return{noStorageFile:n,onStorageInit:i,onStorageRefresh:o,pause:r,play:s,setAdditionalParams:d,playerEnded:a,playerReady:l,playerError:y,stop:h}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function e(e){return document.getElementById(l+e)}function t(t){var n,i=e(t);return n=i.querySelector("iframe"),n?n.contentWindow?n.contentWindow:n.contentDocument.document?n.contentDocument.document:n.contentDocument:null}function n(n){var i,o=e(n),r=t(n);r&&(i=o.querySelector("iframe"),r.remove(),i.setAttribute("src","about:blank"))}function i(t){var n=e(t),i=document.createElement("iframe");i.setAttribute("allowTransparency",!0),i.setAttribute("frameborder","0"),i.setAttribute("scrolling","no"),n.appendChild(i)}function o(n,i,o,r,s){var a,l=e(n),c=t(n);c&&(a=l.querySelector("iframe"),a.onload=function(){a.onload=null,c.init(i,o,r),c.load()},a.setAttribute("src",s))}function r(t){var n=e(t);n.style.visibility="hidden"}function s(e,t){var i=document.getElementById(l+e);n(e),setTimeout(function(){for(;i.firstChild;)i.removeChild(i.firstChild);t&&"function"==typeof t&&t()},200)}function a(t){var n=e(t);n.style.visibility="visible"}var l="if_";return{add:i,createFramePlayer:o,getFrameContainer:e,getFrameObject:t,hide:r,remove:s,show:a}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Message=function(e,t){"use strict";function n(){try{t.style.height=e.style.height}catch(n){console.warn("Can't initialize Message - ",n.message)}}function i(){if(r){for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none",e.style.visibility="visible",r=!1}}function o(n){var i,o=document.createDocumentFragment();r?(i=t.querySelector(".message"),i.innerHTML=n):(e.style.visibility="hidden",t.style.display="block",i=document.createElement("p"),i.innerHTML=n,i.setAttribute("class","message"),i.style.lineHeight=t.style.height,o.appendChild(i),t.appendChild(o),r=!0)}var r=!1;return n(),{hide:i,show:o}},function(e,t){"use strict";function n(){RiseVision.Video.play()}function i(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function r(){e.removeEventListener("WebComponentsReady",r),console.log("Registering gadget with id",a),a&&""!==a&&(t.rpc.register("rscmd_play_"+a,n),t.rpc.register("rscmd_pause_"+a,i),t.rpc.register("rscmd_stop_"+a,o),t.rpc.register("rsparam_set_"+a,RiseVision.Video.setAdditionalParams),t.rpc.call("","rsparam_get",null,a,["additionalParams"]))}var s=new t.Prefs,a=s.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("WebComponentsReady",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsibG9hZFZpZGVvTGlua0Zyb21YTFN1aXRlIiwiZGlzcGxheUtleSIsInN1Y2Nlc3NDYWxsYmFjayIsImVycm9yQ2FsbGJhY2siLCJhcGlLZXkiLCJjb25zb2xlIiwibG9nIiwiJCIsImFqYXgiLCJ1cmwiLCJ0aGVuIiwiZGF0YSIsInNjcmVlbiIsImNoYW5lbFVybCIsImNoYW5uZWxfdXJsIiwiY2hhbm5lbElkIiwic3Vic3RyaW5nIiwiaW5kZXhPZiIsImNvbmZpZyIsIlNLSU4iLCJTVE9SQUdFX0VOViIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsInRhZyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNyYyIsImZpcnN0U2NyaXB0VGFnIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIiwiUmlzZVZpc2lvbiIsIlZpZGVvIiwiZ2FkZ2V0cyIsIl9yZWFkeSIsInJwYyIsImNhbGwiLCJfcHJlZnMiLCJnZXRTdHJpbmciLCJub1N0b3JhZ2VGaWxlIiwib25TdG9yYWdlSW5pdCIsIm9uU3RvcmFnZVJlZnJlc2giLCJwYXVzZSIsInBsYXkiLCJwbGF5ZXJFbmRlZCIsInBsYXllclJlYWR5Iiwic3RhcnRQbGF5bGlzdENoYW5nZVRpbWVyIiwiY2xlYXJUaW1lb3V0IiwiX3BsYXlsaXN0Q2hhbmdlVGltZXIiLCJzZXRJbnRlcnZhbCIsImRpc3BsYXlJZCIsInZpZGVvVXJsIiwiX2N1cnJlbnRGaWxlIiwiaW5pdFlUUGxheWVyIiwiX2FkZGl0aW9uYWxQYXJhbXMiLCJ3aWR0aCIsImhlaWdodCIsInhsU3VpdGVQbGF5bGlzdFJlZnJlc2hEdXJhdGlvbiIsInNldEFkZGl0aW9uYWxQYXJhbXMiLCJuYW1lcyIsInZhbHVlcyIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsIkpTT04iLCJwYXJzZSIsIlByZWZzIiwiZ2V0RWxlbWVudEJ5SWQiLCJzdHlsZSIsImdldEludCIsInN0YXJ0WExTdWl0ZVBsYXllciIsInBsYXlsaXN0SWQiLCJ5b3V0dWJlUGxheWVySlMiLCJZVCIsIlBsYXllciIsInBsYXllclZhcnMiLCJsaXN0VHlwZSIsImxpc3QiLCJhdXRvcGxheSIsImNvbnRyb2xzIiwibG9vcCIsInNob3dpbmZvIiwiZXZlbnRzIiwib25FcnJvciIsIm9uUGxheWVyRXJyb3IiLCJvblJlYWR5Iiwib25QbGF5ZXJSZWFkeSIsIm9uU3RhdGVDaGFuZ2UiLCJvblBsYXllclN0YXRlQ2hhbmdlIiwiZXZlbnQiLCJuZXh0VmlkZW8iLCJwbGF5ZXJFcnJvciIsImVycm9yIiwiZGVidWciLCJzdG9wIiwiQ29tbW9uIiwiRnJhbWVDb250cm9sbGVyIiwiZ2V0RnJhbWVDb250YWluZXIiLCJpbmRleCIsIlBSRUZJWCIsImdldEZyYW1lT2JqZWN0IiwiaWZyYW1lIiwiZnJhbWVDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudFdpbmRvdyIsImNvbnRlbnREb2N1bWVudCIsIl9jbGVhciIsImZyYW1lT2JqIiwicmVtb3ZlIiwic2V0QXR0cmlidXRlIiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJjcmVhdGVGcmFtZVBsYXllciIsInBhcmFtcyIsImZpbGVzIiwic2tpbiIsIm9ubG9hZCIsImluaXQiLCJsb2FkIiwiaGlkZSIsInZpc2liaWxpdHkiLCJjYWxsYmFjayIsInNldFRpbWVvdXQiLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJzaG93IiwiTWVzc2FnZSIsIm1haW5Db250YWluZXIiLCJtZXNzYWdlQ29udGFpbmVyIiwiX2luaXQiLCJlIiwid2FybiIsIm1lc3NhZ2UiLCJfYWN0aXZlIiwiZGlzcGxheSIsInAiLCJmcmFnbWVudCIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJpbm5lckhUTUwiLCJsaW5lSGVpZ2h0Iiwid2luZG93IiwicG9seW1lclJlYWR5IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImlkIiwicmVnaXN0ZXIiLCJwcmVmcyIsIm9uY29udGV4dG1lbnUiLCJhZGRFdmVudExpc3RlbmVyIiwiX2dhcSIsInB1c2giLCJnYSIsInR5cGUiLCJhc3luYyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJzIl0sIm1hcHBpbmdzIjoiQUFpQkEsUUFBU0EsMEJBQXlCQyxFQUFZQyxFQUFpQkMsR0FDN0QsR0FBSUMsR0FBUyxzQ0FDYkMsU0FBUUMsSUFBSSxtQkFBb0JMLEdBRWhDTSxFQUFFQyxNQUNBQyxJQUFLLDJEQUE2REwsRUFBUyxnQ0FBa0NILElBQzVHUyxLQUFLLFNBQVVDLEdBQ2hCLElBQUtBLElBQVNBLEVBQUtDLE9BS2pCLE1BSkFQLFNBQVFDLElBQUksaUNBQWtDSyxHQUMxQ1IsR0FDRkEsSUFFRixNQUlGLElBQUlVLEdBQVlGLEVBQUtDLE9BQU9FLFlBQ3hCQyxFQUFZRixFQUFVRyxVQUFVSCxFQUFVSSxRQUFRLFVBQVksRUFFbEVaLFNBQVFDLElBQUksaUNBQWtDTyxFQUFXRSxHQUN6RGIsRUFBZ0JhLEtBbkNwQixHQUFzQixtQkFBWEcsUUFBd0IsQ0FDakMsR0FBSUEsU0FDRkMsS0FBTSxrQkFDTkMsWUFBYSxPQUdRLG9CQUFaQyxVQUNUQSxRQUFRQyxPQUFPLG9DQUNaQyxTQUFTLGlCQUFrQix3QkFDM0JBLFNBQVMsZ0JBQWlCLFNBMENqQyxHQUFJQyxLQUFNQyxTQUFTQyxjQUFjLFNBQ2pDRixLQUFJRyxJQUFNLG9DQUVWLElBQUlDLGdCQUFpQkgsU0FBU0kscUJBQXFCLFVBQVUsRUFDN0RELGdCQUFlRSxXQUFXQyxhQUFhUCxJQUFLSSxlQUU1QyxJQUFJSSxZQUFhQSxjQUNqQkEsWUFBV0MsU0FFWEQsV0FBV0MsTUFBUSxTQUFXQyxHQUM1QixZQWtCQSxTQUFTQyxLQUNQRCxFQUFRRSxJQUFJQyxLQUFLLEdBQUksZ0JBQWlCLEtBQU1DLEVBQU9DLFVBQVUsT0FBTyxHQUFNLEdBQU0sR0FBTSxHQUFNLEdBTTlGLFFBQVNDLE1BR1QsUUFBU0MsTUFHVCxRQUFTQyxNQUdULFFBQVNDLE1BR1QsUUFBU0MsTUFHVCxRQUFTQyxN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UFosV0FBV0MsTUFBTVcsT0FHbkIsUUFBU0QsS0FDUFgsV0FBV0MsTUFBTVUsUUFHbkIsUUFBU29ELEtBQ1AvRCxXQUFXQyxNQUFNOEQsT0FHbkIsUUFBUytDLEtBQ1BELEVBQU9FLG9CQUFvQixxQkFBc0JELEdBQ2pEekksUUFBUUMsSUFBSSw2QkFBOEIwSSxHQUV0Q0EsR0FBYSxLQUFQQSxJQUNSOUcsRUFBUUUsSUFBSTZHLFNBQVMsY0FBZ0JELEVBQUlwRyxHQUN6Q1YsRUFBUUUsSUFBSTZHLFNBQVMsZUFBaUJELEVBQUlyRyxHQUMxQ1QsRUFBUUUsSUFBSTZHLFNBQVMsY0FBZ0JELEVBQUlqRCxHQUV6QzdELEVBQVFFLElBQUk2RyxTQUFTLGVBQWlCRCxFQUFJaEgsV0FBV0MsTUFBTTBCLHFCQUMzRHpCLEVBQVFFLElBQUlDLEtBQUssR0FBSSxjQUFlLEtBQU0yRyxHQUFLLHNCQTlCbkQsR0FBSUUsR0FBUSxHQUFJaEgsR0FBUWlDLE1BQ3RCNkUsRUFBS0UsRUFBTTNHLFVBQVUsS0FHdkJzRyxHQUFPTSxjQUFnQixXQUNyQixPQUFPLEdBNkJUTixFQUFPTyxpQkFBaUIscUJBQXNCTixJQUU3Q0QsT0FBUTNHLFFBS1gsSUFBSW1ILE1BQU9BLFFBRVhBLE1BQUtDLE1BQU0sY0FBZSxrQkFDMUJELEtBQUtDLE1BQU0sbUJBRVgsV0FDRSxHQUFJQyxHQUFLOUgsU0FBU0MsY0FBYyxTQUFXNkgsR0FBR0MsS0FBTyxrQkFBbUJELEVBQUdFLE9BQVEsRUFDbkZGLEVBQUc1SCxLQUFPLFVBQVlGLFNBQVNpSSxTQUFTQyxTQUFXLGNBQWdCLGNBQWdCLDZCQUNuRixJQUFJQyxHQUFJbkksU0FBU0kscUJBQXFCLFVBQVUsRUFBSStILEdBQUU5SCxXQUFXQyxhQUFhd0gsRUFBSUsiLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICBTS0lOOiBcInNraW4vUlZTa2luLnhtbFwiLFxuICAgIFNUT1JBR0VfRU5WOiBcInByb2RcIlxuICB9O1xuXG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1BSRUZJWFwiLCBcImxvY2FsZXMvdHJhbnNsYXRpb25fXCIpXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1NVRklYXCIsIFwiLmpzb25cIik7XG4gIH1cbn1cblxyXG4ndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIGxvYWRWaWRlb0xpbmtGcm9tWExTdWl0ZShkaXNwbGF5S2V5LCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcbiAgdmFyIGFwaUtleSA9IFwiODE4ZjIyZGUtNDBhMi00ZmEwLWEyOGUtYzRkM2ZhNjRkMzMxXCI7XG4gIGNvbnNvbGUubG9nKFwiZGlzcGxheUtleSBwYXJhbVwiLCBkaXNwbGF5S2V5KTtcblxuICAkLmFqYXgoe1xuICAgIHVybDogXCJodHRwczovL3NvY2lhbHdlZWRpYS5jb20vYWRtaW4vYXBpL2xpcXVpZHMvY2FsbD9hcGlfa2V5PVwiICsgYXBpS2V5ICsgXCImdGFnPWxvYWRfc2NyZWVuJmRpc3BsYXlfa2V5PVwiICsgZGlzcGxheUtleVxuICB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgaWYgKCFkYXRhIHx8ICFkYXRhLnNjcmVlbikge1xuICAgICAgY29uc29sZS5sb2coXCJFcnJvciAtIFJldHVybmVkIGRhdGEgaXMgZW1wdHlcIiwgZGF0YSk7XG4gICAgICBpZiAoZXJyb3JDYWxsYmFjaykge1xuICAgICAgICBlcnJvckNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy90b2RvOiBzYXZlIGNoYW5uZWwgVVJMIHRvIHNvbWUgIHNldHRpbmdzIC8gdmFyaWFibGVcbiAgICB2YXIgY2hhbmVsVXJsID0gZGF0YS5zY3JlZW4uY2hhbm5lbF91cmw7XG4gICAgdmFyIGNoYW5uZWxJZCA9IGNoYW5lbFVybC5zdWJzdHJpbmcoY2hhbmVsVXJsLmluZGV4T2YoXCI/bGlzdD1cIikgKyA2KTtcblxuICAgIGNvbnNvbGUubG9nKFwiTG9hZGVkIGNoYW5uZWwgVVJMLCBjaGFubmVsIElEXCIsIGNoYW5lbFVybCwgY2hhbm5lbElkKTtcbiAgICBzdWNjZXNzQ2FsbGJhY2soY2hhbm5lbElkKTtcblxuICAgIC8vUk4gLSBodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC92aWRlb3Nlcmllcz9saXN0PVBMbjU2VmJ4T1M3N2ZkLXFiWncwbXZuUzJQbV9fdHZTSFpcbiAgICAvL215IC0gaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvdmlkZW9zZXJpZXM/bGlzdD1QTDQ4Wkd3Q3B3UHlGVmlFTGdzbnZVa25Sekp5bzJnT2hBXG5cbiAgICAvL3RvZG86IGZpeCBlbWJlZGRlZCBlcnJvcnNcbiAgICAvL2h0dHBzOi8vd3d3LmRydXBhbC5vcmcvbm9kZS8xODg3ODE4XG4gICAgLy9odHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEyNTIyMjkxL3BhdXNpbmcteW91dHViZS1pZnJhbWUtYXBpLWluLWphdmFzY3JpcHRcbiAgICAvL2h0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvODIwNTE3OS95b3V0dWJlLWFwaS1oYW5kbGluZy12aWRlb3MtdGhhdC1oYXZlLWJlZW4tcmVtb3ZlZC1ieS15b3V0dWJlXG5cbiAgfSk7XG5cbn1cblxyXG4vKiBnbG9iYWwgZ2FkZ2V0cywgY29uZmlnICovXG5cbnZhciB0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbnRhZy5zcmMgPSBcImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2lmcmFtZV9hcGlcIjtcblxudmFyIGZpcnN0U2NyaXB0VGFnID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdO1xuZmlyc3RTY3JpcHRUYWcucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGFnLCBmaXJzdFNjcmlwdFRhZyk7XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW8gPSB7fTtcblxuUmlzZVZpc2lvbi5WaWRlbyA9IChmdW5jdGlvbiAoZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2FkZGl0aW9uYWxQYXJhbXM7XG4gIHZhciBfcHJlZnMgPSBudWxsO1xuXG4gIHZhciBfY3VycmVudEZpbGUgPSBcIlwiO1xuICB2YXIgZGlzcGxheUlkO1xuXG4gIHZhciB4bFN1aXRlUGxheWxpc3RSZWZyZXNoRHVyYXRpb24gPSA1MDAwOyAvLzUgc2VjXG5cbiAgdmFyIF9wbGF5bGlzdENoYW5nZVRpbWVyID0gbnVsbDtcblxuICB2YXIgeW91dHViZVBsYXllckpTID0gbnVsbDtcblxuICBmdW5jdGlvbiBfZG9uZSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9kb25lXCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSk7XG4gIH1cblxuICBmdW5jdGlvbiBfcmVhZHkoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfcmVhZHlcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gbm9TdG9yYWdlRmlsZSgpIHtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZUluaXQodXJsKSB7XG4gIH1cblxuICBmdW5jdGlvbiBvblN0b3JhZ2VSZWZyZXNoKHVybCkge1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyRW5kZWQoKSB7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJSZWFkeSgpIHtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0YXJ0UGxheWxpc3RDaGFuZ2VUaW1lcigpIHtcbiAgICBjbGVhclRpbWVvdXQoX3BsYXlsaXN0Q2hhbmdlVGltZXIpO1xuXG4gICAgX3BsYXlsaXN0Q2hhbmdlVGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkludGVydmFsIGNoZWNrXCIpO1xuXG4gICAgICBsb2FkVmlkZW9MaW5rRnJvbVhMU3VpdGUoZGlzcGxheUlkLCBmdW5jdGlvbiAodmlkZW9VcmwpIHtcbiAgICAgICAgaWYgKHZpZGVvVXJsICE9IF9jdXJyZW50RmlsZSkge1xuICAgICAgICAgIF9jdXJyZW50RmlsZSA9IHZpZGVvVXJsO1xuICAgICAgICAgIGluaXRZVFBsYXllcihfY3VycmVudEZpbGUsIF9hZGRpdGlvbmFsUGFyYW1zLndpZHRoLCBfYWRkaXRpb25hbFBhcmFtcy5oZWlnaHQpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIH0sIHhsU3VpdGVQbGF5bGlzdFJlZnJlc2hEdXJhdGlvbik7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRBZGRpdGlvbmFsUGFyYW1zKG5hbWVzLCB2YWx1ZXMpIHtcbiAgICBjb25zb2xlLmxvZyhcImFkZGl0aW9uYWwgcGFyYW1zIHZhbHVlc1wiLCB2YWx1ZXMpO1xuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWVzKSAmJiBuYW1lcy5sZW5ndGggPiAwICYmIG5hbWVzWzBdID09PSBcImFkZGl0aW9uYWxQYXJhbXNcIikge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSAmJiB2YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcyA9IEpTT04ucGFyc2UodmFsdWVzWzBdKTtcbiAgICAgICAgX3ByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKTtcblxuICAgICAgICBpZiAoIV9hZGRpdGlvbmFsUGFyYW1zKSB7XG4gICAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMgPSB7fTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcImFkZGl0aW9uYWwgcGFyYW1zIHJlY3JlYXRlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9Db250YWluZXJcIikuc3R5bGUuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKSArIFwicHhcIjtcblxuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy53aWR0aCA9IF9wcmVmcy5nZXRJbnQoXCJyc1dcIik7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIik7XG5cbiAgICAgICAgaWYgKF9wcmVmcy5nZXRTdHJpbmcoXCJkaXNwbGF5SWRcIikpIHtcbiAgICAgICAgICBkaXNwbGF5SWQgPSBfcHJlZnMuZ2V0U3RyaW5nKFwiZGlzcGxheUlkXCIpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiZGlzcGxheUlkIHNldCBmcm9tIGdhZGdldCBwYXJhbVwiLCBkaXNwbGF5SWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpc3BsYXlJZCA9IF9hZGRpdGlvbmFsUGFyYW1zLmRpc3BsYXlJZDtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcImRpc3BsYXlJZCBzZXQgZnJvbSBkZWZhdWx0IHNldHRpbmdzXCIsIGRpc3BsYXlJZCk7XG4gICAgICAgIH1cblxuICAgICAgICBsb2FkVmlkZW9MaW5rRnJvbVhMU3VpdGUoZGlzcGxheUlkLCBzdGFydFhMU3VpdGVQbGF5ZXIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmIChkaXNwbGF5SWQgIT0gX3ByZWZzLmdldFN0cmluZyhcImRpc3BsYXlJZFwiKSkge1xuICAgICAgICAgICAgZGlzcGxheUlkID0gX2FkZGl0aW9uYWxQYXJhbXMuZGlzcGxheUlkO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJUcnlpbmcgdG8gdXNlIGRlZmF1bHQgZGlzcGxheUlkXCIsIGRpc3BsYXlJZCk7XG4gICAgICAgICAgICBsb2FkVmlkZW9MaW5rRnJvbVhMU3VpdGUoZGlzcGxheUlkLCBzdGFydFhMU3VpdGVQbGF5ZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gc3RhcnRYTFN1aXRlUGxheWVyKHZpZGVvVXJsKSB7XG4gICAgX2N1cnJlbnRGaWxlID0gdmlkZW9Vcmw7XG4gICAgaW5pdFlUUGxheWVyKF9jdXJyZW50RmlsZSwgX2FkZGl0aW9uYWxQYXJhbXMud2lkdGgsIF9hZGRpdGlvbmFsUGFyYW1zLmhlaWdodCk7XG4gICAgc3RhcnRQbGF5bGlzdENoYW5nZVRpbWVyKCk7XG5cbiAgICBfcmVhZHkoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGluaXRZVFBsYXllcihwbGF5bGlzdElkLCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgY29uc29sZS5sb2coXCJWaWRlbyB1cmwsIHcsIGhcIiwgcGxheWxpc3RJZCwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICB5b3V0dWJlUGxheWVySlMgPSBuZXcgWVQuUGxheWVyKCdtYWluSWZyYW1lJywge1xuICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICBwbGF5ZXJWYXJzOiB7XG4gICAgICAgIGxpc3RUeXBlOidwbGF5bGlzdCcsXG4gICAgICAgIGxpc3Q6IHBsYXlsaXN0SWQsXG4gICAgICAgICdhdXRvcGxheSc6IDEsXG4gICAgICAgICdjb250cm9scyc6IDAsXG4gICAgICAgICdsb29wJzogMSxcbiAgICAgICAgJ3Nob3dpbmZvJzogMFxuICAgICAgfSxcbiAgICAgIGV2ZW50czoge1xuICAgICAgICAnb25FcnJvcic6IG9uUGxheWVyRXJyb3IsXG4gICAgICAgICdvblJlYWR5Jzogb25QbGF5ZXJSZWFkeSxcbiAgICAgICAgJ29uU3RhdGVDaGFuZ2UnOiBvblBsYXllclN0YXRlQ2hhbmdlXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBvblBsYXllckVycm9yKGV2ZW50KSB7XG4gICAgY29uc29sZS5sb2coXCJQbGF5ZXIgZXJyb3IgY29kZVwiLCBldmVudCk7XG4gICAgaWYgKHlvdXR1YmVQbGF5ZXJKUyAmJiB5b3V0dWJlUGxheWVySlMgIT0gbnVsbCAmJiBldmVudCAmJiBldmVudC5kYXRhID49IDEwMCkge1xuICAgICAgeW91dHViZVBsYXllckpTLm5leHRWaWRlbygpO1xuICAgICAgY29uc29sZS5sb2coXCJFcnJvciwgcGxheWluZyBuZXh0IHZpZGVvXCIsIGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBvblBsYXllclN0YXRlQ2hhbmdlKGV2ZW50KSB7XG4gIC8vICBjb25zb2xlLmxvZyhcIk9uIHBsYXllciBzdGF0ZSBjaGFuZ2VcIiwgZXZlbnQpO1xuICB9XG5cbiAgZnVuY3Rpb24gb25QbGF5ZXJSZWFkeShldmVudCkge1xuLy8gICAgY29uc29sZS5sb2coXCJPbiBwbGF5ZXIgcmVhZHlcIiwgZXZlbnQpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyRXJyb3IoZXJyb3IpIHtcbiAgICBjb25zb2xlLmRlYnVnKFwidmlkZW8tZm9sZGVyOjpwbGF5ZXJFcnJvcigpXCIsIGVycm9yKTtcblxuICAgIC8vIGFjdCBhcyB0aG91Z2ggdmlkZW8gaGFzIGVuZGVkXG4gICAgcGxheWVyRW5kZWQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgcGF1c2UoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJub1N0b3JhZ2VGaWxlXCI6IG5vU3RvcmFnZUZpbGUsXG4gICAgXCJvblN0b3JhZ2VJbml0XCI6IG9uU3RvcmFnZUluaXQsXG4gICAgXCJvblN0b3JhZ2VSZWZyZXNoXCI6IG9uU3RvcmFnZVJlZnJlc2gsXG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInNldEFkZGl0aW9uYWxQYXJhbXNcIjogc2V0QWRkaXRpb25hbFBhcmFtcyxcbiAgICBcInBsYXllckVuZGVkXCI6IHBsYXllckVuZGVkLFxuICAgIFwicGxheWVyUmVhZHlcIjogcGxheWVyUmVhZHksXG4gICAgXCJwbGF5ZXJFcnJvclwiOiBwbGF5ZXJFcnJvcixcbiAgICBcInN0b3BcIjogc3RvcFxuICB9O1xuXG59KShnYWRnZXRzKTtcblxyXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XHJcblJpc2VWaXNpb24uQ29tbW9uID0gUmlzZVZpc2lvbi5Db21tb24gfHwge307XHJcblxyXG5SaXNlVmlzaW9uLkNvbW1vbi5WaWRlbyA9IFJpc2VWaXNpb24uQ29tbW9uLlZpZGVvIHx8IHt9O1xyXG5cclxuUmlzZVZpc2lvbi5Db21tb24uVmlkZW8uRnJhbWVDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xyXG4gIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICB2YXIgUFJFRklYID0gXCJpZl9cIjtcclxuXHJcbiAgZnVuY3Rpb24gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpIHtcclxuICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBnZXRGcmFtZU9iamVjdChpbmRleCkge1xyXG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxyXG4gICAgICBpZnJhbWU7XHJcblxyXG4gICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcclxuXHJcbiAgICBpZiAoaWZyYW1lKSB7XHJcbiAgICAgIHJldHVybiAoaWZyYW1lLmNvbnRlbnRXaW5kb3cpID8gaWZyYW1lLmNvbnRlbnRXaW5kb3cgOlxyXG4gICAgICAgIChpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50KSA/IGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQgOiBpZnJhbWUuY29udGVudERvY3VtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gX2NsZWFyKGluZGV4KSB7XHJcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXHJcbiAgICAgIGZyYW1lT2JqID0gZ2V0RnJhbWVPYmplY3QoaW5kZXgpLFxyXG4gICAgICBpZnJhbWU7XHJcblxyXG4gICAgaWYgKGZyYW1lT2JqKSB7XHJcbiAgICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XHJcbiAgICAgIGZyYW1lT2JqLnJlbW92ZSgpO1xyXG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsIFwiYWJvdXQ6YmxhbmtcIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBhZGQoaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcclxuICAgICAgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlmcmFtZVwiKTtcclxuXHJcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwiYWxsb3dUcmFuc3BhcmVuY3lcIiwgdHJ1ZSk7XHJcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwiZnJhbWVib3JkZXJcIiwgXCIwXCIpO1xyXG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNjcm9sbGluZ1wiLCBcIm5vXCIpO1xyXG5cclxuICAgIGZyYW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKGlmcmFtZSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjcmVhdGVGcmFtZVBsYXllcihpbmRleCwgcGFyYW1zLCBmaWxlcywgc2tpbiwgc3JjKSB7XHJcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXHJcbiAgICAgIGZyYW1lT2JqID0gZ2V0RnJhbWVPYmplY3QoaW5kZXgpLFxyXG4gICAgICBpZnJhbWU7XHJcblxyXG4gICAgaWYgKGZyYW1lT2JqKSB7XHJcbiAgICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XHJcblxyXG4gICAgICBpZnJhbWUub25sb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmcmFtZS5vbmxvYWQgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBpbml0aWFsaXplIGFuZCBsb2FkIHRoZSBwbGF5ZXIgaW5zaWRlIHRoZSBpZnJhbWVcclxuICAgICAgICBmcmFtZU9iai5pbml0KHBhcmFtcywgZmlsZXMsIHNraW4pO1xyXG4gICAgICAgIGZyYW1lT2JqLmxvYWQoKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgc3JjKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBoaWRlKGluZGV4KSB7XHJcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCk7XHJcblxyXG4gICAgZnJhbWVDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiByZW1vdmUoaW5kZXgsIGNhbGxiYWNrKSB7XHJcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCk7XHJcblxyXG4gICAgX2NsZWFyKGluZGV4KTtcclxuXHJcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgLy8gcmVtb3ZlIHRoZSBpZnJhbWUgYnkgY2xlYXJpbmcgYWxsIGVsZW1lbnRzIGluc2lkZSBkaXYgY29udGFpbmVyXHJcbiAgICAgIHdoaWxlIChmcmFtZUNvbnRhaW5lci5maXJzdENoaWxkKSB7XHJcbiAgICAgICAgZnJhbWVDb250YWluZXIucmVtb3ZlQ2hpbGQoZnJhbWVDb250YWluZXIuZmlyc3RDaGlsZCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjYWxsYmFjayAmJiB0eXBlb2YgY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgIH1cclxuICAgIH0sIDIwMCk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzaG93KGluZGV4KSB7XHJcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCk7XHJcblxyXG4gICAgZnJhbWVDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGFkZDogYWRkLFxyXG4gICAgY3JlYXRlRnJhbWVQbGF5ZXI6IGNyZWF0ZUZyYW1lUGxheWVyLFxyXG4gICAgZ2V0RnJhbWVDb250YWluZXI6IGdldEZyYW1lQ29udGFpbmVyLFxyXG4gICAgZ2V0RnJhbWVPYmplY3Q6IGdldEZyYW1lT2JqZWN0LFxyXG4gICAgaGlkZTogaGlkZSxcclxuICAgIHJlbW92ZTogcmVtb3ZlLFxyXG4gICAgc2hvdzogc2hvd1xyXG4gIH07XHJcbn07XHJcblxyXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XHJcblJpc2VWaXNpb24uQ29tbW9uID0gUmlzZVZpc2lvbi5Db21tb24gfHwge307XHJcblxyXG5SaXNlVmlzaW9uLkNvbW1vbi5NZXNzYWdlID0gZnVuY3Rpb24gKG1haW5Db250YWluZXIsIG1lc3NhZ2VDb250YWluZXIpIHtcclxuICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgdmFyIF9hY3RpdmUgPSBmYWxzZTtcclxuXHJcbiAgZnVuY3Rpb24gX2luaXQoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBtZXNzYWdlQ29udGFpbmVyLnN0eWxlLmhlaWdodCA9IG1haW5Db250YWluZXIuc3R5bGUuaGVpZ2h0O1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLndhcm4oXCJDYW4ndCBpbml0aWFsaXplIE1lc3NhZ2UgLSBcIiwgZS5tZXNzYWdlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICogIFB1YmxpYyBNZXRob2RzXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gaGlkZSgpIHtcclxuICAgIGlmIChfYWN0aXZlKSB7XHJcbiAgICAgIC8vIGNsZWFyIGNvbnRlbnQgb2YgbWVzc2FnZSBjb250YWluZXJcclxuICAgICAgd2hpbGUgKG1lc3NhZ2VDb250YWluZXIuZmlyc3RDaGlsZCkge1xyXG4gICAgICAgIG1lc3NhZ2VDb250YWluZXIucmVtb3ZlQ2hpbGQobWVzc2FnZUNvbnRhaW5lci5maXJzdENoaWxkKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gaGlkZSBtZXNzYWdlIGNvbnRhaW5lclxyXG4gICAgICBtZXNzYWdlQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuXHJcbiAgICAgIC8vIHNob3cgbWFpbiBjb250YWluZXJcclxuICAgICAgbWFpbkNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XHJcblxyXG4gICAgICBfYWN0aXZlID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzaG93KG1lc3NhZ2UpIHtcclxuICAgIHZhciBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSxcclxuICAgICAgcDtcclxuXHJcbiAgICBpZiAoIV9hY3RpdmUpIHtcclxuICAgICAgLy8gaGlkZSBtYWluIGNvbnRhaW5lclxyXG4gICAgICBtYWluQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xyXG5cclxuICAgICAgbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG5cclxuICAgICAgLy8gY3JlYXRlIG1lc3NhZ2UgZWxlbWVudFxyXG4gICAgICBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgICAgIHAuaW5uZXJIVE1MID0gbWVzc2FnZTtcclxuICAgICAgcC5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIm1lc3NhZ2VcIik7XHJcbiAgICAgIHAuc3R5bGUubGluZUhlaWdodCA9IG1lc3NhZ2VDb250YWluZXIuc3R5bGUuaGVpZ2h0O1xyXG5cclxuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQocCk7XHJcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xyXG5cclxuICAgICAgX2FjdGl2ZSA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBtZXNzYWdlIGFscmVhZHkgYmVpbmcgc2hvd24sIHVwZGF0ZSBtZXNzYWdlIHRleHRcclxuICAgICAgcCA9IG1lc3NhZ2VDb250YWluZXIucXVlcnlTZWxlY3RvcihcIi5tZXNzYWdlXCIpO1xyXG4gICAgICBwLmlubmVySFRNTCA9IG1lc3NhZ2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfaW5pdCgpO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgXCJoaWRlXCI6IGhpZGUsXHJcbiAgICBcInNob3dcIjogc2hvd1xyXG4gIH07XHJcbn07XHJcblxyXG4vKiBnbG9iYWwgZ2FkZ2V0cywgUmlzZVZpc2lvbiAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdywgZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLFxuICAgIGlkID0gcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIik7XG5cbiAgLy8gRGlzYWJsZSBjb250ZXh0IG1lbnUgKHJpZ2h0IGNsaWNrIG1lbnUpXG4gIHdpbmRvdy5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8ucGxheSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5wYXVzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnN0b3AoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBvbHltZXJSZWFkeSgpIHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIldlYkNvbXBvbmVudHNSZWFkeVwiLCBwb2x5bWVyUmVhZHkpO1xuICAgIGNvbnNvbGUubG9nKFwiUmVnaXN0ZXJpbmcgZ2FkZ2V0IHdpdGggaWRcIiwgaWQpO1xuXG4gICAgaWYgKGlkICYmIGlkICE9PSBcIlwiKSB7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BsYXlfXCIgKyBpZCwgcGxheSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BhdXNlX1wiICsgaWQsIHBhdXNlKTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfc3RvcF9cIiArIGlkLCBzdG9wKTtcblxuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc3BhcmFtX3NldF9cIiArIGlkLCBSaXNlVmlzaW9uLlZpZGVvLnNldEFkZGl0aW9uYWxQYXJhbXMpO1xuICAgICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzcGFyYW1fZ2V0XCIsIG51bGwsIGlkLCBbXCJhZGRpdGlvbmFsUGFyYW1zXCJdKTtcbiAgICB9XG4gIH1cblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIldlYkNvbXBvbmVudHNSZWFkeVwiLCBwb2x5bWVyUmVhZHkpO1xuXG59KSh3aW5kb3csIGdhZGdldHMpO1xuXG5cblxyXG4vKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5cbl9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTU3MDkyMTU5LTInXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgZ2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyBnYS5hc3luYyA9IHRydWU7XG4gIGdhLnNyYyA9ICgnaHR0cHM6JyA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICdodHRwczovL3NzbCcgOiAnaHR0cDovL3d3dycpICsgJy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gIHZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTtcbn0pKCk7XG4vKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
