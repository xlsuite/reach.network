function loadVideoLinkFromXLSuite(e,n,i){var t="2ae45fc2-72b9-45ce-9771-caf0fabf9c97";console.log("displayKey param",e),$.ajax({url:"https://rn.xlsuite.com/admin/api/liquids/call?api_key="+t+"&tag=load_screen&display_key="+e}).then(function(e){if(!e||!e.screen)return console.log("Error - Returned data is empty",e),i&&i(),void 0;var t=e.screen.channel_url,o=t.substring(t.indexOf("?list=")+6);console.log("Loaded channel URL, channel ID",t,o),n(o)})}if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml",STORAGE_ENV:"prod"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var RiseVision=RiseVision||{};RiseVision.Video={},RiseVision.Video=function(e){"use strict";function n(){clearTimeout(q),q=null}function i(){e.rpc.call("","rsevent_done",null,I.getString("id"))}function t(){e.rpc.call("","rsevent_ready",null,I.getString("id"),!0,!0,!0,!0,!0)}function o(e){P=setInterval(function(){O=S.url+T+"cb="+(new Date).getTime(),E=!1},e)}function r(){n(),q=setTimeout(function(){i()},5e3)}function s(){j=!0,O="",_.show("The selected video does not exist."),w.remove(F,function(){L||r()})}function a(e){O=e,_.hide(),L||d()}function l(e){O=e,E=!1}function c(){var e=w.getFrameObject(F);return L=!0,j?(n(),void 0):(e&&e.pause(),void 0)}function d(){var e=w.getFrameObject(F);return L=!1,j?(r(),void 0):(E?i():e&&e.play(),void 0)}function u(){w.remove(F,function(){i()})}function m(){var e;A||null!==P||o(k),L||(e=w.getFrameObject(F),e.play())}function g(){clearTimeout(N),N=setInterval(function(){console.log("Interval check"),loadVideoLinkFromXLSuite(C,function(e){e!=O&&(O=e,y(O,S.width,S.height))})},x)}function f(n,i){console.log("additional params values",i),Array.isArray(n)&&n.length>0&&"additionalParams"===n[0]&&Array.isArray(i)&&i.length>0&&(S=JSON.parse(i[0]),I=new e.Prefs,S||(S={},console.log("additional params recreated")),document.getElementById("videoContainer").style.height=I.getInt("rsH")+"px",S.width=I.getInt("rsW"),S.height=I.getInt("rsH"),w=new RiseVision.Common.Video.FrameController,A=!1,I.getString("displayId")?(C=I.getString("displayId"),console.log("displayId set from chromeApp param",C)):(C=S.displayId,console.log("displayId set from default settings",C)),loadVideoLinkFromXLSuite(C,p,function(){C!=I.getString("displayId")&&(C=S.displayId,console.log("Trying to use default displayId",C),loadVideoLinkFromXLSuite(C,p))}))}function p(e){O=e,y(O,S.width,S.height),g(),t()}function y(e,n,i){var t=$("#mainIframe");t.attr("src",e),t.attr("width",n),t.attr("height",i),console.log("Video url, w, h",e,n,i),B=new YT.Player("mainIframe",{width:n,height:i,playerVars:{listType:"playlist",list:e,autoplay:1,controls:0,loop:1,showinfo:0},events:{onError:h(),onReady:V(),onStateChange:v()}})}function h(e){console.log("Player error code",e),B&&null!=B&&(B.nextVideo(),console.log("Error, playing next video",e))}function v(e){console.log("On player state change",e)}function V(e){console.log("On player ready",e)}function R(e){console.debug("video-folder::playerError()",e),E=!0,u()}function b(){c()}var S,C,I=null,_=null,w=null,E=!1,A=!1,L=!0,F=0,T="",O="",k=9e5,P=null,x=5e3,q=null,j=!1,N=null,B=null;return{noStorageFile:s,onStorageInit:a,onStorageRefresh:l,pause:c,play:d,setAdditionalParams:f,playerEnded:u,playerReady:m,playerError:R,stop:b}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Video=RiseVision.Video||{},RiseVision.Video.Storage=function(e){"use strict";function n(){var n=document.getElementById("videoStorage");n&&(n.addEventListener("rise-storage-response",function(e){e.detail&&e.detail.url&&(i?(i=!1,RiseVision.Video.onStorageInit(e.detail.url)):e.detail.hasOwnProperty("changed")&&e.detail.changed&&RiseVision.Video.onStorageRefresh(e.detail.url))}),n.addEventListener("rise-storage-no-file",function(){RiseVision.Video.noStorageFile()}),n.setAttribute("folder",e.storage.folder),n.setAttribute("fileName",e.storage.fileName),n.setAttribute("companyId",e.storage.companyId),n.setAttribute("env",config.STORAGE_ENV),n.go())}var i=!0;return{init:n}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function e(e){return document.getElementById(l+e)}function n(n){var i,t=e(n);return i=t.querySelector("iframe"),i?i.contentWindow?i.contentWindow:i.contentDocument.document?i.contentDocument.document:i.contentDocument:null}function i(i){var t,o=e(i),r=n(i);r&&(t=o.querySelector("iframe"),r.remove(),t.setAttribute("src","about:blank"))}function t(n){var i=e(n),t=document.createElement("iframe");t.setAttribute("allowTransparency",!0),t.setAttribute("frameborder","0"),t.setAttribute("scrolling","no"),i.appendChild(t)}function o(i,t,o,r,s){var a,l=e(i),c=n(i);c&&(a=l.querySelector("iframe"),a.onload=function(){a.onload=null,c.init(t,o,r),c.load()},a.setAttribute("src",s))}function r(n){var i=e(n);i.style.visibility="hidden"}function s(e,n){var t=document.getElementById(l+e);i(e),setTimeout(function(){for(;t.firstChild;)t.removeChild(t.firstChild);n&&"function"==typeof n&&n()},200)}function a(n){var i=e(n);i.style.visibility="visible"}var l="if_";return{add:t,createFramePlayer:o,getFrameContainer:e,getFrameObject:n,hide:r,remove:s,show:a}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Message=function(e,n){"use strict";function i(){try{n.style.height=e.style.height}catch(i){console.warn("Can't initialize Message - ",i.message)}}function t(){if(r){for(;n.firstChild;)n.removeChild(n.firstChild);n.style.display="none",e.style.visibility="visible",r=!1}}function o(i){var t,o=document.createDocumentFragment();r?(t=n.querySelector(".message"),t.innerHTML=i):(e.style.visibility="hidden",n.style.display="block",t=document.createElement("p"),t.innerHTML=i,t.setAttribute("class","message"),t.style.lineHeight=n.style.height,o.appendChild(t),n.appendChild(o),r=!0)}var r=!1;return i(),{hide:t,show:o}},function(e,n){"use strict";function i(){RiseVision.Video.play()}function t(){RiseVision.Video.pause()}function o(){RiseVision.Video.stop()}function r(){e.removeEventListener("WebComponentsReady",r),a&&""!==a&&(n.rpc.register("rscmd_play_"+a,i),n.rpc.register("rscmd_pause_"+a,t),n.rpc.register("rscmd_stop_"+a,o),n.rpc.register("rsparam_set_"+a,RiseVision.Video.setAdditionalParams),n.rpc.call("","rsparam_get",null,a,["additionalParams"]))}var s=new n.Prefs,a=s.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("WebComponentsReady",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsibG9hZFZpZGVvTGlua0Zyb21YTFN1aXRlIiwiZGlzcGxheUtleSIsInN1Y2Nlc3NDYWxsYmFjayIsImVycm9yQ2FsbGJhY2siLCJhcGlLZXkiLCJjb25zb2xlIiwibG9nIiwiJCIsImFqYXgiLCJ1cmwiLCJ0aGVuIiwiZGF0YSIsInNjcmVlbiIsImNoYW5lbFVybCIsImNoYW5uZWxfdXJsIiwiY2hhbm5lbElkIiwic3Vic3RyaW5nIiwiaW5kZXhPZiIsImNvbmZpZyIsIlNLSU4iLCJTVE9SQUdFX0VOViIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIlJpc2VWaXNpb24iLCJWaWRlbyIsImdhZGdldHMiLCJfY2xlYXJOb0ZpbGVUaW1lciIsImNsZWFyVGltZW91dCIsIl9ub0ZpbGVUaW1lciIsIl9kb25lIiwicnBjIiwiY2FsbCIsIl9wcmVmcyIsImdldFN0cmluZyIsIl9yZWFkeSIsIl9yZWZyZXNoSW50ZXJ2YWwiLCJkdXJhdGlvbiIsIl9yZWZyZXNoSW50ZXJ2YWxJZCIsInNldEludGVydmFsIiwiX2N1cnJlbnRGaWxlIiwiX2FkZGl0aW9uYWxQYXJhbXMiLCJfc2VwYXJhdG9yIiwiRGF0ZSIsImdldFRpbWUiLCJfcGxheWJhY2tFcnJvciIsIl9zdGFydE5vRmlsZVRpbWVyIiwic2V0VGltZW91dCIsIm5vU3RvcmFnZUZpbGUiLCJfbm9GaWxlRmxhZyIsIl9tZXNzYWdlIiwic2hvdyIsIl9mcmFtZUNvbnRyb2xsZXIiLCJyZW1vdmUiLCJfY3VycmVudEZyYW1lIiwiX3ZpZXdlclBhdXNlZCIsIm9uU3RvcmFnZUluaXQiLCJoaWRlIiwicGxheSIsIm9uU3RvcmFnZVJlZnJlc2giLCJwYXVzZSIsImZyYW1lT2JqIiwiZ2V0RnJhbWVPYmplY3QiLCJwbGF5ZXJFbmRlZCIsInBsYXllclJlYWR5IiwiX2lzU3RvcmFnZUZpbGUiLCJfcmVmcmVzaER1cmF0aW9uIiwic3RhcnRQbGF5bGlzdENoYW5nZVRpbWVyIiwiX3BsYXlsaXN0Q2hhbmdlVGltZXIiLCJkaXNwbGF5SWQiLCJ2aWRlb1VybCIsImluaXRZVFBsYXllciIsIndpZHRoIiwiaGVpZ2h0IiwieGxTdWl0ZVBsYXlsaXN0UmVmcmVzaER1cmF0aW9uIiwic2V0QWRkaXRpb25hbFBhcmFtcyIsIm5hbWVzIiwidmFsdWVzIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiSlNPTiIsInBhcnNlIiwiUHJlZnMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJnZXRJbnQiLCJDb21tb24iLCJGcmFtZUNvbnRyb2xsZXIiLCJzdGFydFhMU3VpdGVQbGF5ZXIiLCJwbGF5bGlzdElkIiwiJG1haW5JZnJhbWUiLCJhdHRyIiwieW91dHViZVBsYXllckpTIiwiWVQiLCJQbGF5ZXIiLCJwbGF5ZXJWYXJzIiwibGlzdFR5cGUiLCJsaXN0IiwiYXV0b3BsYXkiLCJjb250cm9scyIsImxvb3AiLCJzaG93aW5mbyIsImV2ZW50cyIsIm9uRXJyb3IiLCJvblBsYXllckVycm9yIiwib25SZWFkeSIsIm9uUGxheWVyUmVhZHkiLCJvblN0YXRlQ2hhbmdlIiwib25QbGF5ZXJTdGF0ZUNoYW5nZSIsImV2ZW50IiwibmV4dFZpZGVvIiwicGxheWVyRXJyb3IiLCJlcnJvciIsImRlYnVnIiwic3RvcCIsIlN0b3JhZ2UiLCJpbml0Iiwic3RvcmFnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiZGV0YWlsIiwiX2luaXRpYWxMb2FkIiwiaGFzT3duUHJvcGVydHkiLCJjaGFuZ2VkIiwic2V0QXR0cmlidXRlIiwiZm9sZGVyIiwiZmlsZU5hbWUiLCJjb21wYW55SWQiLCJnbyIsImdldEZyYW1lQ29udGFpbmVyIiwiaW5kZXgiLCJQUkVGSVgiLCJpZnJhbWUiLCJmcmFtZUNvbnRhaW5lciIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50V2luZG93IiwiY29udGVudERvY3VtZW50IiwiX2NsZWFyIiwiYWRkIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwiY3JlYXRlRnJhbWVQbGF5ZXIiLCJwYXJhbXMiLCJmaWxlcyIsInNraW4iLCJzcmMiLCJvbmxvYWQiLCJsb2FkIiwidmlzaWJpbGl0eSIsImNhbGxiYWNrIiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwiTWVzc2FnZSIsIm1haW5Db250YWluZXIiLCJtZXNzYWdlQ29udGFpbmVyIiwiX2luaXQiLCJ3YXJuIiwibWVzc2FnZSIsIl9hY3RpdmUiLCJkaXNwbGF5IiwicCIsImZyYWdtZW50IiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsImlubmVySFRNTCIsImxpbmVIZWlnaHQiLCJ3aW5kb3ciLCJwb2x5bWVyUmVhZHkiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiaWQiLCJyZWdpc3RlciIsInByZWZzIiwib25jb250ZXh0bWVudSIsIl9nYXEiLCJwdXNoIiwiZ2EiLCJ0eXBlIiwiYXN5bmMiLCJsb2NhdGlvbiIsInByb3RvY29sIiwicyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSJdLCJtYXBwaW5ncyI6IkFBaUJBLFFBQVNBLDBCQUF5QkMsRUFBWUMsRUFBaUJDLEdBQzdELEdBQUlDLEdBQVMsc0NBRWJDLFNBQVFDLElBQUksbUJBQW9CTCxHQUVoQ00sRUFBRUMsTUFDQUMsSUFBSyx5REFBMkRMLEVBQVMsZ0NBQWtDSCxJQUMxR1MsS0FBSyxTQUFVQyxHQUNoQixJQUFLQSxJQUFTQSxFQUFLQyxPQUtqQixNQUpBUCxTQUFRQyxJQUFJLGlDQUFrQ0ssR0FDMUNSLEdBQ0ZBLElBRUYsTUFJRixJQUFJVSxHQUFZRixFQUFLQyxPQUFPRSxZQUN4QkMsRUFBWUYsRUFBVUcsVUFBVUgsRUFBVUksUUFBUSxVQUFZLEVBRWxFWixTQUFRQyxJQUFJLGlDQUFrQ08sRUFBV0UsR0FFekRiLEVBQWdCYSxLQXJDcEIsR0FBc0IsbUJBQVhHLFFBQXdCLENBQ2pDLEdBQUlBLFNBQ0ZDLEtBQU0sa0JBQ05DLFlBQWEsT0FHUSxvQkFBWkMsVUFDVEEsUUFBUUMs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QVNrRyxxQkFBcUIsVUFBVSxFQUFJRCxHQUFFRSxXQUFXQyxhQUFhUixFQUFJSyIsImZpbGUiOiJqcy93aWRnZXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGNvbmZpZzogdHJ1ZSAqL1xuLyogZXhwb3J0ZWQgY29uZmlnICovXG5pZiAodHlwZW9mIGNvbmZpZyA9PT0gXCJ1bmRlZmluZWRcIikge1xuICB2YXIgY29uZmlnID0ge1xuICAgIFNLSU46IFwic2tpbi9SVlNraW4ueG1sXCIsXG4gICAgU1RPUkFHRV9FTlY6IFwicHJvZFwiXG4gIH07XG5cbiAgaWYgKHR5cGVvZiBhbmd1bGFyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLmNvbW1vbi5pMThuLmNvbmZpZ1wiLCBbXSlcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfUFJFRklYXCIsIFwibG9jYWxlcy90cmFuc2xhdGlvbl9cIilcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfU1VGSVhcIiwgXCIuanNvblwiKTtcbiAgfVxufVxuXHJcbid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gbG9hZFZpZGVvTGlua0Zyb21YTFN1aXRlKGRpc3BsYXlLZXksIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xuICB2YXIgYXBpS2V5ID0gXCIyYWU0NWZjMi03MmI5LTQ1Y2UtOTc3MS1jYWYwZmFiZjljOTdcIjtcblxuICBjb25zb2xlLmxvZyhcImRpc3BsYXlLZXkgcGFyYW1cIiwgZGlzcGxheUtleSk7XG5cbiAgJC5hamF4KHtcbiAgICB1cmw6IFwiaHR0cHM6Ly9ybi54bHN1aXRlLmNvbS9hZG1pbi9hcGkvbGlxdWlkcy9jYWxsP2FwaV9rZXk9XCIgKyBhcGlLZXkgKyBcIiZ0YWc9bG9hZF9zY3JlZW4mZGlzcGxheV9rZXk9XCIgKyBkaXNwbGF5S2V5XG4gIH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICBpZiAoIWRhdGEgfHwgIWRhdGEuc2NyZWVuKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkVycm9yIC0gUmV0dXJuZWQgZGF0YSBpcyBlbXB0eVwiLCBkYXRhKTtcbiAgICAgIGlmIChlcnJvckNhbGxiYWNrKSB7XG4gICAgICAgIGVycm9yQ2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvL3RvZG86IHNhdmUgY2hhbm5lbCBVUkwgdG8gc29tZSAgc2V0dGluZ3MgLyB2YXJpYWJsZVxuICAgIHZhciBjaGFuZWxVcmwgPSBkYXRhLnNjcmVlbi5jaGFubmVsX3VybDtcbiAgICB2YXIgY2hhbm5lbElkID0gY2hhbmVsVXJsLnN1YnN0cmluZyhjaGFuZWxVcmwuaW5kZXhPZihcIj9saXN0PVwiKSArIDYpO1xuXG4gICAgY29uc29sZS5sb2coXCJMb2FkZWQgY2hhbm5lbCBVUkwsIGNoYW5uZWwgSURcIiwgY2hhbmVsVXJsLCBjaGFubmVsSWQpO1xuXG4gICAgc3VjY2Vzc0NhbGxiYWNrKGNoYW5uZWxJZCk7XG5cbiAgICAvL1JOIC0gaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvdmlkZW9zZXJpZXM/bGlzdD1QTG41NlZieE9TNzdmZC1xYlp3MG12blMyUG1fX3R2U0haXG4gICAgLy9teSAtIGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkL3ZpZGVvc2VyaWVzP2xpc3Q9UEw0OFpHd0Nwd1B5RlZpRUxnc252VWtuUnpKeW8yZ09oQVxuXG4gICAgLy90b2RvOiBmaXggZW1iZWRkZWQgZXJyb3JzXG4gICAgLy9odHRwczovL3d3dy5kcnVwYWwub3JnL25vZGUvMTg4NzgxOFxuICAgIC8vaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMjUyMjI5MS9wYXVzaW5nLXlvdXR1YmUtaWZyYW1lLWFwaS1pbi1qYXZhc2NyaXB0XG4gICAgLy9odHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzgyMDUxNzkveW91dHViZS1hcGktaGFuZGxpbmctdmlkZW9zLXRoYXQtaGF2ZS1iZWVuLXJlbW92ZWQtYnkteW91dHViZVxuXG4gIH0pO1xuXG59XG5cclxuLyogZ2xvYmFsIGdhZGdldHMsIGNvbmZpZyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvID0ge307XG5cblJpc2VWaXNpb24uVmlkZW8gPSAoZnVuY3Rpb24gKGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9hZGRpdGlvbmFsUGFyYW1zO1xuXG4gIHZhciBfcHJlZnMgPSBudWxsLFxuICAgIF9zdG9yYWdlID0gbnVsbCxcbiAgICBfbWVzc2FnZSA9IG51bGwsXG4gICAgX2ZyYW1lQ29udHJvbGxlciA9IG51bGw7XG5cbiAgdmFyIF9wbGF5YmFja0Vycm9yID0gZmFsc2UsXG4gICAgX2lzU3RvcmFnZUZpbGUgPSBmYWxzZSxcbiAgICBfdmlld2VyUGF1c2VkID0gdHJ1ZTtcblxuICB2YXIgX2N1cnJlbnRGcmFtZSA9IDA7XG5cbiAgdmFyIF9zZXBhcmF0b3IgPSBcIlwiLFxuICAgIF9jdXJyZW50RmlsZSA9IFwiXCI7XG5cbiAgdmFyIGRpc3BsYXlJZDtcblxuICB2YXIgX3JlZnJlc2hEdXJhdGlvbiA9IDkwMDAwMCwgIC8vIDE1IG1pbnV0ZXNcbiAgICBfcmVmcmVzaEludGVydmFsSWQgPSBudWxsO1xuXG4gIHZhciB4bFN1aXRlUGxheWxpc3RSZWZyZXNoRHVyYXRpb24gPSA1MDAwOyAvLzUgc2VjXG5cbiAgdmFyIF9ub0ZpbGVUaW1lciA9IG51bGwsXG4gICAgX25vRmlsZUZsYWcgPSBmYWxzZTtcblxuICB2YXIgX3BsYXlsaXN0Q2hhbmdlVGltZXIgPSBudWxsO1xuXG4gIHZhciB5b3V0dWJlUGxheWVySlMgPSBudWxsO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9jbGVhck5vRmlsZVRpbWVyKCkge1xuICAgIGNsZWFyVGltZW91dChfbm9GaWxlVGltZXIpO1xuICAgIF9ub0ZpbGVUaW1lciA9IG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBfZG9uZSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9kb25lXCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSk7XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWFkeSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9yZWFkeVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIiksXG4gICAgICB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWZyZXNoSW50ZXJ2YWwoZHVyYXRpb24pIHtcbiAgICBfcmVmcmVzaEludGVydmFsSWQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiB2aWRlb1JlZnJlc2goKSB7XG4gICAgICAvLyBzZXQgbmV3IHZhbHVlIG9mIG5vbiByaXNlLXN0b3JhZ2UgdXJsIHdpdGggYSBjYWNoZWJ1c3RlclxuICAgICAgX2N1cnJlbnRGaWxlID0gX2FkZGl0aW9uYWxQYXJhbXMudXJsICsgX3NlcGFyYXRvciArIFwiY2I9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcblxuICAgICAgLy8gaW4gY2FzZSByZWZyZXNoZWQgZmlsZSBmaXhlcyBhbiBlcnJvciB3aXRoIHByZXZpb3VzIGZpbGUsIGVuc3VyZSBmbGFnIGlzIHJlbW92ZWQgc28gcGxheWJhY2sgaXMgYXR0ZW1wdGVkIGFnYWluXG4gICAgICBfcGxheWJhY2tFcnJvciA9IGZhbHNlO1xuXG4gICAgfSwgZHVyYXRpb24pO1xuICB9XG5cbiAgZnVuY3Rpb24gX3N0YXJ0Tm9GaWxlVGltZXIoKSB7XG4gICAgX2NsZWFyTm9GaWxlVGltZXIoKTtcblxuICAgIF9ub0ZpbGVUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgLy8gbm90aWZ5IFZpZXdlciB3aWRnZXQgaXMgZG9uZVxuICAgICAgX2RvbmUoKTtcbiAgICB9LCA1MDAwKTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gbm9TdG9yYWdlRmlsZSgpIHtcbiAgICBfbm9GaWxlRmxhZyA9IHRydWU7XG4gICAgX2N1cnJlbnRGaWxlID0gXCJcIjtcblxuICAgIF9tZXNzYWdlLnNob3coXCJUaGUgc2VsZWN0ZWQgdmlkZW8gZG9lcyBub3QgZXhpc3QuXCIpO1xuXG4gICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSwgZnVuY3Rpb24gKCkge1xuICAgICAgLy8gaWYgV2lkZ2V0IGlzIHBsYXlpbmcgcmlnaHQgbm93LCBydW4gdGhlIHRpbWVyXG4gICAgICBpZiAoIV92aWV3ZXJQYXVzZWQpIHtcbiAgICAgICAgX3N0YXJ0Tm9GaWxlVGltZXIoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZUluaXQodXJsKSB7XG4gICAgX2N1cnJlbnRGaWxlID0gdXJsO1xuXG4gICAgX21lc3NhZ2UuaGlkZSgpO1xuXG4gICAgaWYgKCFfdmlld2VyUGF1c2VkKSB7XG4gICAgICBwbGF5KCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gb25TdG9yYWdlUmVmcmVzaCh1cmwpIHtcbiAgICBfY3VycmVudEZpbGUgPSB1cmw7XG5cbiAgICAvLyBpbiBjYXNlIHJlZnJlc2hlZCBmaWxlIGZpeGVzIGFuIGVycm9yIHdpdGggcHJldmlvdXMgZmlsZSwgZW5zdXJlIGZsYWcgaXMgcmVtb3ZlZCBzbyBwbGF5YmFjayBpcyBhdHRlbXB0ZWQgYWdhaW5cbiAgICBfcGxheWJhY2tFcnJvciA9IGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgdmFyIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcblxuICAgIF92aWV3ZXJQYXVzZWQgPSB0cnVlO1xuXG4gICAgaWYgKF9ub0ZpbGVGbGFnKSB7XG4gICAgICBfY2xlYXJOb0ZpbGVUaW1lcigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgZnJhbWVPYmoucGF1c2UoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAvLyAgY29uc29sZS5sb2coXCJQbGF5IGV2ZW50IFwiKTtcbiAgICB2YXIgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuXG4gICAgX3ZpZXdlclBhdXNlZCA9IGZhbHNlO1xuXG4gICAgaWYgKF9ub0ZpbGVGbGFnKSB7XG4gICAgICBfc3RhcnROb0ZpbGVUaW1lcigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghX3BsYXliYWNrRXJyb3IpIHtcbiAgICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgICBmcmFtZU9iai5wbGF5KCk7XG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgIC8vaWYgKF9jdXJyZW50RmlsZSAmJiBfY3VycmVudEZpbGUgIT09IFwiXCIpIHtcbiAgICAgICAgLy8gIC8vIGFkZCBmcmFtZSBhbmQgY3JlYXRlIHRoZSBwbGF5ZXJcbiAgICAgICAgLy8gIF9mcmFtZUNvbnRyb2xsZXIuYWRkKDApO1xuICAgICAgICAvLyAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcigwLCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlLCBjb25maWcuU0tJTiwgXCJwbGF5ZXIuaHRtbFwiKTtcbiAgICAgICAgLy99XG5cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVGhpcyBmbGFnIG9ubHkgZ290IHNldCB1cG9uIGEgcmVmcmVzaCBvZiBoaWRkZW4gZnJhbWUgYW5kIHRoZXJlIHdhcyBhbiBlcnJvciBpbiBzZXR1cCBvciB2aWRlb1xuICAgICAgLy8gU2VuZCBWaWV3ZXIgXCJkb25lXCJcbiAgICAgIF9kb25lKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyRW5kZWQoKSB7XG4gICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSwgZnVuY3Rpb24gKCkge1xuICAgICAgX2RvbmUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllclJlYWR5KCkge1xuICAgIHZhciBmcmFtZU9iajtcblxuICAgIC8vIG5vbi1zdG9yYWdlLCBjaGVjayBpZiByZWZyZXNoIGludGVydmFsIGV4aXN0cyB5ZXQsIHN0YXJ0IGl0IGlmIG5vdFxuICAgIGlmICghX2lzU3RvcmFnZUZpbGUgJiYgX3JlZnJlc2hJbnRlcnZhbElkID09PSBudWxsKSB7XG4gICAgICBfcmVmcmVzaEludGVydmFsKF9yZWZyZXNoRHVyYXRpb24pO1xuICAgIH1cblxuICAgIGlmICghX3ZpZXdlclBhdXNlZCkge1xuICAgICAgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuICAgICAgZnJhbWVPYmoucGxheSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHN0YXJ0UGxheWxpc3RDaGFuZ2VUaW1lcigpIHtcbiAgICBjbGVhclRpbWVvdXQoX3BsYXlsaXN0Q2hhbmdlVGltZXIpO1xuXG4gICAgX3BsYXlsaXN0Q2hhbmdlVGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkludGVydmFsIGNoZWNrXCIpO1xuXG4gICAgICBsb2FkVmlkZW9MaW5rRnJvbVhMU3VpdGUoZGlzcGxheUlkLCBmdW5jdGlvbiAodmlkZW9VcmwpIHtcbiAgICAgICAgaWYgKHZpZGVvVXJsICE9IF9jdXJyZW50RmlsZSkge1xuICAgICAgICAgIF9jdXJyZW50RmlsZSA9IHZpZGVvVXJsO1xuICAgICAgICAgIGluaXRZVFBsYXllcihfY3VycmVudEZpbGUsIF9hZGRpdGlvbmFsUGFyYW1zLndpZHRoLCBfYWRkaXRpb25hbFBhcmFtcy5oZWlnaHQpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIH0sIHhsU3VpdGVQbGF5bGlzdFJlZnJlc2hEdXJhdGlvbik7XG5cbiAgICAvL2lmICh5b3V0dWJlUGxheWVySlMgIT0gbnVsbCkge1xuICAgIC8vICB2YXIgc3RhdGUgPSB5b3V0dWJlUGxheWVySlMuZ2V0UGxheWVyU3RhdGUoKTtcbiAgICAvLyAgY29uc29sZS5sb2coXCJUaW1lciBwbGF5ZXIgc3RhdGVcIiwgc3RhdGUpO1xuICAgIC8vfVxuICB9XG5cbiAgZnVuY3Rpb24gc2V0QWRkaXRpb25hbFBhcmFtcyhuYW1lcywgdmFsdWVzKSB7XG4gICAgY29uc29sZS5sb2coXCJhZGRpdGlvbmFsIHBhcmFtcyB2YWx1ZXNcIiwgdmFsdWVzKTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShuYW1lcykgJiYgbmFtZXMubGVuZ3RoID4gMCAmJiBuYW1lc1swXSA9PT0gXCJhZGRpdGlvbmFsUGFyYW1zXCIpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlcykgJiYgdmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMgPSBKU09OLnBhcnNlKHZhbHVlc1swXSk7XG4gICAgICAgIF9wcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCk7XG5cbiAgICAgICAgaWYgKCFfYWRkaXRpb25hbFBhcmFtcykge1xuICAgICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zID0ge307XG4gICAgICAgICAgY29uc29sZS5sb2coXCJhZGRpdGlvbmFsIHBhcmFtcyByZWNyZWF0ZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvQ29udGFpbmVyXCIpLnN0eWxlLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIikgKyBcInB4XCI7XG5cbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMud2lkdGggPSBfcHJlZnMuZ2V0SW50KFwicnNXXCIpO1xuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpO1xuXG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIgPSBuZXcgUmlzZVZpc2lvbi5Db21tb24uVmlkZW8uRnJhbWVDb250cm9sbGVyKCk7XG5cbiAgICAgICAgX2lzU3RvcmFnZUZpbGUgPSBmYWxzZTtcblxuICAgICAgICBpZiAoX3ByZWZzLmdldFN0cmluZyhcImRpc3BsYXlJZFwiKSkge1xuICAgICAgICAgIGRpc3BsYXlJZCA9IF9wcmVmcy5nZXRTdHJpbmcoXCJkaXNwbGF5SWRcIik7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJkaXNwbGF5SWQgc2V0IGZyb20gY2hyb21lQXBwIHBhcmFtXCIsIGRpc3BsYXlJZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGlzcGxheUlkID0gX2FkZGl0aW9uYWxQYXJhbXMuZGlzcGxheUlkO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiZGlzcGxheUlkIHNldCBmcm9tIGRlZmF1bHQgc2V0dGluZ3NcIiwgZGlzcGxheUlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvYWRWaWRlb0xpbmtGcm9tWExTdWl0ZShkaXNwbGF5SWQsIHN0YXJ0WExTdWl0ZVBsYXllciwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKGRpc3BsYXlJZCAhPSBfcHJlZnMuZ2V0U3RyaW5nKFwiZGlzcGxheUlkXCIpKSB7XG4gICAgICAgICAgICBkaXNwbGF5SWQgPSBfYWRkaXRpb25hbFBhcmFtcy5kaXNwbGF5SWQ7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRyeWluZyB0byB1c2UgZGVmYXVsdCBkaXNwbGF5SWRcIiwgZGlzcGxheUlkKTtcbiAgICAgICAgICAgIGxvYWRWaWRlb0xpbmtGcm9tWExTdWl0ZShkaXNwbGF5SWQsIHN0YXJ0WExTdWl0ZVBsYXllcik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzdGFydFhMU3VpdGVQbGF5ZXIodmlkZW9VcmwpIHtcbiAgICBfY3VycmVudEZpbGUgPSB2aWRlb1VybDtcbiAgICBpbml0WVRQbGF5ZXIoX2N1cnJlbnRGaWxlLCBfYWRkaXRpb25hbFBhcmFtcy53aWR0aCwgX2FkZGl0aW9uYWxQYXJhbXMuaGVpZ2h0KTtcbiAgICBzdGFydFBsYXlsaXN0Q2hhbmdlVGltZXIoKTtcblxuICAgIF9yZWFkeSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5pdFlUUGxheWVyKHBsYXlsaXN0SWQsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICB2YXIgJG1haW5JZnJhbWUgPSAkKCcjbWFpbklmcmFtZScpO1xuICAgICRtYWluSWZyYW1lLmF0dHIoJ3NyYycsIHBsYXlsaXN0SWQpO1xuICAgICRtYWluSWZyYW1lLmF0dHIoJ3dpZHRoJywgd2lkdGgpO1xuICAgICRtYWluSWZyYW1lLmF0dHIoJ2hlaWdodCcsIGhlaWdodCk7XG5cbiAgICBjb25zb2xlLmxvZyhcIlZpZGVvIHVybCwgdywgaFwiLCBwbGF5bGlzdElkLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgIHlvdXR1YmVQbGF5ZXJKUyA9IG5ldyBZVC5QbGF5ZXIoJ21haW5JZnJhbWUnLCB7XG4gICAgICB3aWR0aDogd2lkdGgsXG4gICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgIHBsYXllclZhcnM6IHtcbiAgICAgICAgbGlzdFR5cGU6J3BsYXlsaXN0JyxcbiAgICAgICAgbGlzdDogcGxheWxpc3RJZCxcbiAgICAgICAgJ2F1dG9wbGF5JzogMSxcbiAgICAgICAgJ2NvbnRyb2xzJzogMCxcbiAgICAgICAgJ2xvb3AnOiAxLFxuICAgICAgICAnc2hvd2luZm8nOiAwXG4gICAgICB9LFxuICAgICAgZXZlbnRzOiB7XG4gICAgICAgICdvbkVycm9yJzogb25QbGF5ZXJFcnJvcigpLFxuICAgICAgICAnb25SZWFkeSc6IG9uUGxheWVyUmVhZHkoKSxcbiAgICAgICAgJ29uU3RhdGVDaGFuZ2UnOiBvblBsYXllclN0YXRlQ2hhbmdlKClcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uUGxheWVyRXJyb3IoZXZlbnQpIHtcbiAgICBjb25zb2xlLmxvZyhcIlBsYXllciBlcnJvciBjb2RlXCIsIGV2ZW50KTtcbiAgLy8gIGlmIChlcnJvckNvZGUgPj0gMTAwKSB7XG4gICAgaWYgKHlvdXR1YmVQbGF5ZXJKUyAmJiB5b3V0dWJlUGxheWVySlMgIT0gbnVsbCkge1xuICAgICAgeW91dHViZVBsYXllckpTLm5leHRWaWRlbygpO1xuICAgICAgY29uc29sZS5sb2coXCJFcnJvciwgcGxheWluZyBuZXh0IHZpZGVvXCIsIGV2ZW50KTtcbiAgICB9XG4gIC8vICB9XG4gIH1cblxuICBmdW5jdGlvbiBvblBsYXllclN0YXRlQ2hhbmdlKGV2ZW50KSB7XG4gICAgY29uc29sZS5sb2coXCJPbiBwbGF5ZXIgc3RhdGUgY2hhbmdlXCIsIGV2ZW50KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uUGxheWVyUmVhZHkoZXZlbnQpIHtcbiAgICBjb25zb2xlLmxvZyhcIk9uIHBsYXllciByZWFkeVwiLCBldmVudCk7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFcnJvcihlcnJvcikge1xuICAgIGNvbnNvbGUuZGVidWcoXCJ2aWRlby1mb2xkZXI6OnBsYXllckVycm9yKClcIiwgZXJyb3IpO1xuXG4gICAgLy8gZmxhZyB0aGUgdmlkZW8gaGFzIGFuIGVycm9yXG4gICAgX3BsYXliYWNrRXJyb3IgPSB0cnVlO1xuXG4gICAgLy8gYWN0IGFzIHRob3VnaCB2aWRlbyBoYXMgZW5kZWRcbiAgICBwbGF5ZXJFbmRlZCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBwYXVzZSgpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcIm5vU3RvcmFnZUZpbGVcIjogbm9TdG9yYWdlRmlsZSxcbiAgICBcIm9uU3RvcmFnZUluaXRcIjogb25TdG9yYWdlSW5pdCxcbiAgICBcIm9uU3RvcmFnZVJlZnJlc2hcIjogb25TdG9yYWdlUmVmcmVzaCxcbiAgICBcInBhdXNlXCI6IHBhdXNlLFxuICAgIFwicGxheVwiOiBwbGF5LFxuICAgIFwic2V0QWRkaXRpb25hbFBhcmFtc1wiOiBzZXRBZGRpdGlvbmFsUGFyYW1zLFxuICAgIFwicGxheWVyRW5kZWRcIjogcGxheWVyRW5kZWQsXG4gICAgXCJwbGF5ZXJSZWFkeVwiOiBwbGF5ZXJSZWFkeSxcbiAgICBcInBsYXllckVycm9yXCI6IHBsYXllckVycm9yLFxuICAgIFwic3RvcFwiOiBzdG9wXG4gIH07XG5cbn0pKGdhZGdldHMpO1xuXHJcbi8qIGdsb2JhbCBjb25maWcgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlbyA9IFJpc2VWaXNpb24uVmlkZW8gfHwge307XG5cblJpc2VWaXNpb24uVmlkZW8uU3RvcmFnZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfaW5pdGlhbExvYWQgPSB0cnVlO1xuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICB2YXIgc3RvcmFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9TdG9yYWdlXCIpO1xuXG4gICAgaWYgKCFzdG9yYWdlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGlmIChlLmRldGFpbCAmJiBlLmRldGFpbC51cmwpIHtcblxuICAgICAgICBpZiAoX2luaXRpYWxMb2FkKSB7XG4gICAgICAgICAgX2luaXRpYWxMb2FkID0gZmFsc2U7XG5cbiAgICAgICAgICBSaXNlVmlzaW9uLlZpZGVvLm9uU3RvcmFnZUluaXQoZS5kZXRhaWwudXJsKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAvLyBjaGVjayBmb3IgXCJjaGFuZ2VkXCIgcHJvcGVydHkgYW5kIGVuc3VyZSBpdCBpcyB0cnVlXG4gICAgICAgICAgaWYgKGUuZGV0YWlsLmhhc093blByb3BlcnR5KFwiY2hhbmdlZFwiKSAmJiBlLmRldGFpbC5jaGFuZ2VkKSB7XG4gICAgICAgICAgICBSaXNlVmlzaW9uLlZpZGVvLm9uU3RvcmFnZVJlZnJlc2goZS5kZXRhaWwudXJsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1uby1maWxlXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgUmlzZVZpc2lvbi5WaWRlby5ub1N0b3JhZ2VGaWxlKCk7XG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBkYXRhLnN0b3JhZ2UuZm9sZGVyKTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZpbGVOYW1lXCIsIGRhdGEuc3RvcmFnZS5maWxlTmFtZSk7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgZGF0YS5zdG9yYWdlLmNvbXBhbnlJZCk7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJlbnZcIiwgY29uZmlnLlNUT1JBR0VfRU5WKTtcbiAgICBzdG9yYWdlLmdvKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaW5pdFwiOiBpbml0XG4gIH07XG59O1xuXHJcbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcclxuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcclxuXHJcblJpc2VWaXNpb24uQ29tbW9uLlZpZGVvID0gUmlzZVZpc2lvbi5Db21tb24uVmlkZW8gfHwge307XHJcblxyXG5SaXNlVmlzaW9uLkNvbW1vbi5WaWRlby5GcmFtZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gIHZhciBQUkVGSVggPSBcImlmX1wiO1xyXG5cclxuICBmdW5jdGlvbiBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCkge1xyXG4gICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGdldEZyYW1lT2JqZWN0KGluZGV4KSB7XHJcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXHJcbiAgICAgIGlmcmFtZTtcclxuXHJcbiAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xyXG5cclxuICAgIGlmIChpZnJhbWUpIHtcclxuICAgICAgcmV0dXJuIChpZnJhbWUuY29udGVudFdpbmRvdykgPyBpZnJhbWUuY29udGVudFdpbmRvdyA6XHJcbiAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBfY2xlYXIoaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcclxuICAgICAgZnJhbWVPYmogPSBnZXRGcmFtZU9iamVjdChpbmRleCksXHJcbiAgICAgIGlmcmFtZTtcclxuXHJcbiAgICBpZiAoZnJhbWVPYmopIHtcclxuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcclxuICAgICAgZnJhbWVPYmoucmVtb3ZlKCk7XHJcbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgXCJhYm91dDpibGFua1wiKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGFkZChpbmRleCkge1xyXG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxyXG4gICAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpO1xyXG5cclxuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJhbGxvd1RyYW5zcGFyZW5jeVwiLCB0cnVlKTtcclxuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJmcmFtZWJvcmRlclwiLCBcIjBcIik7XHJcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic2Nyb2xsaW5nXCIsIFwibm9cIik7XHJcblxyXG4gICAgZnJhbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGNyZWF0ZUZyYW1lUGxheWVyKGluZGV4LCBwYXJhbXMsIGZpbGVzLCBza2luLCBzcmMpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcclxuICAgICAgZnJhbWVPYmogPSBnZXRGcmFtZU9iamVjdChpbmRleCksXHJcbiAgICAgIGlmcmFtZTtcclxuXHJcbiAgICBpZiAoZnJhbWVPYmopIHtcclxuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcclxuXHJcbiAgICAgIGlmcmFtZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWZyYW1lLm9ubG9hZCA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGluaXRpYWxpemUgYW5kIGxvYWQgdGhlIHBsYXllciBpbnNpZGUgdGhlIGlmcmFtZVxyXG4gICAgICAgIGZyYW1lT2JqLmluaXQocGFyYW1zLCBmaWxlcywgc2tpbik7XHJcbiAgICAgICAgZnJhbWVPYmoubG9hZCgpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBzcmMpO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGhpZGUoaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KTtcclxuXHJcbiAgICBmcmFtZUNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHJlbW92ZShpbmRleCwgY2FsbGJhY2spIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcclxuXHJcbiAgICBfY2xlYXIoaW5kZXgpO1xyXG5cclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAvLyByZW1vdmUgdGhlIGlmcmFtZSBieSBjbGVhcmluZyBhbGwgZWxlbWVudHMgaW5zaWRlIGRpdiBjb250YWluZXJcclxuICAgICAgd2hpbGUgKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpIHtcclxuICAgICAgICBmcmFtZUNvbnRhaW5lci5yZW1vdmVDaGlsZChmcmFtZUNvbnRhaW5lci5maXJzdENoaWxkKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGNhbGxiYWNrICYmIHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgfVxyXG4gICAgfSwgMjAwKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNob3coaW5kZXgpIHtcclxuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KTtcclxuXHJcbiAgICBmcmFtZUNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgYWRkOiBhZGQsXHJcbiAgICBjcmVhdGVGcmFtZVBsYXllcjogY3JlYXRlRnJhbWVQbGF5ZXIsXHJcbiAgICBnZXRGcmFtZUNvbnRhaW5lcjogZ2V0RnJhbWVDb250YWluZXIsXHJcbiAgICBnZXRGcmFtZU9iamVjdDogZ2V0RnJhbWVPYmplY3QsXHJcbiAgICBoaWRlOiBoaWRlLFxyXG4gICAgcmVtb3ZlOiByZW1vdmUsXHJcbiAgICBzaG93OiBzaG93XHJcbiAgfTtcclxufTtcclxuXHJcbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcclxuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcclxuXHJcblJpc2VWaXNpb24uQ29tbW9uLk1lc3NhZ2UgPSBmdW5jdGlvbiAobWFpbkNvbnRhaW5lciwgbWVzc2FnZUNvbnRhaW5lcikge1xyXG4gIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICB2YXIgX2FjdGl2ZSA9IGZhbHNlO1xyXG5cclxuICBmdW5jdGlvbiBfaW5pdCgpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gbWFpbkNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihcIkNhbid0IGluaXRpYWxpemUgTWVzc2FnZSAtIFwiLCBlLm1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiAgUHVibGljIE1ldGhvZHNcclxuICAgKi9cclxuICBmdW5jdGlvbiBoaWRlKCkge1xyXG4gICAgaWYgKF9hY3RpdmUpIHtcclxuICAgICAgLy8gY2xlYXIgY29udGVudCBvZiBtZXNzYWdlIGNvbnRhaW5lclxyXG4gICAgICB3aGlsZSAobWVzc2FnZUNvbnRhaW5lci5maXJzdENoaWxkKSB7XHJcbiAgICAgICAgbWVzc2FnZUNvbnRhaW5lci5yZW1vdmVDaGlsZChtZXNzYWdlQ29udGFpbmVyLmZpcnN0Q2hpbGQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBoaWRlIG1lc3NhZ2UgY29udGFpbmVyXHJcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG5cclxuICAgICAgLy8gc2hvdyBtYWluIGNvbnRhaW5lclxyXG4gICAgICBtYWluQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcclxuXHJcbiAgICAgIF9hY3RpdmUgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNob3cobWVzc2FnZSkge1xyXG4gICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLFxyXG4gICAgICBwO1xyXG5cclxuICAgIGlmICghX2FjdGl2ZSkge1xyXG4gICAgICAvLyBoaWRlIG1haW4gY29udGFpbmVyXHJcbiAgICAgIG1haW5Db250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XHJcblxyXG4gICAgICBtZXNzYWdlQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcblxyXG4gICAgICAvLyBjcmVhdGUgbWVzc2FnZSBlbGVtZW50XHJcbiAgICAgIHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcclxuICAgICAgcC5pbm5lckhUTUwgPSBtZXNzYWdlO1xyXG4gICAgICBwLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwibWVzc2FnZVwiKTtcclxuICAgICAgcC5zdHlsZS5saW5lSGVpZ2h0ID0gbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7XHJcblxyXG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChwKTtcclxuICAgICAgbWVzc2FnZUNvbnRhaW5lci5hcHBlbmRDaGlsZChmcmFnbWVudCk7XHJcblxyXG4gICAgICBfYWN0aXZlID0gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIG1lc3NhZ2UgYWxyZWFkeSBiZWluZyBzaG93biwgdXBkYXRlIG1lc3NhZ2UgdGV4dFxyXG4gICAgICBwID0gbWVzc2FnZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiLm1lc3NhZ2VcIik7XHJcbiAgICAgIHAuaW5uZXJIVE1MID0gbWVzc2FnZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9pbml0KCk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBcImhpZGVcIjogaGlkZSxcclxuICAgIFwic2hvd1wiOiBzaG93XHJcbiAgfTtcclxufTtcclxuXHJcbi8qIGdsb2JhbCBnYWRnZXRzLCBSaXNlVmlzaW9uICovXG5cbihmdW5jdGlvbiAod2luZG93LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBwcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCksXG4gICAgaWQgPSBwcmVmcy5nZXRTdHJpbmcoXCJpZFwiKTtcblxuICAvLyBEaXNhYmxlIGNvbnRleHQgbWVudSAocmlnaHQgY2xpY2sgbWVudSlcbiAgd2luZG93Lm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlby5wbGF5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW8uc3RvcCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9seW1lclJlYWR5KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbiAgICBpZiAoaWQgJiYgaWQgIT09IFwiXCIpIHtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGxheV9cIiArIGlkLCBwbGF5KTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGF1c2VfXCIgKyBpZCwgcGF1c2UpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9zdG9wX1wiICsgaWQsIHN0b3ApO1xuXG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzcGFyYW1fc2V0X1wiICsgaWQsIFJpc2VWaXNpb24uVmlkZW8uc2V0QWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNwYXJhbV9nZXRcIiwgbnVsbCwgaWQsIFtcImFkZGl0aW9uYWxQYXJhbXNcIl0pO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXHJcbi8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbnZhciBfZ2FxID0gX2dhcSB8fCBbXTtcblxuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNTcwOTIxNTktMiddKTtcbl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pO1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOyBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IGdhLmFzeW5jID0gdHJ1ZTtcbiAgZ2Euc3JjID0gKCdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID8gJ2h0dHBzOi8vc3NsJyA6ICdodHRwOi8vd3d3JykgKyAnLmdvb2dsZS1hbmFseXRpY3MuY29tL2dhLmpzJztcbiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07IHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpO1xufSkoKTtcbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
