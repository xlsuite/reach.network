/*!
 * Tubey for JW Player ~ version 1.0 ~ June 2015, James Herrieven ~ http://powered-by-haiku.co.uk
 * A solution for loading YouTube playlists in JW Player
 */

!function(e){var t=function(e,t){function i(){var t=e.plugins.tubey,i=[],n=!0;for(var o in t.pl.got){var s=t.pl.got[o];"complete"==s.status?i=i.concat(s.list):n=!1}n===!0&&(e.setControls(t.controls),t["try-play"]=!e.config.autostart||e.config.autostart!==!0&&"true"!==e.config.autostart?!1:!0,e.load(i))}function n(t,s){var l=e.plugins.tubey;l.pl.got[t]||(l.pl.got[t]={status:"processing",list:[]}),o(t,function(e,t,o,s){e.length>0&&(l.pl.got[t].list=l.pl.got[t].list.concat(e)),s?n(t,s):(l.pl.got[t].status="complete",i())},s)}function o(t,i,n){var o=e.plugins.tubey;if(i){var l=o.urls.yt_playlist_url,u={};u.key="AIzaSyDzkwGeN2FhKzaQu1NnNxqL_jsLqSJmtd4",u.maxResults=50,u.playlistId=t,n&&(u.pageToken=n);for(var a in u)l+="&"+a+"="+u[a];s(l,function(e){var n=[],s=JSON.parse(e);if(!s.error&&s.items&&s.items.length>0)for(var l=0,u=s.items.length;u>l;l++){var a=s.items[l];if(a.snippet&&a.snippet.thumbnails){var r={};r.index=l+1,r.type="youtube",r.mediaid=a.snippet.resourceId.videoId,r.file=o.urls.yt_url+a.snippet.resourceId.videoId;var p=a.snippet.thumbnails?a.snippet.thumbnails.high?a.snippet.thumbnails.high:a.snippet.thumbnails.medium?a.snippet.thumbnails.medium:a.snippet.thumbnails["default"]:"";r.image=p.url;var c=a.snippet.title;c=c.replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"'),c=c.replace(/[\u2013\u2014]/g,"-").replace(/[\u2026]/g,"..."),r.title=c;var g=a.snippet.description;g=g.replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"'),g=g.replace(/[\u2013\u2014]/g,"-").replace(/[\u2026]/g,"..."),r.description=g,n.push(r)}}i(n,t,s.prevPageToken?s.prevPageToken:null,s.nextPageToken?s.nextPageToken:null)})}else top.console&&console.info('Tubey // Oops! "getYTPLI" requires a callback function as the second parameter.')}function s(e,t){var i;if(l(e)&&window.XDomainRequest){i=new window.XDomainRequest,i.ontimeout=i.onprogress=function(){},i.timeout=5e3;try{i.open("GET",e,!0),i.onload=function(){t(i.responseText)},i.send(null)}catch(n){top.console&&console.info("Listy: Oops! XDomainRequest: "+n+": "+e)}}else{i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");try{i.overrideMimeType&&i.overrideMimeType("text/plain"),i.open("GET",e,!0),i.onreadystatechange=function(){4===i.readyState&&t(200==i.status?i.responseText:'{"error":"'+i.status+'"}')},i.send(null)}catch(n){t('{"error":"'+n+'"}')}}}function l(e){return e&&e.indexOf("://")>=0&&e.split("/")[2]!=window.location.href.split("/")[2]}e.onReady(function(){var i=e.plugins.tubey;if(e.config.file&&"use-tubey"==e.config.file){i.pl={get:[],got:{}},i.controls=e.getControls(),e.setControls(!1),e.load({file:"use-tubey",type:"mp4",image:t.image?t.image:"//www.dev.powered-by-haiku.co.uk/solutions/tubey/img/use-tubey.jpg",title:t.title?t.title:"Loading the playlist",description:t.description?t.description:"Please wait..."}),"string"==typeof t.playlist?i.pl.get.push(t.playlist):i.pl.get=t.playlist;for(var o=0,s=i.pl.get.length;s>o;o++){var l=i.pl.get[o];n(l,null)}}}),e.onBeforePlay(function(){var t=e.getPlaylistItem();t.file&&"use-tubey"==t.file&&e.stop()}),e.onPlaylist(function(){var t=e.plugins.tubey;t["try-play"]&&t["try-play"]===!0&&setTimeout(function(){e.play()},500)}),this.about={label:"Tubey for JW Player",version:"v1.0",author:"James Herrieven ~ http://powered-by-haiku.co.uk"},this.urls={},this.urls.yt_url="http://www.youtube.com/watch?v=",this.urls.yt_playlist_url="https://www.googleapis.com/youtube/v3/playlistItems?part=snippet"};e().registerPlugin("tubey","6.0",t)}(jwplayer);